---
permalink: "/en/all.html"
---

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Greg Wilson" />
    <title>Still Magic: Index</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/tango.css" />
<link rel="stylesheet" href="/css/youbou.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/files/crossref.js"></script>
<script src="/js/youbou.js" ROOT="true"></script>

  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-2 d-print-none toc">
          



<nav>
  <a href="./">
    <img src="/files/logo.svg" alt="Still Magic logo" width="50%" />
  </a>
  <p>
    <em>
      <strong><a href="./">
        Still Magic
      </a></strong>
      <br/>
      (a <a href="https://merely-useful.github.io/">Merely Useful</a> lesson)
    </em>
  </p>

  <hr/>
  

<p><strong>Lessons</strong></p>
<ol class="chapter">
  <li>
      <a href="#s:intro">Introduction</a>
      
  </li>
        <li>
      <a href="#s:automate">Automating Analyses</a>
      
  </li>
        <li>
      <a href="#s:unit">Unit Testing</a>
      
  </li>
        <li>
      <a href="#s:correct">Testing Data Analysis</a>
      
  </li>
        <li>
      <a href="#s:logging">Logging</a>
      
  </li>
        <li>
      <a href="#s:configuration">Configuration</a>
      
  </li>
        <li>
      <a href="#s:ghp">Using GitHub Pages</a>
      
  </li>
        <li>
      <a href="#s:workflow">A Scalable Workflow</a>
      
  </li>
        <li>
      <a href="#s:continuous">Continuous Integration</a>
      
  </li>
        <li>
      <a href="#s:style">Programming Style</a>
      
  </li>
        <li>
      <a href="#s:refactoring">Refactoring</a>
      
  </li>
        <li>
      <a href="#s:structure">Project Structure</a>
      
  </li>
        <li>
      <a href="#s:inclusive">Including Everyone</a>
      
  </li>
        <li>
      <a href="#s:packages">Packages</a>
      
  </li>
        <li>
      <a href="#s:publish">Publishing</a>
      
  </li>
        <li>
      <a href="#s:docs">Documenting Code</a>
      
  </li>
        <li>
      <a href="#s:finale">Finale</a>
      
  </li>
        </ol>

  

<p>
  
    <a href="#s:bib">Bibliography</a>
  
</p>
      
  

<p><strong>Extras</strong></p>
<ol class="appendix">
  <li>
      <a href="#s:license">License</a>
      
  </li>
        <li>
      <a href="#s:conduct">Code of Conduct</a>
      
  </li>
        <li>
      <a href="#s:citation">Citation</a>
      
  </li>
        <li>
      <a href="#s:gloss">Glossary</a>
      
  </li>
        <li>
      <a href="#s:objectives">Learning Objectives</a>
      
  </li>
        <li>
      <a href="#s:keypoints">Key Points</a>
      
  </li>
        <li>
      <a href="#s:design">Design Notes</a>
      
  </li>
        </ol>

  <p><a href="#s:all">Single page version</a></p>

  

  <hr/>
  <p>
    <a href="#s:license"><img src="/files/cc-by.svg" alt="CC-BY License" width="80%" /></a>
  </p>
  <p>
    <a href="mailto:gvwilson@third-bit.com"><img src="/files/email.svg" alt="Email" width="20%" /></a>
    <a href="https://github.com/merely-useful/still-magic/"><img src="/files/github.svg" alt="GitHub" width="20%" /></a>
  </p>

  
  <p>
    <em>Last generated 2018-08-24.</em>
  </p>
  
</nav>

        </div>
        <div class="col-md-10 main">
          <!-- main start -->

          <h1>Still Magic</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          <blockquote>
  <p>It’s still magic even if you know how it’s done.</p>

  <p>– Terry Pratchett</p>
</blockquote>

<p>As research becomes more computing intensive,
researchers need more computing skills.
Being able to write code and use version control is a start;
the goal of this training is to help you take your next steps
so that:</p>

<ul>
  <li>other people (including your future self) can re-do your analyses,</li>
  <li>you and the people using your results can be confident that they’re correct,</li>
  <li>and re-using your software is easier than rewriting it.</li>
</ul>

<p>These lessons are part of <a href="https://merely-useful.github.io/">Merely Useful</a>, and are based on:</p>

<ul>
  <li>“A Quick Guide to Organizing Computational Biology Projects” [<a href="#Nobl2009">Nobl2009</a>]</li>
  <li>“Ten Simple Rules for Making Research Software More Robust” [<a href="#Tasc2017">Tasc2017</a>]</li>
  <li>“Best Practices for Scientific Computing” [<a href="#Wils2014">Wils2014</a>]</li>
  <li>“Good Enough Practices in Scientific Computing” [<a href="#Wils2017">Wils2017</a>]</li>
  <li>The <a href="http://software-carpentry.org">Software Carpentry</a> and <a href="https://datacarpentry.org/">Data Carpentry</a> lessons</li>
</ul>

<p>For notes on how these lessons were designed, please see <a href="#s:design">Appendix G</a>
and [<a href="#Wils2018">Wils2018</a>].</p>

<h2 id="who-are-these-lessons-for">Who Are These Lessons For?</h2>

<p><strong>Samira</strong> completed a Master’s in epidemiology five years ago, and
has worked since then for a small NGO.  She did a biostatistics course
during her degree, and has learned some more about R and Python by
doing a couple of online data science courses on her own, but has no
formal training in programming.</p>

<p>Samira would like to tidy up the scripts, data sets, and reports she
has created over the past few years in order to share them with two
junior staff the NGO has just hired.  These lessons will show her what
her first steps should be and what “done” looks like.</p>

<p><strong>Jun</strong> completed an Insight Data Science fellowship last year, and
now works for a company that does forensic audits.  He has used a wide
variety of machine learning and visualization software, and has
collaborated on a couple of open source R packages.</p>

<p>Jun is supposed to spend 10% of his time on community projects, and
has decided to help review research papers for a forensic accounting
journal.  This course will show him what a mature data science project
should look like so that he can evaluate the papers he is sent.  It
will also show him what improvements his firm’s clients should make to
their internal analysis pipelines.</p>

<h2 id="summary">Summary</h2>

<p>For researchers and data scientists who have a basic understanding of the Unix shell, Python, and Git,
and who want to be more productive and have more confidence in their results,
this training course
provides a pragmatic, tools-based introduction to program design and maintenance.
Unlike academic software engineering courses and most books aimed at professional software developers,
this course uses data analysis as a motivating example
and assumes that the learner’s ultimate goal is to answer a question rather than ship an application.</p>

<p>Learners must be comfortable with the basics of the Unix shell, Python, and Git
at the level covered by the core <a href="http://software-carpentry.org">Software Carpentry</a> lessons.
They will need a personal computer with Internet access,
the Bash shell,
Python 3,
and a GitHub account.</p>


          

          

          <h1 id="s:intro">Introduction</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>What is the difference between open, reproducible, and competent?
</li><li>What is the scope of this training?
</li><li>What are the prerequisites for this training?
</li>
  </ul>
</div>


          <ul>
  <li>One of the things that distinguishes research programmers is that they’re writing code in order to figure out what the right answer is</li>
  <li>One of the things they struggle with is the transition from exploration to infrastructure
    <ul>
      <li>I.e., from “coding to figure out what the problem is” to “I’m building a reusable tool”</li>
      <li>Habits from the first are often carried over to the second</li>
    </ul>
  </li>
  <li>One possible analogy is game development
    <ul>
      <li>Lots of individual developers trying to get something that works well enough to ship</li>
      <li>A handful of large, stable organizations doing software engineering to create things like Mario Kart 8</li>
      <li>The latter tend to look down on the methods and standards of the former</li>
      <li>But the methods and standards of the latter aren’t helpful for the former</li>
    </ul>
  </li>
  <li>Distinguish between:
    <ul>
      <li>Open science: everyone can read it</li>
      <li>Reproducible research: people can re-do the analysis</li>
      <li>Computational competence: get reliable results without late nights and heartbreak</li>
    </ul>
  </li>
  <li>Computational competence requires the programming equivalent of good laboratory skills
    <ul>
      <li>Because software is just another kind of lab equipment</li>
    </ul>
  </li>
  <li>Reasons not to make your work open
    <ul>
      <li>Academia doesn’t yet know how to reward it, so your effort may not be rewarded</li>
      <li>Fear of looking foolish or harming career isn’t just impostor syndrome (particularly for members of marginalized groups)</li>
    </ul>
  </li>
  <li>Reasons to do it
    <ul>
      <li>Being open is a big step toward a (non-academic) career path, which is where ~80% of Ph.D.s go</li>
      <li>Proven benefits: work is cited more often than closed (FIXME: citation)</li>
    </ul>
  </li>
  <li>Goal of this training is to produce more (correct) results in less time and with less effort
    <ul>
      <li>Stakeholders need to be confident that you did things the right way so that they can be confident in your results (good lab practices)</li>
      <li>Need to be able to re-do your analyses (trust, but verify)</li>
      <li>You (and others) need to be able to re-use your data, software, and reports instead of constantly rewriting</li>
    </ul>
  </li>
  <li>We will cover:
    <ul>
      <li>Writing code that is readable, testable, and maintainable</li>
      <li>Automating analyses with build tools</li>
      <li>Checking and demonstrating correctness via automated tests</li>
      <li>Publishing science in the 21st Century</li>
      <li>Using a branch-per-feature workflow, rebasing, and tags to manage work</li>
      <li>Organizing the code, data, results, and reports in a small or medium-sized project</li>
    </ul>
  </li>
  <li>Prerequisites
    <ul>
      <li>Python: lists, loops, conditionals, functions, importing and using libraries</li>
      <li>Unix shell: paths, editing/renaming/deleting files, wildcards, redirection, pipes and filters, shell scripts</li>
      <li>Git: add/commit, log, merge, resolving conflicts, push, pull</li>
      <li>The <a href="http://software-carpentry.org">Software Carpentry</a> lessons cover these topics</li>
    </ul>
  </li>
</ul>

<p>These lessons can be used for self-study by people who plan to enroll in
something like the <a href="https://www.insightdatascience.com/">Insight Data Science</a> Fellows Program,
or as part of a one-semester course for graduate students or senior undergraduates.</p>

<h2 id="s:intro-example">Running Example</h2>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Zipf%27s_law">Zipf’s Law</a>: frequency of a word is inversely proportional to rank
    <ul>
      <li>I.e., second most common word occurs half as often as most common, third most common a third as often, etc.</li>
    </ul>
  </li>
  <li>We want to test books against this distribution</li>
</ul>

<h2 id="s:intro-done">What Does ‘Done’ Look Like?</h2>

<ol>
  <li>Analysts are reasonably confident that results are correct.
    <ul>
      <li>Not the same as “absolutely sure”.</li>
      <li>As trustworthy as lab experiments or careful manual analysis.</li>
    </ul>
  </li>
  <li>Software can be used by people other than original authors without heroic effort.
    <ul>
      <li>I.e., people other than the authors can figure it out and use it in less time than it would take to write their own.</li>
    </ul>
  </li>
  <li>Small changes and extensions are easy.
    <ul>
      <li>So that the software can be re-used as problems and questions evolve.</li>
    </ul>
  </li>
</ol>

<h2 id="s:intro-sources">Sources</h2>

<ul>
  <li>“A Quick Guide to Organizing Computational Biology Projects” [<a href="#Nobl2009">Nobl2009</a>]</li>
  <li>“Ten Simple Rules for Making Research Software More Robust” [<a href="#Tasc2017">Tasc2017</a>]</li>
  <li>“Best Practices for Scientific Computing” [<a href="#Wils2014">Wils2014</a>]</li>
  <li>“Good Enough Practices in Scientific Computing” [<a href="#Wils2017">Wils2017</a>]</li>
  <li><em>Teaching Tech Together</em> [<a href="#Wils2018">Wils2018</a>]</li>
</ul>

<h2 id="s:intro-contrib">Contributing</h2>

<p>Contributions of all kinds are welcome, from errata and minor
improvements to entirely new sections and chapters. All proposed
contributions will be managed in the same way as edits to Wikipedia or
patches to open source software, and all contributors will be credited
for their work each time a new version is released.  please file an
issue in our <a href="https://github.com/merely-useful/still-magic/">GitHub repository</a> or <a href="mailto:gvwilson@third-bit.com">email the author
directly</a>.  Please note that all contributors
are required to abide by our code of conduct ((s:conduct)[#APPENDIX]).</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Research is ‘open’ if everyone can read it, ‘reproducible’ if people who have access can regenerate it, and ‘competent’ if it was built in reasonable time and without heroic effort.
</li><li>Computational competence is the digital equivalent of knowing how to use lab equipment properly.
</li><li>A project is ‘done’ when stakeholders can be reasonably sure the results are correct and the software can be understood, run, and extended by people other than the original authors without heroic effort.
</li>
  </ul>
</div>


          

          <h1 id="s:automate">Automating Analyses</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can I make my analyses easier to reproduce?
</li><li>How can I make it easier to repeat analyses when I get new data, or when my data or scripts change?
</li>
  </ul>
</div>


          <ul>
  <li>Zipf’s Law: each book is in <code class="highlighter-rouge">raw/title.txt</code></li>
  <li>Use <code class="highlighter-rouge">bin/countwords.py</code> to produce <code class="highlighter-rouge">results/title.csv</code>
    <ul>
      <li>Each row is rank, word, number of occurrences</li>
    </ul>
  </li>
  <li>Use <code class="highlighter-rouge">bin/plotcounts.py</code> to visualize counts</li>
  <li>Use <code class="highlighter-rouge">bin/testfit.py</code> to compare actual distributions against expectations</li>
  <li>Can also use <code class="highlighter-rouge">bin/countwords.py</code> to analyze multiple files, then plot and test aggregate results</li>
  <li>Common workflow:
    <ul>
      <li>Analyze one input file to create one output file</li>
      <li>Write the analysis results to a new file</li>
      <li>Analyze multiple input files to create an aggregate output file</li>
      <li>Plot individual and aggregate analyses</li>
      <li>Test individual and aggregate data statistically</li>
    </ul>
  </li>
  <li>Easy to do this for a handful of files
    <ul>
      <li>But also easy to get wrong</li>
      <li>Becomes tedious and error-prone as the number of files grows</li>
    </ul>
  </li>
  <li>Can write a shell script or another Python program to do the analysis
    <ul>
      <li>Explicitly documents the pipeline so that our colleagues (and future selves) can understand it</li>
      <li>Enables us to re-do the entire analysis with a single command
if we change methods, parameters, libraries, etc.</li>
      <li>Prevents us from making lots of little errors -
no guarantee we’ll get the script right the first time,
but once we’ve fixed it,
it will stay fixed.</li>
    </ul>
  </li>
  <li>But it’s inefficient
    <ul>
      <li>Re-analyze all individual files whenever a new file is added</li>
      <li>Regenerate all plots, even for data sets (files) that haven’t changed</li>
      <li>Not a problem when computation is fast, but many computations aren’t</li>
    </ul>
  </li>
  <li>What we want is a way to describe:
    <ul>
      <li>Which files depend on which other files</li>
      <li>How to generate or update a file when necessary</li>
    </ul>
  </li>
  <li>This is the job of a <a href="#g:build-tool">build tool</a>
    <ul>
      <li>So-called because it builds new files out of old ones</li>
    </ul>
  </li>
  <li>Most widely used build tool is <a href="https://www.gnu.org/software/make/">Make</a>
    <ul>
      <li>First written in 1976 to recompile programs (which at the time was a slow process)</li>
      <li><a href="https://en.wikipedia.org/wiki/List_of_build_automation_software">Many better tools</a> have been developed since, but none has been as widely adopted</li>
      <li>In particular, <a href="https://snakemake.readthedocs.io/">Snakemake</a> has a lot of fans, and a future version of this tutorial might well use it</li>
    </ul>
  </li>
  <li>Make uses:
    <ul>
      <li><a href="#g:timestamp">Timestamps</a> on files to determine what’s out of date</li>
      <li>Shell commands to create or update files</li>
      <li>Reliance on shell commands is a reason for its longevity: Make can run pretty much any command</li>
    </ul>
  </li>
  <li><a href="http://www.gnu.org/software/make/">GNU Make</a> is a free, fast, and well-documented implementation of Make</li>
  <li>This introduction based on:
    <ul>
      <li>The <a href="https://github.com/swcarpentry/make-novice">Software Carpentry lesson on Make</a> maintained by <a href="https://github.com/gcapes">Gerard Capes</a></li>
      <li><a href="https://www.dursi.ca/">Jonathan Dursi</a>’s <a href="https://github.com/ljdursi/make_pattern_rules">introduction to pattern rules</a></li>
    </ul>
  </li>
</ul>

<h2 id="s:automate-first">How Can I Update a File When Things It Depends On Change?</h2>

<ul>
  <li>Create a file called <code class="highlighter-rouge">Makefile</code> containing the following:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate data for "Moby Dick"
results/moby-dick.csv : raw/moby-dick.txt
        python bin/countwords.py raw/moby-dick.txt results/moby-dick.csv
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">#</code> starts a comment, which runs to the end of a line (just as it does in Python)</li>
  <li><code class="highlighter-rouge">results/moby-dick.csv</code> is the <a href="#g:make-target">target</a> of a <a href="#g:make-rule">rule</a>
    <ul>
      <li>I.e., something that may need to be created or updated</li>
      <li>Every rule has one or more targets</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">raw/moby-dick.txt</code> is a <a href="#g:make-dependency">dependency</a> in that rule
    <ul>
      <li>I.e., a file that some other file depends on</li>
      <li>A rule can have zero or more dependencies</li>
    </ul>
  </li>
  <li>A colon separates targets from dependencies</li>
  <li><code class="highlighter-rouge">python bin/countwords.py raw/moby-dick.txt results/moby-dick.csv</code>
is an <a href="#g:make-action">action</a> that creates or updates the target when it is out of date
    <ul>
      <li>A rule can have zero or more actions</li>
    </ul>
  </li>
  <li>Actions are indented by a single tab character
    <ul>
      <li>A legacy of Make’s distant origins</li>
    </ul>
  </li>
  <li>Together, this tells Make when and how to re-create <code class="highlighter-rouge">results/moby-dick.csv</code></li>
  <li>To test creation:
    <ul>
      <li>Delete <code class="highlighter-rouge">results/moby-dick.csv</code> and type <code class="highlighter-rouge">make</code></li>
      <li>Make automatically reads commands from <code class="highlighter-rouge">Makefile</code> and runs the action</li>
    </ul>
  </li>
  <li>To test update:
    <ul>
      <li>Use <code class="highlighter-rouge">touch raw/moby-dick.txt</code> to update the timetamp on the input file</li>
      <li>Run <code class="highlighter-rouge">make</code>: sure enough, <code class="highlighter-rouge">results/moby-dick.csv</code> is updated</li>
    </ul>
  </li>
  <li>Might get an error message if <code class="highlighter-rouge">Makefile</code> contains spaces instead of tabs for indent:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Makefile:3: *** missing separator.  Stop.
</code></pre>
</div>

<ul>
  <li>Don’t have to call the instructions <code class="highlighter-rouge">Makefile</code></li>
  <li>Rename the file <code class="highlighter-rouge">pipeline.mk</code></li>
  <li>Run <code class="highlighter-rouge">make -f pipeline.mk</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>make: `results/moby-dick.csv' is up to date.
</code></pre>
</div>

<ul>
  <li>Means our target does not need any work</li>
  <li>Use <code class="highlighter-rouge">ls -l -t</code> to list files most recently changed first, with timestamps</li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for first Makefile</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for first Makefile</p>

<h2 id="s:automate-extend">How Can I Update Multiple Files When Their Dependencies Change?</h2>

<ul>
  <li>Add another rule to the end of <code class="highlighter-rouge">pipeline.mk</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate data for "Jane Eyre"
results/jane-eyre.csv : raw/jane-eyre.txt
        python bin/countwords.py raw/jane-eyre.txt results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>Run <code class="highlighter-rouge">make -f pipeline.mk</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>make: `results/moby-dick.csv' is up to date.
</code></pre>
</div>

<ul>
  <li>Nothing happens because Make attempts to build the first target it finds in <code class="highlighter-rouge">project.mk</code>
    <ul>
      <li>Called the <a href="#g:default-target">default target</a></li>
    </ul>
  </li>
  <li>Need to tell Make to build <code class="highlighter-rouge">results/jane-eyre.csv</code>:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f project.mk results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>Now Make runs:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>python bin/countwords.py raw/jane-eyre.txt results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>Note the difference between “up to date” and “nothing to be done”
    <ul>
      <li>If we ask Make to build a file that already exists and is up to date,
Make tells us it is up to date</li>
      <li>If we ask Make to build a file that exists but for which there is no rule,
it tells us “Nothing to be done”</li>
      <li>Get the latter message when there is a rule with no actions</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for extending the Make pipeline</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for extending the Make pipeline</p>

<h2 id="s:automate-phony">How Can I Clean Up Temporary Files That I Don’t Need?</h2>

<ul>
  <li>Add another target to <code class="highlighter-rouge">pipeline.mk</code> to delete all generated files
    <ul>
      <li>By convention, this target is called <code class="highlighter-rouge">clean</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Remove all generated files.
clean :
        rm -f results/*.csv
</code></pre>
</div>

<ul>
  <li>A <a href="#g:phony-target">phony target</a>: doesn’t correspond to any files
    <ul>
      <li>Also doesn’t have any dependencies</li>
      <li>Just a way to save useful commands in a Makefile</li>
    </ul>
  </li>
  <li>Use it with:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk clean
</code></pre>
</div>

<ul>
  <li>Phony targets are useful as a way of documenting actions in a project</li>
  <li>But there’s a catch
    <ul>
      <li>Create a directory called <code class="highlighter-rouge">clean</code></li>
      <li>Run <code class="highlighter-rouge">make -f pipeline.mk clean</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>make: `clean' is up to date.
</code></pre>
</div>

<ul>
  <li>Make finds something called <code class="highlighter-rouge">clean</code> and assumes that’s what the rule is referring to
    <ul>
      <li>Since the rule has no dependencies, it can’t be out of date</li>
      <li>So no actions are executed</li>
    </ul>
  </li>
  <li>Solution #1: don’t have phony targets with the same names as files or directories</li>
  <li>Solution #2: tell Make that the target is phony by putting this at the top of <code class="highlighter-rouge">pipeline.mk</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>.PHONY : clean
</code></pre>
</div>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for phony targets</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for phony targets</p>

<h2 id="s:automate-chain">How Can I Make One Update Depend On Another?</h2>

<ul>
  <li>To re-make all the results files, provide multiple targets on the command line:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk results/moby-dick.csv results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>This requires users to know what files they might want to create</li>
  <li>Better approach: create a phony target that rebuilds all the output files
    <ul>
      <li>And make it the first rule in the file so that it is the default</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Phony targets.
.PHONY : clean everything

# Regenerate all results.
everything : results/moby-dick.csv results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>Now run <code class="highlighter-rouge">make -f pipeline.mk</code>
    <ul>
      <li>Make reads rules from <code class="highlighter-rouge">pipeline.mk</code></li>
      <li>Uses the rule for <code class="highlighter-rouge">everything</code> as its default</li>
      <li><code class="highlighter-rouge">everything</code> is only “up to date” if the two CSV files are up to date</li>
      <li>So Make looks in <code class="highlighter-rouge">pipeline.mk</code> for a rule for each</li>
      <li>And runs each of those rules</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">pipeline.mk</code> now looks like this:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Phony targets.
.PHONY : clean everything

# Regenerate all results.
everything : results/moby-dick.csv results/jane-eyre.csv

# Regenerate data for "Moby Dick"
results/moby-dick.csv : raw/moby-dick.txt
        python bin/countwords.py raw/moby-dick.txt results/moby-dick.csv

# Regenerate data for "Jane Eyre"
results/jane-eyre.csv : raw/jane-eyre.txt
        python bin/countwords.py raw/jane-eyre.txt results/jane-eyre.csv

# Remove all generated files.
clean :
        rm -f results/*.csv
</code></pre>
</div>

<ul>
  <li>We can draw the dependencies as a <a href="#g:dependency-graph">dependency graph</a>:
    <ul>
      <li>Arrows show what each target depends on</li>
    </ul>
  </li>
  <li>Note: no guarantee of order when the graph is executed
    <ul>
      <li>Make can rebuild either results file first</li>
    </ul>
  </li>
</ul>

<p>FIXME: dependency graph</p>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for chaining dependencies</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: exercises for chaining dependencies</p>

<h2 id="s:automate-automatic">How Can I Abbreviate My Update Rules?</h2>

<ul>
  <li>Add a third book to <code class="highlighter-rouge">pipeline.mk</code>, then a fourth
    <ul>
      <li>Lots of duplication, which means lots of future maintenance effort</li>
    </ul>
  </li>
  <li>Make lets us write <a href="#g:pattern-rule">pattern rules</a> to express general ideas</li>
  <li>In order to use these, we first need to use <a href="#g:automatic-variable">automatic variables</a></li>
  <li>Step 1: don’t duplicate the target filename</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate data for "Moby Dick"
results/moby-dick.csv : raw/moby-dick.txt
        python bin/countwords.py raw/moby-dick.txt $@
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">$@</code> means “the target of the current rule”
    <ul>
      <li>Cryptic name is unfortunate, but we’re stuck with it</li>
    </ul>
  </li>
  <li>Step 2: replace the dependencies in the action with <code class="highlighter-rouge">$^</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate data for "Moby Dick"
results/moby-dick.csv : raw/moby-dick.txt
        python bin/countwords.py $^ $@
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">$^</code> is another automatic variable meaning “all the dependencies of the current rule”</li>
  <li>What if we want to regenerate results when our script changes?
    <ul>
      <li>Make the result depend on the script</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate data for "Moby Dick" - WRONG
results/moby-dick.csv : raw/moby-dick.txt bin/countwords.py
        python bin/countwords.py $^ $@
</code></pre>
</div>

<ul>
  <li>Doesn’t do the right thing, since the action expands to:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>python bin/countwords.py raw/moby-dick.txt bin/countwords.py results/moby-dick.csv
</code></pre>
</div>

<ul>
  <li>Make helpfully provides another automatic variable <code class="highlighter-rouge">$&lt;</code> meaning “the first dependency”</li>
  <li>Rewrite our improved rule like this:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate data for "Moby Dick" - RIGHT
results/moby-dick.csv : raw/moby-dick.txt bin/countwords.py
        python bin/countwords.py $^ $&lt;
</code></pre>
</div>

<h3 id="common-problems-4">Common Problems</h3>

<p>FIXME: common problems for automatic variables</p>

<h3 id="exercises-4">Exercises</h3>

<p>FIXME: exercises for automatic variables</p>

<h2 id="s:automate-pattern">How Can I Write One Rule To Update Many Different Files in the Same Way?</h2>

<ul>
  <li>We can now replace the repeated rules for results files with one <a href="#g:pattern-rule">pattern rule</a></li>
  <li>Use <code class="highlighter-rouge">%</code> as a <a href="#g:wildcard">wildcard</a> on the left and right sides</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>results/%.csv : raw/%.txt bin/countwords.py
        python bin/countwords.py $&lt; $@
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">%</code> cannot be used in actions, which is why <code class="highlighter-rouge">$&lt;</code> and <code class="highlighter-rouge">$@</code> are needed</li>
  <li><code class="highlighter-rouge">pipeline.mk</code> is now:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Phony targets.
.PHONY : clean everything

# Regenerate all results.
everything : results/moby-dick.csv results/jane-eyre.csv

# Regenerate data for a single book.
results/%.csv : raw/%.txt bin/countwords.py
        python bin/countwords.py $&lt; $@

# Remove all generated files.
clean :
        rm -f results/*.csv
</code></pre>
</div>

<ul>
  <li>Clean and build:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk clean
$ make -f pipeline.mk everything
</code></pre>
</div>

<ul>
  <li>Output is:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>rm -f results/*.csv
python bin/countwords.py raw/moby-dick.csv results/moby-dick.txt
python bin/countwords.py raw/jane-eyre.csv results/jane-eyre.txt
</code></pre>
</div>

<ul>
  <li>Can still rebuild individual files:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk results/jane-eyre.txt
</code></pre>
</div>

<h3 id="common-problems-5">Common Problems</h3>

<p>FIXME: common problems for pattern rules</p>

<h3 id="exercises-5">Exercises</h3>

<p>FIXME: exercises for pattern rules</p>

<h2 id="s:automate-variables">How Can I Define Sets of Files Automatically?</h2>

<ul>
  <li>Our automated build is still not fully automated
    <ul>
      <li>If we add another book to <code class="highlighter-rouge">raw</code>, we have to remember to also add it to <code class="highlighter-rouge">pipeline.mk</code></li>
    </ul>
  </li>
  <li>Fix this in steps</li>
  <li>Step 1: define a variable of our own for the list of files we want to generate
    <ul>
      <li>Put the definition near the top of the file to make it easy to find</li>
      <li>Variables don’t have to be in ALL CAPS, but it’s conventional</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>RESULTS = results/moby-dick.csv results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>Step 2: change the <code class="highlighter-rouge">everything</code> target to depend on these files</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Regenerate all results.
everything : ${RESULTS}
</code></pre>
</div>

<ul>
  <li>We use a variable by putting its name in <code class="highlighter-rouge">${...}</code>
    <ul>
      <li>If we just use <code class="highlighter-rouge">$NAME</code>, as we do with the shell,
Make interprets this as a variable called <code class="highlighter-rouge">$N</code> followed by the literal characters <code class="highlighter-rouge">"AME"</code></li>
      <li>Another leftover from the 1970s</li>
    </ul>
  </li>
  <li>Step 3: test the change</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk clean
$ make -f pipeline.mk everything
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>rm -f results/*.csv
python bin/countwords.py raw/moby-dick.csv results/moby-dick.txt
python bin/countwords.py raw/jane-eyre.csv results/jane-eyre.txt
</code></pre>
</div>

<ul>
  <li>But how is this better?  We still have to remember to add a file’s name to this list</li>
  <li>Or we can get Make to generate the list for us</li>
  <li>Step 4: define a variable using a <a href="#g:make-function">function</a>
    <ul>
      <li>The syntax is a bit ugly, because functions were added to Make long after it was first created</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>RAW = $(wildcard raw/*.txt)
</code></pre>
</div>

<ul>
  <li>This calls the function <code class="highlighter-rouge">wildcard</code> with the argument <code class="highlighter-rouge">raw/*.txt</code></li>
  <li>Result is a list of all the text files in the <code class="highlighter-rouge">raw</code> directory</li>
  <li>To check, add another phony target to the end of the file called <code class="highlighter-rouge">settings</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean everything settings</span>

<span class="err">...</span>

<span class="nl">settings </span><span class="o">:</span>
        <span class="nl">echo RAW</span><span class="o">:</span> <span class="nf">${RAW}</span>
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">echo</code> is a shell command that simply prints its arguments</li>
  <li>Running this gives:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk settings
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>echo RAW: raw/moby-dick.txt raw/jane-eyre.txt
RAW: raw/moby-dick.txt raw/jane-eyre.txt
</code></pre>
</div>

<ul>
  <li>Output appears twice because Make shows us the command, then runs it</li>
  <li>If we put <code class="highlighter-rouge">@</code> before the command, Make doesn’t show it before running it</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>settings :
        @echo RAW: ${RAW}
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk settings
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>RAW: raw/moby-dick.txt raw/jane-eyre.txt
</code></pre>
</div>

<ul>
  <li>Step 5: generate the list of desired output files from the list of input files
    <ul>
      <li>Use the same kind of patterns used in rules themselves with a function called <code class="highlighter-rouge">patsubst</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>RESULTS = $(patsubst raw/%.txt,results/%.csv,${RAW})
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">$(patsubst ...)</code> calls the pattern substitution function</li>
  <li>First argument is what to look for
    <ul>
      <li>In this case, a text file in the <code class="highlighter-rouge">raw</code> directory</li>
      <li><code class="highlighter-rouge">%</code> matches the <a href="#g:filename-stem">stem</a> of the file’s name, which is the part we want to keep</li>
    </ul>
  </li>
  <li>Second argument is what to replace matches with
    <ul>
      <li>Keep the stem, but create a CSV file in the <code class="highlighter-rouge">results</code> directory</li>
    </ul>
  </li>
  <li>Third argument is the list to look in
    <ul>
      <li>In this case, the list of raw filenames</li>
    </ul>
  </li>
  <li>Check that this has worked by adding to the <code class="highlighter-rouge">settings</code> target</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>settings :
        @echo RAW: ${RAW}
        @echo RESULTS: ${RESULTS}
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk settings
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>RAW: raw/moby-dick.txt raw/jane-eyre.txt
RESULTS: results/moby-dick.csv results/jane-eyre.csv
</code></pre>
</div>

<ul>
  <li>Step 6: test</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk clean
$ make -f pipeline.mk everything
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>rm -f results/*.csv
python bin/countwords.py raw/moby-dick.csv results/moby-dick.txt
python bin/countwords.py raw/jane-eyre.csv results/jane-eyre.txt
</code></pre>
</div>

<ul>
  <li>Step 7: add another source file and see what happens
    <ul>
      <li>If we’ve done everything right, Make will automatically generate the results file for it</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cp /tmp/life-of-frederick-douglass.txt raw
$ make -f pipeline.mk
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>python bin/countwords.py raw/life-of-frederick-douglass.csv results/life-of-frederick-douglass.txt
</code></pre>
</div>

<ul>
  <li>And there we have it: a fully automated, reproducible data analysis pipeline</li>
</ul>

<h3 id="common-problems-6">Common Problems</h3>

<p>FIXME: common problems for using variables in Make</p>

<h3 id="exercises-6">Exercises</h3>

<p>FIXME: exercises for using variables in Make</p>

<h2 id="s:automate-doc">How Can I Document My Update Rules?</h2>

<ul>
  <li>Every well-behaved program can print a help message</li>
  <li><code class="highlighter-rouge">make --help</code> shows help for Make itself, not for our Makefile</li>
  <li>Option 1: provide a special target like <code class="highlighter-rouge">settings</code> to print available targets</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean everything help settings</span>

<span class="err">...</span>

<span class="nl">help </span><span class="o">:</span>
        <span class="nl">@echo "everything</span><span class="o">:</span> <span class="nf">rebuild all results"</span>
        <span class="nl">@echo "clean</span><span class="o">:</span> <span class="nf">remove all generated files"</span>
        <span class="nl">@echo "help</span><span class="o">:</span> <span class="nf">show available targets"</span>
        <span class="nl">@echo "settings</span><span class="o">:</span> <span class="nf">show variable values"</span>
</code></pre>
</div>

<ul>
  <li>This is easy to set up and does the job, but once again:
    <ul>
      <li>Redundancy: this information ought to appear as a comment on each rule as well</li>
      <li>Relies on human memory: author has to remember to update <code class="highlighter-rouge">help</code> when adding or changing rules</li>
    </ul>
  </li>
  <li>A better way:
    <ul>
      <li>Format some comments specially</li>
      <li>Extract and print only those comments</li>
    </ul>
  </li>
  <li>Use <code class="highlighter-rouge">grep</code> to find these special comments and print those lines</li>
  <li>Step 1: decide how to mark the comments we want to extract
    <ul>
      <li>By convention, use <code class="highlighter-rouge">##</code> instead of a single <code class="highlighter-rouge">#</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Phony targets.
.PHONY : clean everything settings

# Define input and output files.
RAW = $(wildcard raw/*.txt)
RESULTS = $(patsubst raw/%.txt,results/%.csv,${RAW})

## everything: regenerate all results.
everything : ${RESULTS}

# Regenerate data for a single book.
results/%.csv : raw/%.txt
        python bin/countwords.py $&lt; $@

## clean: remove all generated files.
clean :
        @rm -f ${RESULTS}

## settings: show variable values
settings :
        @echo RAW: ${RAW}
        @echo RESULTS: ${RESULTS}
</code></pre>
</div>

<ul>
  <li>Step 2: add a rule to find and print these lines</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>.PHONY : clean everything settings

...

## help: show available targets
help :
        @grep -e '##' pipeline.mk
</code></pre>
</div>

<ul>
  <li>Step 3: test</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk help
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>## everything: regenerate all results.
## clean: remove all generated files.
## settings: show variable values
## help: show available targets
</code></pre>
</div>

<ul>
  <li>That’s <em>almost</em> what we want</li>
  <li>Can get rid of the leading <code class="highlighter-rouge">##</code> markers by using the venerable Unix stream editor <code class="highlighter-rouge">sed</code> instead of <code class="highlighter-rouge">grep</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>help :
        @sed -n -e 's/## //p' pipeline.mk
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ make -f pipeline.mk help
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>everything: regenerate all results.
clean: remove all generated files.
settings: show variable values
help: show available targets
</code></pre>
</div>

<ul>
  <li>Taking the <code class="highlighter-rouge">sed</code> command apart:
    <ul>
      <li><code class="highlighter-rouge">-n</code> means “do not print every line” (default is to do so)</li>
      <li><code class="highlighter-rouge">-e</code> means “here’s the expression to match”</li>
      <li>The <code class="highlighter-rouge">s</code> and <code class="highlighter-rouge">p</code> in <code class="highlighter-rouge">'s/## //p'</code> mean “search for lines that match this pattern and print them”</li>
      <li>The pattern <code class="highlighter-rouge">/## //</code> means “find two #’s followed by a space and replace them with nothing (i.e., delete them)”</li>
    </ul>
  </li>
  <li>None of this is part of Make, so most people simply copy this rule from file to file</li>
</ul>

<h3 id="common-problems-7">Common Problems</h3>

<p>FIXME: common problems for documenting Makefiles</p>

<h3 id="exercises-7">Exercises</h3>

<p>FIXME: exercises for documenting Makefiles</p>

<h2 id="s:automate-summary">Summary</h2>

<figure>
  <figcaption>Make Concept Map</figcaption>
  <img id="f:automate-concept" src="../../files/automate.svg" alt="Make Concept Map" />
</figure>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>A build tool re-runs commands to bring files up to date with respect to the things they depend on.
</li><li>Make is a widely-used build tool that uses files’ timestamps to find out-of-date dependencies.
</li><li>A Make rule has targets, dependencies, and actions.
</li><li>A target can correspond to a file or be a phony target (used simply to trigger actions).
</li><li>When a target is out of date with respect to its dependencies, Make executes the actions associated with its rule.
</li><li>Make executes as many rules as it needs to when updating files, but always respect depdendency order.
</li><li>Make defines the automatic variables <code class="highlighter-rouge">$@</code> (target), <code class="highlighter-rouge">$^</code> (all dependencies), and <code class="highlighter-rouge">$&lt;</code> (first dependency).
</li><li>Pattern rules can use <code class="highlighter-rouge">%</code> as a placeholder for parts of filenames.
</li><li>Makefiles can define variables using <code class="highlighter-rouge">NAME=value</code>.
</li><li>Makefiles can also use functions such as <code class="highlighter-rouge">$(wildcard ...)</code> and <code class="highlighter-rouge">$(patsubst ...)</code>.
</li><li>Specially-formatted comments can be used to make Makefiles self-documenting.
</li>
  </ul>
</div>


          

          <h1 id="s:unit">Unit Testing</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How should I write tests for my software?
</li><li>How can I tell how much testing I’ve actually done?
</li>
  </ul>
</div>


          <ul>
  <li><a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">Term frequency-inverse document frequency</a> (TF-IDF) is a way to determine how relevant a document is in a search
    <ul>
      <li>Term frequency: (# occurrences of word) / (# words in document)</li>
      <li>Inverse document frequency: (# documents) / (# documents in which word occurs)</li>
      <li>If a word is very common in one document, but absent in others, TF-IDF is high for that (word, document) pair</li>
      <li>If a word is common in all documents, or if a word is rare in a document, TF-IDF is lower</li>
    </ul>
  </li>
  <li>Depends on counting words in a document
    <ul>
      <li>While ignoring leading/trailing punctuation</li>
      <li>Except for words like “Ph.D.”</li>
      <li>And what to do about hyphenation?</li>
    </ul>
  </li>
  <li>Goals for testing:
    <ul>
      <li>Make it easy for people to write tests (because otherwise they won’t do it)</li>
      <li>Run a set of tests</li>
      <li>Report which ones have failed</li>
      <li>Give some idea of where or why they failed (to help debugging)</li>
      <li>Give some idea of whether any results have changed since the last run</li>
      <li>Give people a clear idea of what our definition of correct and our <a href="#g:tolerance">tolerances</a> are</li>
    </ul>
  </li>
  <li>This introduction is based in part on <a href="https://github.com/katyhuff/python-testing">Testing and Continuous Integration with Python</a> by <a href="http://katyhuff.github.io/">Katy Huff</a></li>
</ul>

<h2 id="s:unit-own">What Does a Systematic Software Testing Framework Look Like?</h2>

<ul>
  <li>A test that checks one thing is called a <a href="#g:unit-test">unit test</a></li>
  <li>A tool that finds and runs unit tests and reports their results is called a <a href="#g:test-runner">test runner</a></li>
  <li>A single test can have one of three outcomes:
    <ul>
      <li>Pass: everything worked as expected</li>
      <li>Fail: something went wrong in the software being tested</li>
      <li>Error: something went wrong in the test itself (so we don’t know anything about the software being tested)</li>
    </ul>
  </li>
  <li>A <a href="#g:fixture">fixture</a> is what the test is run on, e.g., the input data</li>
  <li>Good tests are independent
    <ul>
      <li>Should produce the same results no matter what order they are run in</li>
      <li>Which means that each test starts from a freshly-generated fixture rather than using the output of previous tests</li>
      <li>Otherwise a failure in one test can cause false positives or false negatives in subsequent tests</li>
    </ul>
  </li>
  <li>Roll our own</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">TESTS</span> <span class="o">=</span> <span class="p">[</span>
   <span class="p">[</span><span class="s">'word'</span><span class="p">,</span> <span class="p">{</span><span class="s">'word'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}],</span>
   <span class="p">[</span><span class="s">'word word'</span><span class="p">,</span> <span class="p">{</span><span class="s">'word'</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}],</span>
   <span class="p">[</span><span class="s">'another word'</span><span class="p">,</span> <span class="p">{</span><span class="s">'another'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'word'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}],</span>
   <span class="p">[</span><span class="s">"anothers' word"</span><span class="p">,</span> <span class="p">{</span><span class="s">'anothers'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'word'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">]</span>

<span class="k">pass</span> <span class="o">=</span> <span class="n">fail</span> <span class="o">=</span> <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">fixture</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TESTS</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">count_words</span><span class="p">(</span><span class="n">fixture</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">:</span>
            <span class="k">pass</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fail</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="s">'pass {} fail {} error {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="k">pass</span><span class="p">,</span> <span class="n">fail</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
</code></pre>
</div>

<ul>
  <li>This works</li>
  <li>But what if test fixtures take several lines to construct?</li>
  <li>Or checking result is complex?</li>
  <li>Or we have tests split across multiple files?</li>
  <li>Or…</li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for writing our own unit test harness</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for writing our own unit test harness</p>

<h2 id="s:unit-pytest">How Can I Use a Standard Software Testing Framework?</h2>

<ul>
  <li>Instead, put each input-output pair in a function in <code class="highlighter-rouge">test_count.py</code></li>
  <li>Use <code class="highlighter-rouge">assert</code> to check that the output is correct</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tf_idf</span> <span class="kn">import</span> <span class="n">count_word</span>

<span class="k">def</span> <span class="nf">test_single_word</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">count_words</span><span class="p">(</span><span class="s">'word'</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s">'word'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_single_repeated_word</span><span class="p">():</span>
   <span class="k">assert</span> <span class="n">count_words</span><span class="p">(</span><span class="s">'word word'</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s">'word'</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_two_words</span><span class="p">():</span>
   <span class="k">assert</span> <span class="n">count_words</span><span class="p">(</span><span class="s">'another word'</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s">'another'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'word'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_trailing_punctuation</span><span class="p">():</span>
   <span class="k">assert</span> <span class="n">count_words</span><span class="p">(</span><span class="s">"anothers' word"</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s">'anothers'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'word'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>Note the absence of an error message in the <code class="highlighter-rouge">assert</code>
    <ul>
      <li>Name of test function is included in the output if the test fails</li>
      <li>That name should be all the documentation we need</li>
      <li>If the test is so complicated that more is needed, write a simpler test</li>
    </ul>
  </li>
  <li>Run from the command line</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pytest
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>============================= test session starts ==============================
platform darwin -- Python 3.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /Users/standage/still-magic/src/unit, inifile:
plugins: remotedata-0.2.1, openfiles-0.3.0, doctestplus-0.1.3, arraydiff-0.2
collected 4 items

test_count.py ...F                                                       [100%]

=================================== FAILURES ===================================
__________________________ test_trailing_punctuation ___________________________

    def test_trailing_punctuation():
&gt;      assert count_words("anothers' word") == {'anothers' : 1, 'word' : 1}
E      assert {"anothers'": 1, 'word': 1} == {'anothers': 1, 'word': 1}
E        Omitting 1 identical items, use -vv to show
E        Left contains more items:
E        {"anothers'": 1}
E        Right contains more items:
E        {'anothers': 1}
E        Use -v to get the full diff

test_count.py:13: AssertionError
====================== 1 failed, 3 passed in 0.05 seconds ======================
</code></pre>
</div>

<ul>
  <li>Searches for all files named <code class="highlighter-rouge">test_*.py</code> or <code class="highlighter-rouge">*_test.py</code> in the current directory and its sub-directories
    <ul>
      <li>Can use command-line options to narrow the search, e.g., <code class="highlighter-rouge">pytest test_count.py</code></li>
    </ul>
  </li>
  <li>Runs all functions in those files whose names start with <code class="highlighter-rouge">test_</code></li>
  <li>Records pass/fail/error counts</li>
  <li>Gives us a nicely-formatted report</li>
  <li>Works the same way for everyone, so we can test without having think about <em>how</em> (only about <em>what</em>)
    <ul>
      <li>Although fitting tests into this framework sometimes requires some tricks</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for using pytest</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for using pytest</p>

<h2 id="s:unit-exception">How Can I Tell If My Software Failed As It Was Supposed To?</h2>

<ul>
  <li>Did the call fail as it was supposed to, i.e., raise the right kind of exception?
    <ul>
      <li>If not, system could produce a <a href="#g:silent-error">silent error</a></li>
    </ul>
  </li>
  <li>Many errors in production systems happen because people don’t test their error handling code [<a href="#Yuan2014">Yuan2014</a>]
    <ul>
      <li>Almost all (92%) of the catastrophic system failures are the result of
incorrect handling of non-fatal errors explicitly signaled in software.</li>
      <li>In 58% of the catastrophic failures, the underlying faults could easily have
been detected through simple testing of error handling code.</li>
      <li>A majority (77%) of the failures require more than one input event to manifest, but
most of the failures (90%) require no more than 3.</li>
    </ul>
  </li>
  <li>Can check manually:</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Expect count_words to raise ValueError for empty input.</span>
<span class="k">def</span> <span class="nf">test_text_not_empty</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">count_words</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'Should not get this far'</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre>
</div>

<ul>
  <li>Better: <code class="highlighter-rouge">pytest</code> provides a <a href="#g:context-manager">context manager</a> to handle tests for exceptions
    <ul>
      <li>Uses Python’s <code class="highlighter-rouge">with</code> keyword to create something for a particular scope</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">test_text_not_empty</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="nb">ValueError</span><span class="p">):</span>
        <span class="n">count_words</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>============================= test session starts ==============================
platform darwin -- Python 3.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /Users/gvwilson/merely-useful/still-magic/src/unit, inifile:
plugins: remotedata-0.2.1, openfiles-0.3.0, doctestplus-0.1.3, arraydiff-0.2
collected 1 item

test_exception.py F                                                      [100%]

=================================== FAILURES ===================================
_____________________________ test_text_not_empty ______________________________

    def test_text_not_empty():
        with pytest.raises(ValueError):
&gt;           count_words('')
E           Failed: DID NOT RAISE &lt;class 'ValueError'&gt;

test_exception.py:6: Failed
=========================== 1 failed in 0.04 seconds ===========================
</code></pre>
</div>

<ul>
  <li>Clearly, we have some work to do…</li>
</ul>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for testing exceptions</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for testing exceptions</p>

<h2 id="s:unit-random">How Can I Test Software That is Random or Unpredictable?</h2>

<ul>
  <li>Testing random numbers
    <ul>
      <li>Rely on the fact that they aren’t actually random</li>
      <li><em>Always</em> specify the RNG seed</li>
      <li>And <em>always</em> record it</li>
    </ul>
  </li>
  <li>Current dates and time count as randomness
    <ul>
      <li>Write your own function</li>
      <li>Replace it with another for testing purposes</li>
      <li>The replacement is called a <a href="#g:test-double">test double</a>
        <ul>
          <li>Or a mock, or a stub, or… terminology is very inconsistent</li>
        </ul>
      </li>
      <li>Or provide a way to change one function’s behavior</li>
    </ul>
  </li>
  <li>First version using the latter strategy</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># tf_idf.py</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">DAYS_PER_WEEK</span> <span class="o">=</span> <span class="mi">7</span>

<span class="n">TESTING_DATE</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">def</span> <span class="nf">weeks_since_01</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">TESTING_DATE</span>
    <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="n">current</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="n">DAYS_PER_WEEK</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>Test it</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># demo_test_weeks.py</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">tf_idf</span>

<span class="k">print</span><span class="p">(</span><span class="s">'first'</span><span class="p">,</span> <span class="n">tf_idf</span><span class="o">.</span><span class="n">weeks_since_01</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">tf_idf</span><span class="o">.</span><span class="n">TESTING_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'second'</span><span class="p">,</span> <span class="n">tf_idf</span><span class="o">.</span><span class="n">weeks_since_01</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ date
Wed 15 Aug 2018 15:14:52 EDT
$ python demo_test_weeks.py
first 2
second 4
</code></pre>
</div>

<ul>
  <li>Cleaner approach: make the test control an <a href="#g:function-attribute">attribute</a> of the function
    <ul>
      <li>Works because body of function isn’t executed as the function is defined</li>
      <li>So it’s OK to refer to values that are added afterward</li>
    </ul>
  </li>
  <li>Advantage: can import the function alone, since the extra value is attached to it</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># demo_test_weeks.py</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">tf_idf</span> <span class="kn">import</span> <span class="n">weeks_since_02</span>

<span class="k">print</span><span class="p">(</span><span class="s">'first'</span><span class="p">,</span> <span class="n">weeks_since_02</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">weeks_since_02</span><span class="o">.</span><span class="n">testing_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'second'</span><span class="p">,</span> <span class="n">weeks_since_02</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ python demo_test_weeks.py
first 2
second 4
</code></pre>
</div>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for testing randomness</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: exercises for testing randomness</p>

<h2 id="s:unit-io">How Can I Test Software That Does File I/O?</h2>

<ul>
  <li>Reading from external files isn’t so bad, but writing to temporary files is awkward
    <ul>
      <li>Scraps need to be re-read for testing and then cleaned up</li>
    </ul>
  </li>
  <li>Use <code class="highlighter-rouge">StringIO</code></li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="s">'first second third'</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'{}</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>first
second
third
</code></pre>
</div>

<ul>
  <li>And for input
    <ul>
      <li>Note: line includes trailing newline</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">DATA</span> <span class="o">=</span> <span class="s">'''first
second
third'''</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">DATA</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>6
7
5
</code></pre>
</div>

<ul>
  <li>It’s common to have a function open a file, read its contents, and return the result</li>
  <li>But this is hard to test, since there’s no easy way to substitute a <code class="highlighter-rouge">StringIO</code></li>
  <li>Reorganize software so that file opening is done separately from reading/writing
    <ul>
      <li>Good practice anyway for handling <code class="highlighter-rouge">stdin</code> and <code class="highlighter-rouge">stdout</code> in command-line tools, which don’t need to be opened</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="n">process</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">stdin</span> <span class="k">if</span> <span class="n">infile</span> <span class="o">==</span> <span class="s">'-'</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">stdout</span> <span class="k">if</span> <span class="n">outfile</span> <span class="o">==</span> <span class="s">'-'</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">process</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">infile</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span> <span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">outfile</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span> <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
</div>

<h3 id="common-problems-4">Common Problems</h3>

<p>FIXME: common problems for testing file I/O</p>

<h3 id="exercises-4">Exercises</h3>

<p>FIXME: exercises for testing file I/O</p>

<h2 id="s:unit-coverage">How Can I Tell Which Parts of My Software Have and Have Not Been Tested?</h2>

<ul>
  <li>Which lines are and aren’t being executed?</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="p">,</span> <span class="n">left</span>
    <span class="k">while</span> <span class="n">left</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">second</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">second</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">check</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">balance</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">final</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre>
</div>

<ul>
  <li><a href="#g:coverage">Coverage</a> measures which parts of program are(n’t) executed
    <ul>
      <li>In principle, keep a list of Booleans, one per line</li>
      <li>Each time the line is executed, set the flag to <code class="highlighter-rouge">True</code></li>
      <li>At the end, report <code class="highlighter-rouge">True</code> and <code class="highlighter-rouge">False</code> per line, percentages, etc.</li>
    </ul>
  </li>
  <li>Easy (and wrong) to obsess about meeting specific targets for <a href="#g:test-coverage">test coverage</a>
    <ul>
      <li>But anything that <em>isn’t</em> tested should be assumed to be wrong</li>
      <li>And drops in coverage often indicate new <a href="#g:technical-debt">technical debt</a></li>
    </ul>
  </li>
  <li>Use <code class="highlighter-rouge">pip install coverage</code> to install coverage tool</li>
  <li>Instead of <code class="highlighter-rouge">python filename.py</code> use <code class="highlighter-rouge">coverage run filename.py</code>
    <ul>
      <li>Creates a file called <code class="highlighter-rouge">.coverage</code></li>
    </ul>
  </li>
  <li>Run <code class="highlighter-rouge">coverage report</code> to get a summary of the most recent report</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Name               Stmts   Miss  Cover
--------------------------------------
demo_coverage.py      16      1    94%
</code></pre>
</div>

<ul>
  <li>Use <code class="highlighter-rouge">coverage html</code> to generate an HTML listing</li>
</ul>

<table>
  <tr>
    <td>
      1<br />
      2<br />
      3<br />
      4<br />
      5<br />
      6<br />
      7<br />
      8<br />
      9<br />
      10<br />
      11<br />
      12<br />
      <span class="coverage">13</span><br />
      14<br />
      15<br />
      16<br />
      17<br />
      18<br />
      19<br />
      20
    </td>
    <td>
      def first(left, right):<br />
      &nbsp;&nbsp;&nbsp;&nbsp;if left &lt; right:<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left, right = right, left<br />
      &nbsp;&nbsp;&nbsp;&nbsp;while left &gt; right:<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value = second(left, right)<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left, right = right, int(right/2)<br />
      &nbsp;&nbsp;&nbsp;&nbsp;return value<br />
      <br />
      def second(check, balance):<br />
      &nbsp;&nbsp;&nbsp;&nbsp;if check &gt; 0:<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return balance<br />
      &nbsp;&nbsp;&nbsp;&nbsp;else:<br />
      <span class="coverage">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
      <br />
      def main():<br />
      &nbsp;&nbsp;&nbsp;&nbsp;final = first(3, 5)<br />
      &nbsp;&nbsp;&nbsp;&nbsp;print(3, 5, final)<br />
      <br />
      if _name__ == '__main__':<br />
      &nbsp;&nbsp;&nbsp;&nbsp;main()
    </td>
  </tr>
</table>

<h3 id="common-problems-5">Common Problems</h3>

<p>FIXME: common problems for coverage</p>

<h3 id="exercises-5">Exercises</h3>

<p>FIXME: exercises for coverage</p>

<h2 id="s:unit-summary">Summary</h2>

<ul>
  <li><a href="#g:tdd">Test-driven development</a> (TDD)
    <ul>
      <li>Write a handful of tests that don’t even run because the code they
are supposed to test doesn’t exist yet.</li>
      <li>Write just enough code to make those tests pass.</li>
      <li>Clean up what’s just been written.</li>
      <li>Commit it to version control.</li>
    </ul>
  </li>
  <li>Advocates claim that writing tests first:
    <ul>
      <li>Focuses people’s minds on what code is supposed to
so that they’re not subject to confirmation bias when viewing test results</li>
      <li>Ensures that code actually <em>is</em> testable</li>
      <li>Ensures tests are actually written</li>
    </ul>
  </li>
  <li>Evidence backing these claims is contradictory
    <ul>
      <li>Empirical studies have not found a strong effect [<a href="#Fucc2016">Fucc2016</a>]</li>
      <li>But many productive programmers believe in it, so maybe we’re measuring the wrong things…</li>
    </ul>
  </li>
</ul>

<p>FIXME: create concept map for unit testing</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Testing can only ever show that software has flaws, not that it is correct.
</li><li>Its real purpose is to convince people (including yourself) that software is correct enough, and to make tolerances on ‘enough’ explicit.
</li><li>A test runner finds and runs tests written in a prescribed fashion and reports their results.
</li><li>A unit test can pass (work as expected), fail (meaning the software under test is flawed), or produce an error (meaning the test itself is flawed).
</li><li>A fixture is the data or other input that a test is run on.
</li><li>Every unit test should be independent of every other to keep results comprehensible and reliable.
</li><li>Programmers should check that their software fails when and as it is supposed to in order to avoid silent errors.
</li><li>Write test doubles to replace unpredictable inputs such as random numbers or the current date or time with a predictable value.
</li><li>Use string I/O doubles when testing file input and output.
</li><li>Use a coverage tool to check how well tests have exercised code.
</li>
  </ul>
</div>


          

          <h1 id="s:correct">Testing Data Analysis</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How should I test a data analysis pipeline?
</li>
  </ul>
</div>


          <ul>
  <li>Previous lesson explained how to test in general</li>
  <li>This lesson focuses on tests specific to data analysis pipelines
    <ul>
      <li>Run them when building the pipeline to convince ourselves the code is correct</li>
      <li>Run them in production to make sure assumptions still hold</li>
      <li>They might not because the environment might have changed</li>
    </ul>
  </li>
  <li>Different from the tests most software engineers write because you don’t always know what the right answer is
    <ul>
      <li>If you did, you would have submitted your report and moved on to the next problem</li>
    </ul>
  </li>
  <li>But there’s a close analogy with physical experiments
    <ul>
      <li>High school students should get <script type="math/tex">10 m/sec^2</script></li>
      <li>Undergraduates might get <script type="math/tex">9.8 m/sec^2</script> depending on the equipment used</li>
      <li>If any of them get <script type="math/tex">9.806 m/sec^2</script> with a stopwatch, they’re either incredibly lucky or rather foolish</li>
    </ul>
  </li>
  <li>Similarly, when testing data analysis, specify tolerances
    <ul>
      <li>Does the answer have to be exactly the same as a hand-calculated value or a previously-saved value?</li>
      <li>If not, how close is good enough?</li>
    </ul>
  </li>
  <li>Distinguish between <em>development</em> and <em>production</em>
    <ul>
      <li>During development: is this (exactly or approximately) right?</li>
      <li>In production: has behavior deviated significantly from what I previously decided was right?</li>
    </ul>
  </li>
  <li>Most of the time we calibrate estimates by checking real data, convincing ourselves it’s OK, then re-checking whenever an alarm rings
    <ul>
      <li>If you change things substantially then the mean absolute error (which is in units of your original problem) will move noticeably</li>
    </ul>
  </li>
</ul>

<h2 id="s:correct-float">Why Should I Be Cautious When Using Floating-Point Numbers?</h2>

<ul>
  <li>Finding a good representation for floating point numbers is hard.
    <ul>
      <li>We cannot represent an infinite number of real values with a finite set of bit patterns</li>
      <li>And unlike integers, no matter what values we <em>do</em> represent, there will be an infinite number of values between each of them that we can’t</li>
    </ul>
  </li>
  <li>The explanation that follows is simplified—possibly over-simplified—to keep it manageable.
    <ul>
      <li>If you want to know more, take half an hour to read [<a href="#Gold1991">Gold1991</a>]</li>
    </ul>
  </li>
  <li>Floating point numbers are usually represented using <a href="#g:sign">sign</a>, <a href="#g:magnitude">magnitude</a>, and an <a href="#g:exponent">exponent</a>.</li>
  <li>In a 32-bit word, the IEEE 754 standard calls for 1 bit of sign,
23 bits for the magnitude (or <a href="#g:mantissa">mantissa</a>),
and 8 bits for the exponent</li>
  <li>To illustrate the problems with floating point, we’ll use a much dumber representation.
    <ul>
      <li>Only use 5 bits: 3 for the magnitude and 2 for the exponent</li>
      <li>Don’t worry about fractions or signs</li>
    </ul>
  </li>
  <li>Here are the possible values (in decimal) that we can represent this way
    <ul>
      <li>For example, the decimal values 48 is binary 110 times 2 to the binary 11 power.</li>
      <li>Which is 6 times 2 to the third…</li>
      <li>…or 6 times 8.</li>
      <li>Real floating point representations don’t have all the redundancy that you see in this table, but it illustrates the point</li>
    </ul>
  </li>
</ul>

<table class="table table-striped">
  <tr>
    <th></th>
    <th colspan="4">Exponent</th>
  </tr>
  <tr>
    <th>Mantissa</th> <th>00</th> <th>01</th> <th>10</th> <th>11</th>
  </tr>
  <tr>
    <th>000</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td>
  </tr>
  <tr>
    <th>001</th> <td>1</td> <td>2</td> <td>4</td> <td>8</td>
  </tr>
  <tr>
    <th>010</th> <td>2</td> <td>4</td> <td>8</td> <td>16</td>
  </tr>
  <tr>
    <th>011</th> <td>3</td> <td>6</td> <td>12</td> <td>24</td>
  </tr>
  <tr>
    <th>100</th> <td>4</td> <td>8</td> <td>16</td> <td>32</td>
  </tr>
  <tr>
    <th>101</th> <td>5</td> <td>10</td> <td>20</td> <td>40</td>
  </tr>
  <tr>
    <th>110</th> <td>6</td> <td>12</td> <td>24</td> <td>48</td>
  </tr>
  <tr>
    <th>111</th> <td>7</td> <td>14</td> <td>28</td> <td>56</td>
  </tr>
</table>

<ul>
  <li>Here’s a clearer view of some of the values our scheme can represent:</li>
</ul>

<figure>
  <figcaption>Number Spacing</figcaption>
  <img id="f:correct-spacing" src="../../files/number-spacing.png" alt="Number Spacing" />
</figure>

<ul>
  <li>There are a lot of values we <em>can’t</em> store
    <ul>
      <li>Can do 8 and 10 but not 9</li>
      <li>Exactly like the problem writing out 1/3 in decimal: have to round that to 0.3333 or 0.3334</li>
    </ul>
  </li>
  <li>But if this scheme has no representation for 9, then 8+1 must be stored as either 8 or 10</li>
  <li>Which raises an interesting question: if 8+1 is 8, what is 8+1+1?
    <ul>
      <li>If we add from the left, 8+1 is 8, plus another 1 is 8 again</li>
      <li>If we add from the right, 1+1 is 2, and 2+8 is 10</li>
      <li>Changing the order of operations can make the difference between right and wrong</li>
    </ul>
  </li>
  <li>This is the sort of thing that numerical analysts spend their time on
    <ul>
      <li>In this case, if we sort the values and then add from smallest to largest, it gives us the best chance of getting the best answer</li>
      <li>In other situations, like inverting a matrix, the rules are more complicated</li>
      <li>Trust the authors of core libraries to get this right (just like electrical engineers trust oscilloscope makers)</li>
    </ul>
  </li>
  <li>The absolute spacing between the values we can represent is uneven
    <ul>
      <li>But the relative spacing between each set of values stays the same</li>
      <li>The first group is separated by 1, then the separation becomes 2, then 4, then 8</li>
      <li>This happens because we’re multiplying the same fixed set of mantissas by ever-larger exponents</li>
      <li>Leads to some useful definitions</li>
    </ul>
  </li>
  <li>The <a href="#g:absolute-error">absolute error</a> in some approximation to a value is the absolute value of the difference between the two</li>
  <li>The <a href="#g:relative-error">relative error</a> is the ratio of the absolute error to the value we’re approximating
    <ul>
      <li>If we are off by 1 in approximating 8+1 and 56+1, that’s the same absolute error</li>
      <li>But the relative error is larger in the first case than in the second</li>
    </ul>
  </li>
  <li>Relative error is almost always more useful than absolute
    <ul>
      <li>It makes little sense to say that we’re off by a hundredth when the value in question is a billionth</li>
    </ul>
  </li>
  <li>What does this have to do with testing?</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mf">9.0</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="o">-</span><span class="n">i</span>
    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">**</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">expected</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{:2d} {:22.21f} {:22.21f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">total</span><span class="o">-</span><span class="n">expected</span><span class="p">))</span>
</code></pre>
</div>

<ul>
  <li>Loop runs over the integers from 1 to 9 inclusive
    <ul>
      <li>Put the numbers 0.9, 0.09, 0.009, and so on in <code class="highlighter-rouge">vals</code></li>
      <li>Sum should be 0.9, 0.99, 0.999, and so on, but is it?</li>
    </ul>
  </li>
  <li>Calculate the same value a different way, by subtracting .1 from 1, then subtracting .01 from 1, and so on
    <ul>
      <li>This should create exactly the same sequence of numbers</li>
    </ul>
  </li>
</ul>

<table class="table table-striped">
  <tr> <th>index</th> <th>total</th> <th>difference</th> </tr>
  <tr> <th>1</th> <td>0.900000000000000022204</td> <td>0.000000000000000000000</td> </tr>
  <tr> <th>2</th> <td>0.989999999999999991118</td> <td>0.000000000000000000000</td> </tr>
  <tr> <th>3</th> <td>0.998999999999999999112</td> <td>0.000000000000000000000</td> </tr>
  <tr> <th>4</th> <td>0.999900000000000011013</td> <td>0.000000000000000000000</td> </tr>
  <tr> <th>5</th> <td>0.999990000000000045510</td> <td>0.000000000000000000000</td> </tr>
  <tr> <th>6</th> <td>0.999999000000000082267</td> <td>0.000000000000000111022</td> </tr>
  <tr> <th>7</th> <td>0.999999900000000052636</td> <td>0.000000000000000000000</td> </tr>
  <tr> <th>8</th> <td>0.999999990000000060775</td> <td>0.000000000000000111022</td> </tr>
  <tr> <th>9</th> <td>0.999999999000000028282</td> <td>0.000000000000000000000</td> </tr>
</table>

<ul>
  <li>The very first value contributing to our sum is already slightly off
    <ul>
      <li>Even with 23 bits for a mantissa, we cannot exactly represent 0.9 in base 2,
any more than we can exactly represent 1/3 in base 10</li>
      <li>Doubling the size of the mantissa would reduce the error, but we can’t ever eliminate it</li>
    </ul>
  </li>
  <li>The good news is, <script type="math/tex">9 {\times} 10^{-1}</script> and <script type="math/tex">1 - 0.1</script> are exactly the same
    <ul>
      <li>Might not be precisely right, but at least it’s consistent</li>
    </ul>
  </li>
  <li>But some later values differ
    <ul>
      <li>And sometimes accumulated error makes the result <em>more</em> accurate</li>
    </ul>
  </li>
  <li>Very important to note that <em>this has nothing to do with randomness</em>
    <ul>
      <li>The same calculation will produce exactly the same results no matter how many times it is run</li>
      <li>Process is completely deterministic, just hard to predict</li>
      <li>If you see someone run the same code on the same data with the same parameters many times and average the results,
you should ask if they know what they’re doing</li>
      <li>Thought it <em>can</em> be defensible if there is parallelism (which can change evaluation order)
or if you’re changing platform (e.g., moving computation to a GPU)</li>
    </ul>
  </li>
  <li>So what does this have to do with testing?
    <ul>
      <li>If the function you’re testing uses floating point numbers, what do you compare its result to?</li>
      <li>If we compared the sum of the first few numbers in <code class="highlighter-rouge">vals</code> to what it’s supposed to be, the answer could be <code class="highlighter-rouge">False</code></li>
      <li>If we compare it to a previously calculated result, the match should be exact</li>
    </ul>
  </li>
  <li>No one has a good generic answer,
because the root of our problem is that we’re using approximations,
and each approximation has to be judged on its own merits</li>
  <li>So what can you do to test your programs?</li>
  <li>If you are comparing to a saved result (and the result was saved at full precision), use equality
    <ul>
      <li>No reason for it not to be equal</li>
    </ul>
  </li>
  <li>Otherwise, use <code class="highlighter-rouge">pytest.approx</code> with a relative error rather than an absolute error
    <ul>
      <li>It works on lists, sets, arrays, and other collections</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">approx</code> can be given either relative or absolute error bounds
    <ul>
      <li>To show how it works, set an unrealistically tight absolute bound</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>

<span class="k">for</span> <span class="n">bound</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">1e-15</span><span class="p">,</span> <span class="mf">1e-16</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="mf">9.0</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="o">-</span><span class="n">i</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">**</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">!=</span> <span class="n">approx</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="n">bound</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'{:22.21f} {:2d} {:22.21f} {:22.21f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bound</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>9.999999999999999790978e-17  6 0.999999000000000082267 0.999998999999999971244
9.999999999999999790978e-17  8 0.999999990000000060775 0.999999989999999949752
</code></pre>
</div>

<ul>
  <li>So two tests pass at an absolute error of <script type="math/tex">10^{-15}</script> but fail at <script type="math/tex">10^{-16}</script></li>
  <li>Both of these bounds are unreasonably tight
    <ul>
      <li>A relative error of <script type="math/tex">10^{-3}</script> (three decimal places) is more than good enough for most data science</li>
      <li>Because the decision the human being would make won’t change if the number changes by 0.1%</li>
    </ul>
  </li>
  <li><a href="#g:accuracy">Accuracy</a> is how close your answer is to right</li>
  <li><a href="#g:precision">Precision</a> is how close repeated measurements are to each other</li>
  <li>You can be precise without being accurate (systematic bias), or accurate without being precise (near the right answer, but without many significant digits)</li>
  <li>For human decision making, accuracy is usually more important than precision</li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for testing a data analysis pipeline</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for testing a data analysis pipeline</p>

<h2 id="s:correct-plots">How Can I Test Plots and Other Graphical Results?</h2>

<ul>
  <li>Testing visualizations is hard
    <ul>
      <li>Any change to the dimension of the plot, however small, can change many pixels in a <a href="#g:raster-image">raster image</a></li>
      <li>Trivial changes (such as moving the legend up a couple of pixels) will generate false positives</li>
    </ul>
  </li>
  <li>As with floating point, the generated image should not change if nothing else has changed
    <ul>
      <li>So you should be able to do an exact match against a saved (reference) image</li>
    </ul>
  </li>
  <li>But if the image size has changed at all, or the fonts, or the color scheme, that will fail</li>
  <li><a href="https://github.com/matplotlib/pytest-mpl">pytest-mpl</a> compares the latest image against a saved reference version
    <ul>
      <li>Root mean square (RMS) difference between images must be below a threshold for the comparison to pass</li>
    </ul>
  </li>
  <li>It also allows you to turn off comparison of text, because font differences can throw up spurious failures
    <ul>
      <li>If images are close enough that a human being would make the same decision about meaning, the test should pass</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>FIXME: example
</code></pre>
</div>

<ul>
  <li>If the plotting library allows output as SVG, can test the structure of the SVG
    <ul>
      <li>SVG is a <a href="#g:vector-image">vector format</a> that uses a hierarchical document structure like HTML’s</li>
      <li>Check that the right elements are there with the right properties</li>
      <li>Although any changes to the library can invalidate all the tests because of layers being introduced, renamed, or removed</li>
    </ul>
  </li>
  <li>The best option is to test the data structures used to generate the plot and then trust the plotting library</li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for testing plotting</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for testing plotting</p>

<h2 id="s:correct-simple">How Can I Test the Steps in a Data Analysis Pipeline During Development?</h2>

<ul>
  <li>Subsampling
    <ul>
      <li>Choose random subsets of input data, do analysis, see how close output is to output with full data set</li>
      <li>If output doesn’t converge as sample size grows, something is probably unstable</li>
      <li>Which is not the same as wrong: it’s a problem with the algorithm, rather than with the implementation</li>
      <li>FIXME: add an exercise that subsamples the Zipf data</li>
    </ul>
  </li>
  <li>Test with synthesized data
    <ul>
      <li>Uniform data, i.e., same values for all observations</li>
      <li>Strictly bimodal data</li>
      <li>Data generated from known distribution</li>
    </ul>
  </li>
  <li>Example: generate distribution that conforms to Zipf’s Law and test analysis
    <ul>
      <li>Real data will be integers (since words only occur or not), and distribution is fractional</li>
      <li>Use 5% relative error (by experimentation, 1% excludes a valid correct value)</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>import sys
from pytest import approx


RELATIVE_ERROR = 0.05

    
def is_zipf(hist):
    scaled = [h/hist[0] for h in hist]
    print('scaled', scaled)
    perfect = [1/(1 + i) for i in range(len(hist))]
    print('perfect', perfect)
    return scaled == approx(perfect, rel=RELATIVE_ERROR)


def test_fit_correct():
    actual = [round(100 / (1 + i)) for i in range(10)]
    print('actual', actual)
    assert is_zipf(actual)


def test_fit_first_too_small():
    actual = [round(100 / (1 + i)) for i in range(10)]
    actual[0] /= 2
    assert not is_zipf(actual)


def test_fit_last_too_large():
    actual = [round(100 / (1 + i)) for i in range(10)]
    actual[-1] = actual[1]
    assert not is_zipf(actual)
</code></pre>
</div>

<h2 id="s:correct-operational">How Can I Check the Steps in a Data Analysis Pipeline in Production?</h2>

<ul>
  <li><a href="#g:operational-test">Operational tests</a> are ones that are kept in place during production
    <ul>
      <li>Is everything working as it should?</li>
    </ul>
  </li>
  <li>Common pattern:
    <ul>
      <li>Have every tool append information to a log</li>
      <li>Have another tool check that log file after the run is over</li>
      <li>Logging and then checking makes it easy to compare values between pipeline stages</li>
      <li><a href="#s:logging">Chapter 5</a> shows how to do logging</li>
    </ul>
  </li>
  <li>Common tests
    <ul>
      <li>Same number of output records as input records</li>
      <li>Or fewer output records than input records if you’re aggregating</li>
      <li>Or the product of the sizes of two tables if you’re joining records</li>
      <li>Standard deviation has to be smaller than the range of the data</li>
      <li>NaNs and NULLs only where you’re expecting them and handling them</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># text_to_words.py</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">num_lines</span> <span class="o">=</span> <span class="n">num_words</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">num_lines</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_punctuation</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="n">num_words</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'logfile.txt'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'text_to_words.py,num_lines,{}</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_lines</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'text_to_words.py,num_words,{}</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_words</span><span class="p">))</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># word_count.py</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">num_words</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">num_words</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">count</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">count</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{} {}'</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span><span class="p">[</span><span class="n">word</span><span class="p">])</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'logfile.txt'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'word_count.py,num_words,{}</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_words</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'word_count.py,num_distinct,{}</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>text_to_words.py,num_lines,431
text_to_words.py,num_words,2554
word_count.py,num_words,2554
word_count.py,num_distinct,1167
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># check_log.py</span>
<span class="n">data</span> <span class="o">=</span> <span class="o">...</span><span class="n">read</span> <span class="n">CSV</span> <span class="nb">file</span><span class="o">...</span>
<span class="n">check</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'text_to_words.py'</span><span class="p">][</span><span class="s">'num_lines'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">[</span><span class="s">'word_count.py'</span><span class="p">][</span><span class="s">'num_words'</span><span class="p">])</span>
<span class="n">check</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'text_to_words.py'</span><span class="p">][</span><span class="s">'num_words'</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s">'word_count.py'</span><span class="p">][</span><span class="s">'num_words'</span><span class="p">])</span>
<span class="n">check</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'word_count.py'</span><span class="p">][</span><span class="s">'num_words'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">data</span><span class="p">[</span><span class="s">'word_count.py'</span><span class="p">][</span><span class="s">'num_distinct'</span><span class="p">])</span>
</code></pre>
</div>

<ul>
  <li>Verify data against a distribution
    <ul>
      <li>E.g., <a href="https://en.wikipedia.org/wiki/Shapiro%E2%80%93Wilk_test">Shapiro-Wilk test</a> that data is normal</li>
      <li>Requires a tolerance, but again, that’s good because it forces you to make your tolerances explicit</li>
    </ul>
  </li>
  <li>Alternative: use a non-parametric test
    <ul>
      <li>Kolmogorov Smirnov test checks that an empirical distribution fits a ideal distribution</li>
      <li>Chi-square test check whether the two distributions are the same or different</li>
      <li>t-stat test is good for testing how far out of the mean something is</li>
    </ul>
  </li>
  <li>Create histogram of results for test data
    <ul>
      <li>Verify that subsequent data fits histogram</li>
      <li>Although you still have to decide what “fits” means</li>
      <li>And you have to</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">TEST_BINS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">TEST_TOLERANCE</span> <span class="o">=</span> <span class="mf">1.0e-3</span>

<span class="n">reference</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'test_reference.csv'</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">actual</span> <span class="o">=</span> <span class="o">...</span><span class="n">some</span> <span class="nb">complex</span> <span class="n">calculation</span><span class="o">...</span>
<span class="n">check</span> <span class="o">=</span> <span class="n">actual</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">TEST_BINS</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">TEST_TOLERANCE</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for operational tests</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for operational tests</p>

<h2 id="s:correct-infer">How Can I Infer and Check Properties of My Data?</h2>

<ul>
  <li>The <a href="http://www.tdda.info/">TDDA library</a> can infer test rules from data</li>
  <li><code class="highlighter-rouge">age &lt;= 100</code>, <code class="highlighter-rouge">Date</code> should be sorted ascending, <code class="highlighter-rouge">StartDate &lt;= EndDate</code>, etc.</li>
  <li>Comes with a command-line tool <code class="highlighter-rouge">tdda</code>
    <ul>
      <li><code class="highlighter-rouge">tdda discover elements92.csv elements.tdda</code> infers rules from data</li>
      <li><code class="highlighter-rouge">tdda verify elements92.csv elements.tdda</code> verifies data against those rules (should pass)</li>
    </ul>
  </li>
  <li>Inferred rules are stored as JSON, and are (sort of) readable
    <ul>
      <li>Reading and modifying the rules is a good way to get to know your data</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>"fields": {
    "Name": {
        "type": "string",
        "min_length": 3,
        "max_length": 12,
        "max_nulls": 0,
        "no_duplicates": true
    },
    "Symbol": {
        "type": "string",
        "min_length": 1,
        "max_length": 2,
        "max_nulls": 0,
        "no_duplicates": true
    },
    "ChemicalSeries": {
        "type": "string",
        "min_length": 7,
        "max_length": 20,
        "max_nulls": 0,
        "allowed_values": [
            "Actinoid",
            "Alkali metal",
            "Alkaline earth metal",
            "Halogen",
            "Lanthanoid",
            "Metalloid",
            "Noble gas",
            "Nonmetal",
            "Poor metal",
            "Transition metal"
        ]
    },
    "AtomicWeight": {
        "type": "real",
        "min": 1.007947,
        "max": 238.028913,
        "sign": "positive",
        "max_nulls": 0
    },
    ...
}
</code></pre>
</div>

<ul>
  <li>Apply these inferred rules to all elements
    <ul>
      <li><code class="highlighter-rouge">-7</code> to get pure ASCII output</li>
      <li><code class="highlighter-rouge">-f</code> to show only fields with failures</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tdda verify -7 -f elements118.csv elements92.tdda 
FIELDS:

Name: 1 failure  4 passes  type OK  min_length OK  max_length X  max_nulls OK  no_duplicates OK

Symbol: 1 failure  4 passes  type OK  min_length OK  max_length X  max_nulls OK  no_duplicates OK

AtomicWeight: 2 failures  3 passes  type OK  min OK  max X  sign OK  max_nulls X

...others...

SUMMARY:

Constraints passing: 57
Constraints failing: 15
</code></pre>
</div>

<ul>
  <li>Additional use: generate constraints for two datasets and then look at differences in constraint files
    <ul>
      <li>“Is this dataset similar to the one I tested on?”</li>
    </ul>
  </li>
  <li>Especially useful if the constraint file is put under version control</li>
</ul>

<p>inferring con### Common Problems</p>

<p>FIXME: common problems for straints</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: exercises for ### Exercises</p>

<h2 id="s:correct-summary">Summary</h2>

<p>FIXME: create concept map for correctness</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Programmers should use tolerances when comparing floating-point numbers (not just in tests).
</li><li>Test the data structures used in plotting rather than the plots themselves.
</li><li>Check that parametric or non-parametric statistics of data do not differ from saved values by more than a specified tolerance.
</li><li>Infer constraints on data and then check that subsequent data sets obey these constraints.
</li>
  </ul>
</div>


          

          <h1 id="s:logging">Logging</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How should I keep track of what I actually did?
</li><li>How can I get my software to report errors?
</li>
  </ul>
</div>


          <ul>
  <li>Programs should report things that go wrong
    <ul>
      <li>And optionally things that go right, to help track down the sources of errors</li>
    </ul>
  </li>
  <li>Adding <code class="highlighter-rouge">print</code> statements during debugging is a common approach
    <ul>
      <li>But removing or commenting out, only to add them again, is tedious</li>
      <li>Especially when the software is in production</li>
    </ul>
  </li>
  <li>Instead, using the <code class="highlighter-rouge">logging</code> library
    <ul>
      <li>Leave statements in</li>
      <li>Enable or disable in standard ways</li>
      <li>Send output to any of several places for collation and inspection</li>
    </ul>
  </li>
</ul>

<h2 id="s:logging-basic">How Can My Program Report Its Activity Consistently?</h2>

<ul>
  <li>Standard levels (each more verbose than the next)
    <ul>
      <li><code class="highlighter-rouge">DEBUG</code>: very detailed information used for localizing errors</li>
      <li><code class="highlighter-rouge">INFO</code>: confirmation that things are working as expected</li>
      <li><code class="highlighter-rouge">WARNING</code>: something unexpected happened, but the program will keep going</li>
      <li><code class="highlighter-rouge">ERROR</code>: something has gone badly wrong, but the program hasn’t hurt anything</li>
      <li><code class="highlighter-rouge">CRITICAL</code>: potential loss of data, security breach, etc.</li>
    </ul>
  </li>
  <li>Use <code class="highlighter-rouge">logging.debug</code>, <code class="highlighter-rouge">logging.info</code>, etc. to write messages at these levels
    <ul>
      <li>By default, only <code class="highlighter-rouge">WARNING</code> and above are displayed</li>
    </ul>
  </li>
  <li>Messages appear on standard error so that flow of data in pipes (standard input to standard output) isn’t affected</li>
  <li>The source appears as well (in this case, called “root”)</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'This is a warning.'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'This is just for information.'</span><span class="p">)</span>
</code></pre>
</div>
<pre><code class="language-stderr">WARNING:root:This is a warning.
</code></pre>

<ul>
  <li>Can configure logging to send messages to a file instead of to standard error
    <ul>
      <li>Do this before any calls: it’s not retroactive</li>
    </ul>
  </li>
  <li>And change the level
    <ul>
      <li>Everything at or above the configured level is displayed</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">'everything.log'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">'This is for debugging.'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'This is just for information.'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'This is a warning.'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">'Something went wrong.'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">'Something went seriously wrong.'</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>DEBUG:root:This is for debugging.
INFO:root:This is just for information.
WARNING:root:This is a warning.
ERROR:root:Something went wrong.
CRITICAL:root:Something went seriously wrong.
</code></pre>
</div>

<ul>
  <li>By default, <code class="highlighter-rouge">basicConfig</code> re-opens the file in append mode</li>
  <li>Use <code class="highlighter-rouge">filemode='w'</code> to overwrite the existing log data
    <ul>
      <li>Useful during debugging</li>
      <li>Think twice before doing in production</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for basic logging</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: create exercises for basic logging</p>

<h2 id="s:logging-format">How Can I Change the Format of My Program’s Reports?</h2>

<ul>
  <li>Library uses the conventions of an older form of string formatting
    <ul>
      <li><code class="highlighter-rouge">%(NAME)s</code> to insert a named value as a string</li>
      <li><code class="highlighter-rouge">asctime</code> to get the current time</li>
      <li><code class="highlighter-rouge">message</code> to get the message</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s,</span><span class="si">%(levelname)</span><span class="s">s,</span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'This is a warning.'</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>2018-08-18,WARNING,This is a warning.
</code></pre>
</div>

<ul>
  <li>This looks like readable CSV data (on purpose)
    <ul>
      <li>Call the log file <code class="highlighter-rouge">log.csv</code> and record everything needed to re-create the run</li>
    </ul>
  </li>
  <li>As noted in <a href="#s:configuration">Chapter 6</a>, record the configuration data as a single string
    <ul>
      <li>Because CSV doesn’t handle nested data…</li>
      <li>…and you want to be able to read a single field, convert from YAML back to memory, and manipulate</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for changing log format</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: create exercises for changing log format</p>

<h2 id="s:logging-source">How Can I Handle Multiple Reporting Sources in One Program?</h2>

<ul>
  <li>Can configure multiple loggers to write to the same output with different source names.</li>
  <li>Again, reserve <code class="highlighter-rouge">stdin</code> and <code class="highlighter-rouge">stdout</code> for normal pipe operations</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># util.py</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="k">def</span> <span class="nf">create_logger</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

    <span class="c"># Create logger.</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

    <span class="c"># Send messages to standard output.</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="c"># Define format.</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s,</span><span class="si">%(name)</span><span class="s">s,</span><span class="si">%(levelname)</span><span class="s">s,</span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span>
                                  <span class="n">datefmt</span><span class="o">=</span><span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">dT</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S'</span><span class="p">)</span>

    <span class="c"># Stitch everything together.</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>
</code></pre>
</div>
<p>``python</p>
<h1 id="s:logging" id="get_wordspy">get_words.py</h1>
<p>from util import create_logger</p>

<p>logger = create_logger(‘get_words’, ‘log.csv’)</p>

<p>for word in [‘first’, ‘second’, ‘third’]:
    print(word)
    logger.debug(‘debug message’)
    logger.warn(‘warn message’)
    logger.critical(‘critical message’)</p>
<div class="highlighter-rouge"><pre class="highlight"><code>```python
# count_words.py
import sys
from util import create_logger

logger = create_logger('count_words', 'log.csv')

count = 0
for line in sys.stdin:
    count += 1
    logger.info('info message')
    logger.warn('warn message')
    logger.error('error message')
print(count)
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ get_words.py | count_words.py
3
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>2018-08-18T17:31:01,get_words,WARNING,warn message
2018-08-18T17:31:01,get_words,CRITICAL,critical message
2018-08-18T17:31:01,get_words,WARNING,warn message
2018-08-18T17:31:01,get_words,CRITICAL,critical message
2018-08-18T17:31:01,get_words,WARNING,warn message
2018-08-18T17:31:01,get_words,CRITICAL,critical message
2018-08-18T17:31:01,count_words,WARNING,warn message
2018-08-18T17:31:01,count_words,ERROR,error message
2018-08-18T17:31:01,count_words,WARNING,warn message
2018-08-18T17:31:01,count_words,ERROR,error message
2018-08-18T17:31:01,count_words,WARNING,warn message
2018-08-18T17:31:01,count_words,ERROR,error message
</code></pre>
</div>

<ul>
  <li>All messages consolidated in one file for checking
    <ul>
      <li>E.g., log the record key of every record put out at INFO level</li>
      <li>And then log the number of records aggregated, also at INFO level</li>
      <li>Checking tool loads CSV, selects appropriate records, and checks count</li>
    </ul>
  </li>
  <li>Many (many) other kinds of handlers
    <ul>
      <li>Rotating files</li>
      <li>Send messages to HTTP server (i.e., a centralized logging system)</li>
      <li>System log</li>
    </ul>
  </li>
  <li>You probably don’t need any of these
    <ul>
      <li>But sys admins will be grateful that you used <code class="highlighter-rouge">logging</code>, because then they can set it up with very little work</li>
    </ul>
  </li>
  <li>Open a second window and use <code class="highlighter-rouge">tail -f log.csv</code> to monitor progress</li>
  <li>Common to “tee” the logging
    <ul>
      <li>Everything to a file</li>
      <li>Errors and critical messages to standard error</li>
    </ul>

    <p>import sys
import logging</p>

    <h1 id="s:logging" id="create-logger">Create logger.</h1>
    <p>logger = logging.getLogger(‘example’)
logger.setLevel(logging.DEBUG)</p>

    <h1 id="s:logging" id="define-common-format">Define common format.</h1>
    <p>formatter = logging.Formatter(‘%(asctime)s,%(name)s,%(levelname)s,%(message)s’,
                              datefmt=’%Y-%m-%dT%H:%M:%S’)</p>

    <h1 id="s:logging" id="send-all-logging-messages-to-a-file">Send all logging messages to a file.</h1>
    <p>toFile = logging.FileHandler(‘log.csv’)
toFile.setLevel(logging.DEBUG)
toFile.setFormatter(formatter)</p>

    <h1 id="s:logging" id="send-errors-and-critical-messages-to-standard-error">Send errors and critical messages to standard error.</h1>
    <p>toScreen = logging.StreamHandler(sys.stderr)
toScreen.setLevel(logging.ERROR)
toScreen.setFormatter(formatter)</p>

    <h1 id="s:logging" id="stitch-everything-together">Stitch everything together.</h1>
    <p>logger.addHandler(toFile)
logger.addHandler(toScreen)</p>

    <h1 id="s:logging" id="try-some-messages">Try some messages.</h1>
    <p>logger.debug(‘debug’)
logger.info(‘info’)
logger.warning(‘warning’)
logger.error(‘error’)
logger.critical(‘critical’)</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ python tee.py
2018-08-20T16:29:42,example,ERROR,error
2018-08-20T16:29:42,example,CRITICAL,critical
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>2018-08-20T16:29:42,example,DEBUG,debug
2018-08-20T16:29:42,example,INFO,info
2018-08-20T16:29:42,example,WARNING,warning
2018-08-20T16:29:42,example,ERROR,error
2018-08-20T16:29:42,example,CRITICAL,critical
</code></pre>
</div>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for handling multiple log sources</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: create exercises for handling multiple log sources</p>

<h2 id="s:logging-summary">Summary</h2>

<p>FIXME: create concept map for logging</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Use <code class="highlighter-rouge">logging</code> instead of <code class="highlighter-rouge">print</code> to report program activity.
</li><li>Separate  messages into <code class="highlighter-rouge">DEBUG</code>, <code class="highlighter-rouge">INFO</code>, <code class="highlighter-rouge">WARNING</code>, <code class="highlighter-rouge">ERROR</code>, and <code class="highlighter-rouge">CRITICAL</code> levels.
</li><li>Use <code class="highlighter-rouge">logging.basicConfig</code> to define basic logging parameters.
</li><li>Always provide timestamps using YYYY-MM-DDTHH:MM:SS format.
</li><li>Use standard input and standard output for normal input and output, and send log messages to a file.
</li><li>Use <code class="highlighter-rouge">tail -f</code> to monitor log files.
</li>
  </ul>
</div>


          

          <h1 id="s:configuration">Configuration</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can I make it easy for users to configure software?
</li>
  </ul>
</div>


          <ul>
  <li>Software needs to be controlled
    <ul>
      <li>Some things change more often than others</li>
      <li>Want a simple, uniform way to specify some options and leave others alone</li>
    </ul>
  </li>
  <li>Modern Unix convention is <a href="#g:overlay-configuration">overlay configuration</a>
    <ul>
      <li>Short command-line options to change things that commonly change</li>
      <li>Per-result configuration file to control all those same options</li>
      <li>Per-user configuration file for personal preferences</li>
      <li>Per-system configuration file for system-wide preferences</li>
    </ul>
  </li>
  <li>Usually also allow longer command-line options to control everything to support scripting
    <ul>
      <li>Out of scope of this lesson</li>
    </ul>
  </li>
</ul>

<h2 id="s:configuration-cmdline">How Can I Handle Command-Line Flags Consistently?</h2>

<ul>
  <li>Use <code class="highlighter-rouge">getopt</code> for simple programs and <code class="highlighter-rouge">argparse</code> for complex ones
    <ul>
      <li><code class="highlighter-rouge">getopt</code> example will illustrate the ideas</li>
    </ul>
  </li>
  <li>Two kinds of flags:
    <ul>
      <li><code class="highlighter-rouge">-a</code>: single dash, single letter</li>
      <li><code class="highlighter-rouge">--long-name</code>: double dash, full name (conventionally hyphenated)</li>
    </ul>
  </li>
  <li>Either kind can be on its own or take a single argument</li>
  <li><code class="highlighter-rouge">getopt</code> matches a spec against a list of command-line arguments
    <ul>
      <li>Typically <code class="highlighter-rouge">sys.argv[1:]</code> (i.e., program name removed)</li>
    </ul>
  </li>
  <li>In simplest form, spec is all the single-letter flags, with colons showing the ones that take arguments</li>
  <li>Get back a list of (flag, argument) pairs and a list of everything else</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">getopt</span> <span class="kn">import</span> <span class="n">getopt</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">'-q'</span><span class="p">,</span> <span class="s">'-b'</span><span class="p">,</span> <span class="s">'/tmp/log.txt'</span><span class="p">,</span> <span class="s">'file1.txt'</span><span class="p">,</span> <span class="s">'file2.txt'</span><span class="p">]</span>
<span class="n">options</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">getopt</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">'b:q'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'options is'</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'extras is'</span><span class="p">,</span> <span class="n">extras</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>options is [('-q', ''), ('-b', '/tmp/log.txt')]
extras is ['file1.txt', 'file2.txt']
</code></pre>
</div>

<ul>
  <li>Typically loop over the (flag, argument) pairs to set up controls</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">logfile</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">quiet</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">for</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="s">'-b'</span><span class="p">:</span>
        <span class="n">logfile</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="k">elif</span> <span class="n">opt</span> <span class="o">==</span> <span class="s">'-q'</span><span class="p">:</span>
        <span class="n">quiet</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'unrecognized option {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>Optionally provide a list of long-name options
    <ul>
      <li>Indicate which take parameters by appending ‘=’ to the name</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">'-q'</span><span class="p">,</span> <span class="s">'--logfile'</span><span class="p">,</span> <span class="s">'/tmp/log.txt'</span><span class="p">,</span> <span class="s">'--overwrite'</span><span class="p">,</span> <span class="s">'file1.txt'</span><span class="p">,</span> <span class="s">'file2.txt'</span><span class="p">]</span>
<span class="n">options</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">getopt</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">'b:q'</span><span class="p">,</span> <span class="p">[</span><span class="s">'logfile='</span><span class="p">,</span> <span class="s">'overwrite'</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">'options is'</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'extras is'</span><span class="p">,</span> <span class="n">extras</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>options is [('-q', ''), ('--logfile', '/tmp/log.txt'), ('--overwrite', '')]
extras is ['file1.txt', 'file2.txt']
</code></pre>
</div>

<ul>
  <li>Taschuk’s Rules: always provide a way to set all options from the command line
    <ul>
      <li>So that users can control everything from a shell script without having to create temporary configuration files</li>
    </ul>
  </li>
  <li>Only provide short (single-letter) flags for commonly-used options
    <ul>
      <li>Signals what you expect to change frequently and what you expect will be left alone</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for handling command-line flags</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for handling command-line flags</p>

<h2 id="s:configuration-files">How Can I Manage Configuration Files Consistently?</h2>

<ul>
  <li>Enable program to read configuration from file
    <ul>
      <li>Because in manual use, a lot of values stay the same</li>
      <li>And whoever installs the software on the cluster may want to set some defaults</li>
    </ul>
  </li>
  <li>Many formats for configuration files, so do not create your own
    <ul>
      <li>Actual Python (but hard for tools in other languages to process)</li>
      <li>Windows INI files (falling out of fashion)</li>
      <li>JSON (but that’s a lot of curly braces…)</li>
    </ul>
  </li>
  <li>YAML is becoming the most popular
    <ul>
      <li>And is used in the headers of Markdown pages, so you might as well get used to it</li>
      <li>And allows comments</li>
    </ul>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="c1"># Example configuration file</span>
<span class="s">logfile</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/tmp/log.txt"</span>
<span class="s">quiet</span><span class="pi">:</span> <span class="s">false</span>
<span class="s">overwrite</span><span class="pi">:</span> <span class="s">false</span>
<span class="s">fonts</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">Verdana</span>
<span class="pi">-</span> <span class="s">Serif</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">yaml</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'config.yml'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">'logfile':</span><span class="w"> </span><span class="err">'/tmp/log.txt',</span><span class="w"> </span><span class="err">'quiet':</span><span class="w"> </span><span class="err">False,</span><span class="w"> </span><span class="err">'overwrite':</span><span class="w"> </span><span class="err">False,</span><span class="w"> </span><span class="err">'fonts':</span><span class="w"> </span><span class="err">['Verdana',</span><span class="w"> </span><span class="err">'Serif']</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<ul>
  <li>If your configuration file needs more depth than this, you’re probably doing something wrong [<a href="#Xu2015">Xu2015</a>]
    <ul>
      <li>Most users never use most configuration options</li>
      <li>And find their presence confusing</li>
    </ul>
  </li>
  <li>Return to command-line parsing
    <ul>
      <li>Rather than creating a bunch of free-standing variables, fill in one dictionary of options</li>
      <li><code class="highlighter-rouge">if config['quiet']</code> is only a little more typing than <code class="highlighter-rouge">if quiet</code>, intent is clearer, and it’s consistent with reaing from config files</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for configuration files</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for configuration files</p>

<h2 id="s:configuration-overlay">How Can I Implement Multi-Layer Configuration?</h2>

<ul>
  <li>System settings, then user settings, then job settings, each overriding what came before</li>
  <li>use <code class="highlighter-rouge">dict.update</code> to overwrite previous settings</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_full_configuration</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">command_line</span><span class="o">=</span><span class="p">{}):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">command_line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>

<ul>
  <li>System-wide settings:
    <ul>
      <li><code class="highlighter-rouge">/etc/app.yml</code> for system settings standard applications
        <ul>
          <li>Use your program’s name instead of <code class="highlighter-rouge">app</code></li>
        </ul>
      </li>
      <li>If you set an environment variable to the install location <code class="highlighter-rouge">$APP/config.rc</code>
        <ul>
          <li>Use <code class="highlighter-rouge">os.getenv('APP')</code> to get the value of the environment variable</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Personal settings:
    <ul>
      <li><code class="highlighter-rouge">$HOME/.app.yml</code> (the leading ‘.’ hides it from <code class="highlighter-rouge">ls</code>)</li>
      <li>Many use <code class="highlighter-rouge">.rc</code> (which stands for “resource control” - an old Unix convention)</li>
    </ul>
  </li>
  <li>Per-run settings:
    <ul>
      <li>Look in current directory for a file with a specific name</li>
      <li>But also provide a command-line way to override (like <code class="highlighter-rouge">Makefile</code> and <code class="highlighter-rouge">-f filename.mk</code>)</li>
    </ul>
  </li>
  <li>Use <code class="highlighter-rouge">os.path.isfile</code> to check that file exists</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_configuration_files</span><span class="p">():</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'APP'</span><span class="p">,</span> <span class="s">'config.yml'</span><span class="p">,</span> <span class="p">(</span><span class="s">'HOME'</span><span class="p">,</span> <span class="s">'.app.yml'</span><span class="p">,</span> <span class="p">(</span><span class="s">'PWD'</span><span class="p">,</span> <span class="s">'config.yml'</span><span class="p">)]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for overlay configuration</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for overlay configuration</p>

<h2 id="s:configuration-dump">How Can I Keep a Record of the Actual Configuration That Produced Particular Results?</h2>

<ul>
  <li>Careful record keeping is essential to reproducible science
    <ul>
      <li>The computer can do the record keeping</li>
    </ul>
  </li>
  <li>Save entire (merged) configuration using <code class="highlighter-rouge">yaml.dump</code>
    <ul>
      <li>Guaranteed to re-create configuration even on another machine with different defaults</li>
      <li>Test: program should be able to load a dumped configuration</li>
    </ul>
  </li>
  <li>Include this in the program’s log as a single string
    <ul>
      <li>Do not write one record per value, since that will mean more parsing work to reload</li>
      <li>And can easily lead to confusion about what’s part of the log and what’s part of the configuration</li>
      <li>And you’re likely to have multiple configurations in a log if your pipeline has multiple stages</li>
    </ul>
  </li>
  <li>Always include a version number as a field in the dumped configuration
    <ul>
      <li>The <code class="highlighter-rouge">--version</code> flag should produce this as well</li>
    </ul>
  </li>
  <li>Because option interpretation will change over time, and if you don’t know what the version was, you’ll have to guess</li>
</ul>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for keeping a record of configuration</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: exercises for keeping a record of configuration</p>

<h2 id="s:workflow-summary">Summary</h2>

<p>FIXME: create concept map for configuration</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Use short command-line parameters to set commonly-changed options.
</li><li>Allow long command-line parameters to change all other options to facilitate scripting.
</li><li>Use the <code class="highlighter-rouge">getopt</code> library to parse command-line flags.
</li><li>Read a system-wide configuration file, then a user configuration file, then a job configuration file.
</li><li>Format configuration files using YAML.
</li><li>Dump all configuration values in the same format used for input on request.
</li><li>Include the software version number in the dumped configuration.
</li>
  </ul>
</div>


          

          <h1 id="s:ghp">Using GitHub Pages</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can I create a static website for my work?
</li>
  </ul>
</div>


          <ul>
  <li>All options for publishing data science in the early 21st Century are clumsy and contradictory
    <ul>
      <li>Just as all classroom instruction compromises the efficacy of individual tutoring in the name of economics,
all publishing options compromise the flexibility of pen on paper in the name of readability and efficiency</li>
    </ul>
  </li>
  <li><a href="#g:wysiwyg">WYSIWYG</a> tools like <a href="https://en.wikipedia.org/wiki/Microsoft_Word">Microsoft Word</a>, <a href="https://www.libreoffice.org/">LibreOffice</a>, and <a href="https://en.wikipedia.org/wiki/Google_Docs,_Sheets,_and_Slides">Google Docs</a>
    <ul>
      <li>Lower cognitive load because you can see what your readers will see</li>
      <li><em>Can</em> allow restyling, but most people don’t take advantage of those features (extra work up front for downstream payoff)</li>
      <li>Hard to automatically regenerate (although again it’s possible, just not taken advantage of)</li>
      <li>Hard to coordinate the work of multiple contributors because version control systems don’t support their formats</li>
    </ul>
  </li>
  <li><a href="#g:typesetting-language">Typesetting languages</a> like <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a>, HTML, and <a href="http://www.latex-project.org/">LaTeX</a> use plain text plus instructions
    <ul>
      <li>Much higher cognitive load because of the compilation step</li>
      <li>Much easier to restyle because of the compilation step</li>
      <li>Much easier to automatically regenerate (provided the thing you want to regenerate fits the format)</li>
      <li>Better suited to large-scale collaboration because plain text is the one format that programmers respect</li>
    </ul>
  </li>
  <li>Many attempts to compromise by offering WYSIWYG view of typesetting language, e.g., <a href="https://www.authorea.com/">Authorea</a>, <a href="https://www.overleaf.com/">Overleaf</a>, and a gazillion different in-browser Markdown editors, including those built into the <a href="http://jupyter.org/">Jupyter Notebook</a>
    <ul>
      <li>These work until authors try to use any features of the substrate that aren’t supported by the WYSIWYG view</li>
      <li>Or author things in the substrate in ways that the overlay doesn’t recognize</li>
    </ul>
  </li>
  <li>We will explore Markdown and GitHub Pages
    <ul>
      <li>Illustrates the key ideas of a compilation-based workflow</li>
      <li>Probably the least painful to set up</li>
    </ul>
  </li>
</ul>

<h2 id="s:ghp-authoring">How Can I Write Web Pages Using Simple Text Formatting?</h2>

<ul>
  <li>Created as a simple way to write simple HTML
    <ul>
      <li>Support the same kinds of formatting (bold, italics, headings, etc.)</li>
      <li>But save people from all the angle brackets</li>
      <li>And allow embedded HTML for things the “standard” doesn’t support</li>
    </ul>
  </li>
  <li>Turns out that:
    <ul>
      <li>Everybody wants something more (tables! citations!)</li>
      <li>Using an arbitrary collection of syntax rules for simple things makes more complicated things hard to do</li>
    </ul>
  </li>
  <li>We will focus on <a href="https://help.github.com/articles/github-flavored-markdown/">GitHub Flavored Markdown</a> (GFM)</li>
  <li>Use asterisks (or underscores) for <code class="highlighter-rouge">*italics*</code> and <code class="highlighter-rouge">**bold**</code> (which render as <em>italics</em> and <strong>bold</strong>)
    <ul>
      <li>I prefer to mix them to do <code class="highlighter-rouge">*__bold italics__*</code> because I can’t tell three marks from two</li>
    </ul>
  </li>
  <li>Use one to six <code class="highlighter-rouge">#</code> signs at the start of a line to create a heading</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># Level-1
## Level-2
### Level-3
</code></pre>
</div>

<ul>
  <li>Unnumbered lists are written using dashes or asterisks as markers
    <ul>
      <li>Conventional to indent text and nested lists by four columns for readability</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>-   First top item
    -   First nested item
    -   Second nested
        item with text
        spanning multiple lines
-   Second top item
    *   Use asterisks instead of dashes
</code></pre>
</div>

<ul>
  <li>Numbered lists are written with numbers
    <ul>
      <li>Usually number everything with <code class="highlighter-rouge">1.</code> and let the processor figure it out</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>1.  First top item
1.  Second top item
    1.  You can use
    2.  the actual numbers
    3.  if you want
1.  Third top item
</code></pre>
</div>

<ul>
  <li>Code can be written inline using back quotes:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Compile `rnadiff` using `Make`.
</code></pre>
</div>

<ul>
  <li>
    <p>Use three back quotes or tildes at the start and end of a code block:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>this is
a
code block
</code></pre>
    </div>
  </li>
  <li>Can also indent code blocks by four spaces
    <ul>
      <li>Which is helpful when you’re trying to show how back quotes work</li>
    </ul>
  </li>
  <li>Write links as <code class="highlighter-rouge">[text](URL)</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Please see [our website](http://example.com) for more information.
</code></pre>
</div>

<ul>
  <li>Better style to use a symbolic name in the text <code class="highlighter-rouge">[like this][website]</code></li>
  <li>Then put a definition for the link name at the bottom of the file</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>[website]: http://example.com
</code></pre>
</div>

<ul>
  <li>This ensures that all uses are consistent</li>
  <li>Images are where things start to get squirrelly
    <ul>
      <li>No obvious syntax, so use link syntax with an exclamation mark at the start</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>![image title](URL)
</code></pre>
</div>

<ul>
  <li>And then there are tables
    <ul>
      <li>Draw them in ASCII</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>| Common Name | Scientific Name       |
|-------------|-----------------------|
| groath      | Hebecephalus montanus |
| grobbit     | Ungulamys cerviforme  |
| gurrath     | Oncherpestes fodrhami |
</code></pre>
</div>

<ul>
  <li>Columns don’t have to line up, but it’s easier to read if you do
    <ul>
      <li>So you’ll spend far more time than you should using a supercomputer to indent with spaces</li>
    </ul>
  </li>
  <li>Or use something like the <a href="https://www.tablesgenerator.com/">Tables Generator</a>
    <ul>
      <li>Yes, you are using a WYSIWYG program to create 1970s-era text to be translated back into what you drew</li>
    </ul>
  </li>
  <li>This is the point where it’s often simpler to just write HTML</li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for writing Markdown</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME for writing Markdown</p>

<h2 id="s:ghp-ghp">How Can I Publish Simple Web Pages Using GitHub?</h2>

<ul>
  <li>Most people don’t want to read Markdown as-is, so need some way to translate and publish it</li>
  <li>GitHub provides a mechanism called <a href="https://pages.github.com/">GitHub Pages</a></li>
  <li>Several ways to use it, the simplest of which is:
    <ol>
      <li>Go to the <code class="highlighter-rouge">master</code> branch of your repository</li>
      <li>Create a top-level subdirectory in your project called <code class="highlighter-rouge">docs</code></li>
      <li>Go to the settings for your project on GitHub and turn on publishing</li>
    </ol>
  </li>
  <li>GitHub Pages uses a tool called <a href="https://jekyllrb.com/">Jekyll</a> to translate Markdown and other files for publication
    <ul>
      <li>Simple things are simple</li>
      <li>Complex things are complex, and should be avoided in favor of self-publishing (discussed below)</li>
    </ul>
  </li>
  <li>By default, Jekyll copies all of the files in <code class="highlighter-rouge">docs</code> to create the website for the project
    <ul>
      <li>If the project is hosted at <code class="highlighter-rouge">https://github.com/USER/PROJECT</code>, the website is <code class="highlighter-rouge">https://USER.github.io/PROJECT</code></li>
      <li>Note: <code class="highlighter-rouge">github.io</code>, not <code class="highlighter-rouge">github.com</code></li>
    </ul>
  </li>
  <li>Files and directories whose names begin with <code class="highlighter-rouge">_</code> aren’t copied
    <ul>
      <li>Jekyll will generate the site into a directory called <code class="highlighter-rouge">_site</code></li>
      <li>So add that to your <code class="highlighter-rouge">.gitignore</code></li>
    </ul>
  </li>
  <li>Text files (including Markdown and HTML) are copied as-is…</li>
  <li>…unless they start with two triple-dash lines:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>---
---

The manifold perplexities of my chosen research topic...
</code></pre>
</div>

<ul>
  <li>Any file with this header is processed - in particular, Markdown is turned into HTML</li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for getting started with GitHub pages</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: create exercises for getting started with GitHub pages</p>

<h2 id="s:ghp-metadata">How Can I Give My Pages a Consistent Look and Feel?</h2>

<ul>
  <li>The triple-dash header can contain metadata telling Jekyll how to format the document</li>
  <li>Work through this example</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>---
layout: simple
title: "Adagu's Home Page"
author: "Adagu Okereke"
---

The manifold perplexities of my chosen research topic...
</code></pre>
</div>

<ul>
  <li>First line specifies the <a href="#g:page-template">page template</a> to use</li>
  <li>Create a sub-directory called <code class="highlighter-rouge">_layouts</code></li>
  <li>Create an HTML file with everything common to all pages</li>
  <li>Use <code class="highlighter-rouge"><span class="p">{</span><span class="err">{content</span><span class="p">}</span><span class="err">}</span></code> to show where the content of the page is to go</li>
  <li>Jekyll will fill it in</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">"LightYellow"</span><span class="nt">&gt;</span>
{{content}}
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<ul>
  <li>Jekyll will copy values from the header into the page where <code class="highlighter-rouge"><span class="p">{</span><span class="err">{page.key</span><span class="p">}</span><span class="err">}</span></code> appears</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">content=</span><span class="s">"{{page.author}}"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">"LightYellow"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>{{page.title}}<span class="nt">&lt;/h1&gt;</span>
{{content}}
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">content=</span><span class="s">"Adagu Okereke"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">"LightYellow"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Adagu's Home Page<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>The manifold perplexities of my chosen research topic...<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<ul>
  <li>Can (should) also put data in <code class="highlighter-rouge">_config.yml</code> in the <code class="highlighter-rouge">docs</code> directory
    <ul>
      <li>Uses a format called <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> for names with values and lists</li>
    </ul>
  </li>
  <li>Values from the configuration file are used in pages as <code class="highlighter-rouge"><span class="p">{</span><span class="err">{site.key</span><span class="p">}</span><span class="err">}</span></code>
    <ul>
      <li>E.g., replace <code class="highlighter-rouge"><span class="p">{</span><span class="err">{page.author</span><span class="p">}</span><span class="err">}</span></code> with <code class="highlighter-rouge"><span class="p">{</span><span class="err">{site.author</span><span class="p">}</span><span class="err">}</span></code></li>
    </ul>
  </li>
  <li>Other values control how Jekyll works
    <ul>
      <li>E.g., list of names under the <code class="highlighter-rouge">exclude</code> key tells Jekyll to ignore files and directories</li>
      <li>This is completely independent from what’s listed in <code class="highlighter-rouge">.gitignore</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>author: "Adagu Okereke"
exclude:
- bin
- status.xlsx
- raw
- results
</code></pre>
</div>

<ul>
  <li>There are <em>lots</em> of <a href="#g:theme">themes</a> for Jekyll
    <ul>
      <li>Use one of GitHub’s defaults unless you know a lot about graphic design and want to spend hours fiddling with CSS</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for templates and metadata</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for templates and metadata</p>

<h2 id="s:ghp-preview">How Can I Preview Pages Locally?</h2>

<ul>
  <li>Pushing half-finished work to the web for everyone to see is a bit unprofessional</li>
  <li>To preview work locally:
    <ul>
      <li>Install Jekyll</li>
      <li>Go into the <code class="highlighter-rouge">docs</code> directory</li>
      <li>Run <code class="highlighter-rouge">jekyll serve</code> (can’t do it from the root because that’s a GitHub thing)</li>
    </ul>
  </li>
  <li>Point your browser at <a href="https://localhost:4000">https://localhost:4000</a>
    <ul>
      <li><code class="highlighter-rouge">localhost</code> means “this machine”</li>
      <li><code class="highlighter-rouge">:4000</code> means port 4000 (instead of the usual ports used by web servers)</li>
    </ul>
  </li>
  <li>If there are missing files, you’ll see an error message in the terminal window when you try to access them</li>
  <li>Have to be careful about paths to files
    <ul>
      <li>The home page of your project is <code class="highlighter-rouge">/index.html</code> when you’re running locally</li>
      <li>But <code class="highlighter-rouge">https://USER.github.io/PROJECT/index.html</code> when you’re running on GitHub</li>
      <li>Which means the path below the domain is <code class="highlighter-rouge">/PROJECT/index.html</code></li>
      <li>So you cannot use something like <code class="highlighter-rouge">/images/profile.png</code> as an image URL,
because that won’t resolve</li>
    </ul>
  </li>
  <li>Use relative URLs wherever you can
    <ul>
      <li>E.g., <code class="highlighter-rouge">../images/profile.png</code></li>
    </ul>
  </li>
  <li>But what about your templates?
    <ul>
      <li>Want to use the same template for pages at all levels</li>
    </ul>
  </li>
  <li>Use a Jekyll <a href="#g:jekyll-filter">filter</a>
    <ul>
      <li>Double curly brackets to trigger evalution by Jekyll</li>
      <li>The absolute path for the link</li>
      <li>A pipe symbol</li>
      <li>The <code class="highlighter-rouge">relative_url</code> function name</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;img src="{{'/images/profile.png' | relative_url}}" /&gt;
</code></pre>
</div>

<ul>
  <li>or:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>![My Profile Picture]({{'/images/profile.png' | relative_url}})
</code></pre>
</div>

<ul>
  <li>There are lots of other filters, like <code class="highlighter-rouge">absolute_url</code></li>
</ul>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for previewing GitHub Pages locally</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: create exercises for previewing GitHub Pages locally</p>

<h2 id="s:ghp-self-pub">How Can I Publish Pages Myself Instead of Relying on GitHub?</h2>

<ul>
  <li>Jekyll is very limited for research publishing
    <ul>
      <li>Doesn’t number sections or translate section cross-references</li>
      <li>Doesn’t handle bibliographic citations</li>
    </ul>
  </li>
  <li>The solution is to use something else
    <ul>
      <li>Store source in a directory other than <code class="highlighter-rouge">docs</code> in your <code class="highlighter-rouge">master</code> branch</li>
      <li>Generate the files you want using whatever tool you want and put them in <code class="highlighter-rouge">docs</code></li>
      <li>Make sure they <em>don’t</em> have triple-dash YAML headers so that Jekyll doesn’t try to translate them a second time</li>
      <li>Commit and push</li>
      <li>This means you’re storing generated files in your repository, which is generally bad practice</li>
      <li>But you do what you have to do…</li>
    </ul>
  </li>
  <li><a href="https://pandoc.org/">Pandoc</a> is a widely-used format-to-format conversion tool
    <ul>
      <li>Turn HTML into Word into Markdown into LaTeX into…</li>
      <li>Uses its own superset of Markdown, but can be told to conform to GFM</li>
      <li>Handles bibliographic citations and other things that GFM doesn’t</li>
    </ul>
  </li>
  <li><a href="https://rmarkdown.rstudio.com/">R Markdown</a> and <a href="http://jupyter.org/">Jupyter</a> can both generate static websites that you can commit to <code class="highlighter-rouge">docs</code></li>
  <li>Run <code class="highlighter-rouge">jekyll serve</code> in the <code class="highlighter-rouge">docs</code> folder to preview</li>
</ul>

<h3 id="common-problems-4">Common Problems</h3>

<p>FIXME: common problems for self-publishing GitHub Pages sites</p>

<h3 id="exercises-4">Exercises</h3>

<p>FIXME: create exercises for self-publishing GitHub Pages sites</p>

<h2 id="s:ghp-math">How Can I Include Math in Web Pages?</h2>

<ul>
  <li>LaTeX is widely used for typesetting math</li>
  <li><a href="https://www.mathjax.org/">MathJax</a> is a JavaScript library that parses LaTeX and renders it in the browser</li>
  <li>Steps are:
    <ol>
      <li>Tell the browser to load the JavaScript library when it loads your page</li>
      <li>Mark the sections of your page that MathJax is to translate</li>
    </ol>
  </li>
  <li>Loading the library:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"</span> <span class="na">async</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
  ...the body of your page...
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<ul>
  <li>Break it down
    <ul>
      <li>Use the <code class="highlighter-rouge">script</code> tag inside the <code class="highlighter-rouge">head</code> of a page to tell the browser to load JavaScript</li>
      <li>The <code class="highlighter-rouge">src</code> attribute tells the browser what to load</li>
      <li>Everything after the <code class="highlighter-rouge">?</code> is configuration for MathJax</li>
      <li>The word <code class="highlighter-rouge">async</code> means “don’t hold up loading, but run the script as soon as it’s available”</li>
      <li>Things like this are why we use page templates…</li>
    </ul>
  </li>
  <li>Note: this is loading MathJax from a <a href="#g:cdn">content delivery network</a>
    <ul>
      <li>Means the math won’t render if you are offline</li>
      <li>You can install MathJax locally, but that’s out of the scope of this lesson</li>
    </ul>
  </li>
  <li>Now mark the inline LaTeX in the body of your page with <code class="highlighter-rouge">$$...$$</code> markers
    <ul>
      <li>Works in both Markdown and HTML</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>The circle is defined by $$x^2 + y^2 = \mu$$.
</code></pre>
</div>

<ul>
  <li>Produces “The circle is defined by <script type="math/tex">x^2 + y^2 = \mu</script>.”</li>
  <li>Use double dollar signs on lines of their own to generate block equations</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$$ r = \sqrt{\frac {N} {N+1}} \sqrt{\frac {N+1} {2N}} = \sqrt{\frac{1}{2}} $$
</code></pre>
</div>

<ul>
  <li>Output is:</li>
</ul>

<script type="math/tex; mode=display">r = \sqrt{\frac {N} {N+1}} \sqrt{\frac {N+1} {2N}} = \sqrt{\frac{1}{2}}</script>

<h3 id="common-problems-5">Common Problems</h3>

<p>FIXME: common problems for adding math to GitHub Pages</p>

<h3 id="exercises-5">Exercises</h3>

<p>FIXME: create exercises for adding math to GitHub Pages</p>

<h2 id="s:ghp-summary">Summary</h2>

<p>FIXME: create concept map for GitHub Pages</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>WYSIWYG editors make simple things simple, but complex things hard, and are not well suited to large-scale collaboration.
</li><li>Typesetting pipelines are more complex to use, but scale well and are easier to integrate into reproducible research pipelines.
</li><li>Markdown is a family of throwback text formats that provides a subset of the formatting available in HTML.
</li><li>GitHub can be configured to use Jekyll to publish files located in the <code class="highlighter-rouge">docs</code> directory of a repository’s <code class="highlighter-rouge">master</code> branch as a website.
</li><li>Jekyll can be controlled using YAML metadata in page headers, configuration data in <code class="highlighter-rouge">_config.yml</code>, and page templates in <code class="highlighter-rouge">_layouts</code>.
</li><li>Instead of using Jekyll, pages can be generated locally and committed to the repository’s <code class="highlighter-rouge">docs</code> directory.
</li><li>Math can be added to pages using MathJax and LaTeX equation syntax.
</li>
  </ul>
</div>


          

          <h1 id="s:workflow">A Scalable Workflow</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can a growing number of people coordinate work on a single project?
</li><li>How can I tell what needs to be done and who is doing it?
</li>
  </ul>
</div>


          <ul>
  <li>A common Git workflow for single-author/single-user projects:
    <ul>
      <li>Make some changes</li>
      <li><code class="highlighter-rouge">git add</code> and <code class="highlighter-rouge">git commit</code> as you go along</li>
      <li><code class="highlighter-rouge">git push</code> to remote repository</li>
      <li>Switch machines</li>
      <li><code class="highlighter-rouge">git pull</code> to get changes (and possibly resolve merge conflicts)</li>
      <li>Occasionally <code class="highlighter-rouge">git checkout -- .</code> or <code class="highlighter-rouge">git reset --hard VERSION</code> to discard changes</li>
      <li>(Even less frequently) recover old version(s) of file(s)</li>
      <li>Or <code class="highlighter-rouge">rm -rf</code> the repository and clone a new copy because everything is messed up</li>
    </ul>
  </li>
  <li>Essentially using Git for multi-version backup</li>
  <li>But:
    <ul>
      <li>Sometimes you have to work on several things at once</li>
      <li>Or need to set aside current work for a high-priority interrupt</li>
      <li>And this workflow doesn’t provide guidance for collaborating with others</li>
    </ul>
  </li>
  <li>Following a few rules and using some of Git’s more advanced capabilities solves these problems</li>
</ul>

<h2 id="s:workflow-branch">How Can I Use Branches to Manage Development of New Features?</h2>

<ul>
  <li>Use a <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow">branch-per-feature</a> workflow
    <ul>
      <li><code class="highlighter-rouge">git checkout master</code></li>
      <li><code class="highlighter-rouge">git pull origin master</code> (or <code class="highlighter-rouge">git pull upstream master</code>) to make sure you’re up to date</li>
      <li><code class="highlighter-rouge">git checkout -b feature-name</code></li>
      <li>Do some work</li>
      <li><code class="highlighter-rouge">git push origin feature-name</code> to upload or update that branch</li>
      <li><code class="highlighter-rouge">git pull origin master</code> again and resolve any conflicts</li>
      <li><code class="highlighter-rouge">git merge feature-name master</code> (command line) to merge into master when work is done</li>
    </ul>
  </li>
  <li>Better:
    <ul>
      <li>Create a <a href="#g:pull-request">pull request</a> on GitHub</li>
      <li>Within one repository (which may be shared with other people) or between repositories (from your fork to the upstream repository)</li>
      <li>Get someone to look over the changes and leave comments</li>
      <li>Make fixes: the pull request is updated in place</li>
      <li>Merge when done</li>
    </ul>
  </li>
  <li>But what’s a “feature”?
    <ul>
      <li>A pure addition that doesn’t change anything else (e.g., a new analysis run)</li>
      <li>A change that you might want to undo as a unit</li>
      <li>E.g., a new parameter with configuration, option parsing, help, and effect on execution</li>
      <li>If you then re-run analyses, do those as separate features (because you might want to undo them separately)</li>
    </ul>
  </li>
  <li>Don’t do several things in one branch
    <ul>
      <li>Commit work (don’t use <code class="highlighter-rouge">git stash</code>)</li>
      <li>Do the other thing</li>
      <li>Squash the history (described below)</li>
      <li>Merge to <code class="highlighter-rouge">master</code></li>
      <li>Merge from master to the original branch</li>
    </ul>
  </li>
  <li>What’s hard about branch-per-feature?
    <ul>
      <li>Doing work in one branch while large refactoring is going on in another</li>
      <li>So don’t do this</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for branch per feature</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for branch per feature</p>

<h2 id="s:workflow-rebase">How Can I Keep My Project’s History Clean When Working on Many Branches?</h2>

<ul>
  <li><a href="#g:rebase">Rebasing</a> means moving or combining some commits from one branch to another
    <ul>
      <li>Replay changes on one branch on top of changes made to another</li>
      <li>And/or collapse several consecutive commits into a single commit</li>
      <li>We will just use the latter ability</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">git rebase -i BASE</code>
    <ul>
      <li><code class="highlighter-rouge">BASE</code> is the most recent commit <em>before</em> the sequence to be compressed</li>
      <li>Which is always confusing</li>
    </ul>
  </li>
  <li>Brings up a display of recent commits
    <ul>
      <li><code class="highlighter-rouge">pick</code> the first and <code class="highlighter-rouge">squash</code> the rest</li>
      <li>Then see the combination of recent changes and messages</li>
      <li>Edit to combine into one</li>
    </ul>
  </li>
  <li>Why go to this trouble?
    <ul>
      <li>Because you may have done a commit, switched branches to work on something else, and then come back</li>
      <li>(You could use <code class="highlighter-rouge">git stash</code>, but that just makes life even more confusing)</li>
      <li>Or it may have taken you several tries to get something right</li>
      <li>Either way, only want one change in the final log in order to make undo and comprehension easier</li>
    </ul>
  </li>
  <li>What if you have pushed a branch to GitHub (or elsewhere) and then combine the commits to change its history?
    <ul>
      <li>Use <code class="highlighter-rouge">git push --force</code> to overwrite the remote history</li>
      <li>This is a sign that you should have done something differently a while back</li>
      <li>“It’s tough to make predictions, especially about the future” - Yogi Berra</li>
    </ul>
  </li>
  <li>Don’t rebase branches that are shared with other people
    <ul>
      <li>Creating a pull request from a branch effectively makes that branch shared</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for rebasing</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for rebasing</p>

<h2 id="s:workflow-tag">How Can I Label Specific Versions of My Work?</h2>

<ul>
  <li>A <a href="#g:git-tag">tag</a> is a permanent label on a particular state of the repository
    <ul>
      <li>Theoretically redundant, since the <a href="#g:commit-hash">commit hash</a> identifies that state as well</li>
      <li>But commit hashes are (deliberately) random and therefore hard to remember or find</li>
    </ul>
  </li>
  <li>Use <a href="#g:annotated-tag">annotated tags</a> to mark every major event in the project’s history
    <ul>
      <li>Annotated because they allow a message, just like a commit</li>
    </ul>
  </li>
  <li>Software projects use <a href="#g:semantic-versioning">semantic versioning</a> for software releases
    <ul>
      <li><code class="highlighter-rouge">major.minor.patch</code></li>
      <li>Increment <code class="highlighter-rouge">major</code> every time there’s an incompatible externally-visible change</li>
      <li>Increment <code class="highlighter-rouge">minor</code> when adding functionality without breaking any existing code</li>
      <li>Increment <code class="highlighter-rouge">patch</code> for bug fixes that don’t add any new features (“now works as previously documented”)</li>
    </ul>
  </li>
  <li>Research projects often use <code class="highlighter-rouge">report-date-event</code> instead of semantic versioning
    <ul>
      <li>E.g., <code class="highlighter-rouge">jse-2018-06-23-response</code> or <code class="highlighter-rouge">pediatrics-2018-08-15-summary</code></li>
      <li>Do not tempt fate by calling something <code class="highlighter-rouge">-final</code></li>
    </ul>
  </li>
  <li>For simple projects, only tag the master branch
    <ul>
      <li>Because everything that is finished is merged to master</li>
    </ul>
  </li>
  <li>Larger software projects may create a branch for each released version and do minor or patch updates on that branch
    <ul>
      <li>Outside the scope of this lesson</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for tagging</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for tagging</p>

<h2 id="s:workflow-issues">How Can I Manage the Work I Still Have To Do?</h2>

<ul>
  <li>Version control tells you where you’ve been; <a href="#g:issue">issues</a> tells us where you’re going
    <ul>
      <li>Issue tracking tools are often called ticketing systems or bug trackers,
since they were created to keep track of work that nees to be done and bugs that needed fixing</li>
    </ul>
  </li>
  <li>Every issue has:
    <ul>
      <li>Unique ID/link</li>
      <li>One-line summary to aid browsing and search</li>
      <li>Status (discussed below)</li>
      <li>Creator’s ID</li>
      <li>Other people’s IDs</li>
      <li>Full description that may include screenshots, error messages, etc.</li>
      <li>Threaded discussion</li>
    </ul>
  </li>
  <li>Use it to:
    <ul>
      <li>Describe bugs, and solicit/collect bug reports from community</li>
      <li>Request, plan, and discuss new features
        <ul>
          <li>“Discuss” because most allow reply-to discussion threads, and will notify people who are already on the thread of updates</li>
        </ul>
      </li>
      <li>Ask questions
        <ul>
          <li>Repurposes the discussion capability</li>
          <li>If search is good and someone’s willing to add tags, old issues can act as a FAQ</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Use issues to prioritize work
    <ul>
      <li>Create a tag for the next work sprint (typically called <code class="highlighter-rouge">V3.1</code> or <code class="highlighter-rouge">2018-03</code>)</li>
      <li>Assign that tag to issues that the group is going to try to close by that time</li>
    </ul>
  </li>
  <li>More sophisticated systems allow people to:
    <ul>
      <li>Record dependencies between issues</li>
      <li>Estimate how long work will take</li>
      <li>Record how long work actually took</li>
      <li>Don’t worry about any of this until people are actually using issues…</li>
    </ul>
  </li>
  <li>More sophisticated systems also constrain the transitions between states and who can make them
    <ul>
      <li>Defines the project’s workflow</li>
    </ul>
  </li>
</ul>

<figure>
  <figcaption>Issue State Transitions</figcaption>
  <img id="f:workflow-lifecycle" src="../../files/issue-lifecycle.svg" alt="Issue State Transitions" />
</figure>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for issues</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: exercises for issues</p>

<h2 id="s:workflow-bugs">How Can I Write a Good Bug Report?</h2>

<ol>
  <li>Make sure it actually <em>is</em> a bug.</li>
  <li>Try to come up with a short, repeatable way to trigger it.
    <ul>
      <li>You’ll be surprised how often you can solve the problem yourself as you do this…</li>
    </ul>
  </li>
  <li>Write a descriptive short summary (something better than “program crashes”)</li>
  <li>Describe how to reproduce
    <ul>
      <li>Describe both what you expected and what it actually does</li>
    </ul>
  </li>
  <li>Attach screenshots, input files, etc.</li>
  <li>Make sure to describe software version, operating system, etc.</li>
  <li>Describe each problem separately</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>ID: 1278
Creator: standage
Owner: malvika
Tags: Bug, Verified
Summary: wordbase.py fails on accented characters
Description:
1.  Create a text file called 'accent.txt' containing the word "Pumpernickel"
    with an umlaut over the 'u'.

2.  Run 'python wordbase.py --all --message accent.txt'

Program should print "Pumpernickel" on a line by itself with the umlaut, but
instead it fails with the message:

    No encoding for [] on line 1 of 'accent.txt'.

([] shows where a solid black box appears in the output instead of a
printable character.)

python wordbase.py --version reports 0.13.1; using on Windows 10.
</code></pre>
</div>

<h3 id="common-problems-4">Common Problems</h3>

<p>FIXME: common problems for writing bug reports</p>

<h3 id="exercises-4">Exercises</h3>

<p>FIXME: exercises for writing bug reports</p>

<h2 id="s:workflow-status">How Can I Set Up a Consistent Workflow for My Project?</h2>

<ul>
  <li>Use labels to distinguish:
    <ul>
      <li>Bug: something should work but doesn’t</li>
      <li>Enhancement: something could/should be added</li>
      <li>Task: something needs to be done, but won’t show up in code (e.g., we need to get the next release out by February)</li>
      <li>Question: how is something supposed to work?</li>
      <li>Discussion: we need to make a decision about something
        <ul>
          <li>All issues can have discussion - this category is for ones that start that way</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Add extra labels to distinguish:
    <ul>
      <li>High Priority: small projects typically can’t take advantage of multiple priority levels, so don’t bother with them</li>
      <li>Won’t Fix/Works as Designed/Duplicate: reasons for closing without acting</li>
      <li>Verified/Accepted/Decided: yes, this bug needs fixed, this feature should be added, or we’ve decided what to do</li>
      <li>Ready for Review/Ready to Merge: self-explanatory</li>
      <li>Accomplished: this task has been done</li>
    </ul>
  </li>
  <li>And assign people:
    <ul>
      <li>Creator: usually added automatically by the system</li>
      <li>Owner: who’s doing the work/moderating the discussion</li>
      <li>Reviewer: who’s checking</li>
    </ul>
  </li>
  <li>Helpful to have one more label: <em>Suitable for Newcomer</em> or <em>Beginner</em>
    <ul>
      <li>If you help potential new contributors find places to start, they’re more likely to do so</li>
    </ul>
  </li>
  <li>Can use issue status to make the development lifecycle explicit
    <ul>
      <li>I.e., only allow certain state transitions</li>
      <li>And notify interested parties of state transitions</li>
    </ul>
  </li>
  <li>Don’t worry about any of this until people are actually using issues…</li>
</ul>

<h3 id="common-problems-5">Common Problems</h3>

<p>FIXME: common problems for lifecycle</p>

<h3 id="exercises-5">Exercises</h3>

<p>FIXME: exercises for lifecycle</p>

<h2 id="s:workflow-summary">Summary</h2>

<p>FIXME: create concept map for workflow</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Create a new branch for every feature, and only work on that feature in that branch.
</li><li>Always create branches from <code class="highlighter-rouge">master</code>, and always merge to <code class="highlighter-rouge">master</code>.
</li><li>Use rebasing to combine several related commits into a single commit before merging.
</li><li>Create issues for bugs, enhancement requests, and discussions.
</li><li>Add people to issues to show who is responsible for working on what.
</li><li>Add labels to issues to identify their purpose.
</li><li>Use rules for issue state transitions to define a workflow for a project.
</li>
  </ul>
</div>


          

          <h1 id="s:continuous">Continuous Integration</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can I tell what state my project is actually in?
</li>
  </ul>
</div>


          <ul>
  <li><a href="#g:continuous-integration">Continuous integration</a> is a simple idea
    <ul>
      <li>Build and test code and documentation every time someone commits code</li>
      <li>Post results somewhere everyone can see them (you, the team, users, …)</li>
      <li>If build or tests fail, send out notifications</li>
    </ul>
  </li>
  <li>Even better: build and test changes <em>before</em> they’re merged
    <ul>
      <li>Only do code review on changes that have passed mechanical checks</li>
    </ul>
  </li>
  <li>Most widely used system is <a href="https://travis-ci.org/">Travis CI</a>
    <ul>
      <li>Easy integration with <a href="http://github.com">Github</a></li>
      <li>Will run tests on multiple platforms and with multiple versions of tools</li>
    </ul>
  </li>
  <li>Developers still have to build the tests
    <ul>
      <li>CI only as good as the tests it runs</li>
    </ul>
  </li>
  <li>Check style as well as correctness by running <a href="https://www.python.org/dev/peps/pep-0008/">pep8</a> or <a href="https://yihui.name/formatr/">formatR</a> as part of the build</li>
</ul>

<h2 id="s:continuous-basic">How Can I Run Commands Automatically Every Time a Repository Is Updated?</h2>

<ul>
  <li>Tell Travis to care about your repository
    <ul>
      <li>Log in to <a href="https://travis-ci.org/">Travis-CI</a> with your GitHub credentials</li>
      <li>On the left, beside “My Repositories”, click “+” to add a new repository</li>
      <li>Find the repository you want to connect to Travis-CI</li>
      <li>Flick the switch</li>
    </ul>
  </li>
  <li>Create a file called <code class="highlighter-rouge">.travis.yml</code> in the root directory of the repository (note the leading ‘.’)</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>language: "python"
python:
-   "3.6"
install:
-   "pip install -r requirements.txt"
script:
-   "python src/continuous/hello.py"
</code></pre>
</div>

<ul>
  <li>Four keys:
    <ul>
      <li><code class="highlighter-rouge">language</code> tells Travis what language we’re using</li>
      <li><code class="highlighter-rouge">python</code> specifies the version (or versions) of Python to use</li>
      <li><code class="highlighter-rouge">install</code> tells Travis how to install the software we need for testing
        <ul>
          <li>Have a list of packages in <code class="highlighter-rouge">requirements.txt</code> for <code class="highlighter-rouge">pip</code> to use (<a href="#s:packages">Chapter 14</a>)</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">script</code> tells Travis what to run on our behalf</li>
    </ul>
  </li>
  <li>Create a “test” script that just prints a message</li>
</ul>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/env python</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Hello, continuous'</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>Note the first line
    <ul>
      <li><code class="highlighter-rouge">#!</code> means “use the following program to run this script instead of Bash”</li>
      <li>So <code class="highlighter-rouge"><span class="c">#!/Users/standage/anaconda3/bin/python</span></code> woul run a particular version of Python</li>
      <li>But <code class="highlighter-rouge">/usr/bin/env some_program_name</code> finds the program you want</li>
      <li>So if Python is installed somewhere else, this still works</li>
    </ul>
  </li>
  <li>Every time a commit is made to this branch, Travis will:
    <ul>
      <li>Create a new Linux image</li>
      <li>Install the desired version of Python (or clone an existing image that has it, which is faster)</li>
      <li>Install the software described by <code class="highlighter-rouge">requirements.txt</code></li>
      <li>Run the script</li>
      <li>Report the results at <code class="highlighter-rouge">https://travis-ci.org/USER/REPO</code></li>
    </ul>
  </li>
  <li>Summary report tells you what happened</li>
</ul>

<figure>
  <figcaption>Travis Summary Report</figcaption>
  <img id="f:continuous-summary" src="../../files/travis-summary.png" alt="Travis Summary Report" />
</figure>

<ul>
  <li>Detailed log has <em>lots</em> of information
    <ul>
      <li>397 lines hidden under “Build system information”</li>
      <li>Another 23 under “pip install” heading</li>
    </ul>
  </li>
</ul>

<figure>
  <figcaption>Travis Log</figcaption>
  <img id="f:continuous-log" src="../../files/travis-log.png" alt="Travis Log" />
</figure>

<ul>
  <li>Most important thing is the test program’s <a href="#g:exit-status">exit status</a></li>
  <li>Exit status of 0 means “nothing went wrong”
    <ul>
      <li>The default if you don’t specify anything else</li>
      <li>You can do it explicitly with <code class="highlighter-rouge">sys.exit(0)</code></li>
    </ul>
  </li>
  <li>Any non-zero status is interpreted as a shell error code
    <ul>
      <li><code class="highlighter-rouge">sys.exit(1)</code> means “something went wrong”</li>
      <li>Don’t worry about other codes (like 127 for “command not found” and 130 for “terminated with Control-C”)</li>
    </ul>
  </li>
  <li>Test this by adding a second script to <code class="highlighter-rouge">.travis.yml</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>language: "python"
python:
-   "3.6"
install:
-   "pip install -r requirements.txt"
script:
-   "python src/continuous/hello.py"
-   "python src/continuous/failure.py"
</code></pre>
</div>
<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">print</span><span class="p">(</span><span class="s">'And this command fails'</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>Commit and view</li>
  <li>Initially told that the build is queued</li>
</ul>

<figure>
  <figcaption>Travis Queued</figcaption>
  <img id="f:continuous-queued" src="../../files/travis-queued.png" alt="Travis Queued" />
</figure>

<ul>
  <li>Don’t need to refresh the page
    <ul>
      <li>When the build starts, the page automatically starts updating</li>
      <li>And when the build finishes, the summary is red and the log displays this</li>
    </ul>
  </li>
</ul>

<figure>
  <figcaption>Travis Failure</figcaption>
  <img id="f:continuous-failure" src="../../files/travis-failure.png" alt="Travis Failure" />
</figure>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for setting up Travis-CI</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for setting up Travis-CI</p>

<h2 id="s:continuous-display">How Can I Display the Status of a Repostiory?</h2>

<ul>
  <li>Display build status on GitHub because that’s where most people look</li>
  <li>Look at the top of the status page for the build icon</li>
</ul>

<figure>
  <figcaption>Travis Build Icon</figcaption>
  <img id="f:continuous-build-icon" src="../../files/travis-build-icon.png" alt="Travis Build Icon" />
</figure>

<ul>
  <li>Click on it to bring up a dialog</li>
  <li>Select the Markdown you need for the <code class="highlighter-rouge">master</code> branch</li>
  <li>Paste it into <code class="highlighter-rouge">README.md</code> in your repository’s root directory
    <ul>
      <li>Which is the project’s home page on GitHub, <em>not</em> the root of the GitHub Pages site</li>
      <li>Unless you’ve configured it that way, which is confusing, because then the GitHub repo page has a table of header values</li>
    </ul>
  </li>
  <li>Commit this to <code class="highlighter-rouge">master</code></li>
  <li>While we’re waiting for the build, take a look at the “Branches” tab
    <ul>
      <li>Clicking on a check mark or an X will bring up details of that build on that branch</li>
    </ul>
  </li>
</ul>

<figure>
  <figcaption>Travis Overall</figcaption>
  <img id="f:continuous-overall" src="../../files/travis-overall.png" alt="Travis Overall" />
</figure>

<ul>
  <li>Sure enough, once the build on <code class="highlighter-rouge">master</code> completes, the page displays a red X</li>
  <li>Modify <code class="highlighter-rouge">.travis.yml</code> to remove the failing script</li>
  <li>Commit</li>
  <li>Wait for email to arrive</li>
  <li>Go to project on GitHub</li>
</ul>

<figure>
  <figcaption>Travis GitHub Icon</figcaption>
  <img id="f:continuous-github-icon" src="../../files/travis-github-icon.png" alt="Travis GitHub Icon" />
</figure>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for displaying Travis-CI status</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for displaying Travis-CI status</p>

<h2 id="s:continuous-tests">How Can I Automatically Run Tests for My Project When Things Change?</h2>

<p>FIXME: describe how to run actual tests with Travis-CI</p>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for running tests with Travis-CI</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for running tests with Travis-CI</p>

<h2 id="s:continuous-summary">Summary</h2>

<p>FIXME: create concept map</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Continuous integration rebuilds and/or re-tests software every time something changes.
</li><li>Use continuous integration to check changes before they are inspected.
</li><li>Check style as well as correctness.
</li>
  </ul>
</div>


          

          <h1 id="s:style">Programming Style</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How should I name my variables and functions?
</li><li>How should I organize my code so that other people can understand it?
</li>
  </ul>
</div>


          <blockquote>
  <p>Nothing in software engineering makes sense except in the light of human psychology.</p>

  <p>— Greg Wilson (after [<a href="#Dobz1973">Dobz1973</a>])</p>
</blockquote>

<ul>
  <li>Text with <em>meaningless</em> <strong>differences</strong> takes longer to read than text without
because our brains think every difference might be significant</li>
  <li>Being consistent therefore reduces <a href="#g:cognitive-load">cognitive load</a>,
which in turn helps us work faster and make fewer errors</li>
  <li>This lesson explores two kinds of consistency:
    <ul>
      <li>How to format program text</li>
      <li>How to reorganize code systematically when the time comes to make changes</li>
    </ul>
  </li>
  <li>Consistency helps with <a href="#g:chunking">chunking</a></li>
  <li>Always remember <a href="https://en.wikipedia.org/wiki/Politics_and_the_English_Language#Remedy_of_Six_Rules">Orwell’s Sixth Rule</a>:
“Break any of these rules sooner than saying anything outright barbarous.”</li>
</ul>

<h2 id="s:style-pep8">What Are the Standard Rules of Good Style for Python Programs?</h2>

<ul>
  <li>Python has a standard style called <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a></li>
  <li>And a tool called <code class="highlighter-rouge">pep8</code> that checks code and reports violations
    <ul>
      <li>Tools of this kind are called <a href="#g:linter">linters</a>, after an early tool called <code class="highlighter-rouge">[lint][lint]</code></li>
    </ul>
  </li>
  <li>Indent 4 spaces, and always use spaces instead of tabs</li>
  <li>Do <em>not</em> put spaces inside parentheses, i.e., don’t use <code class="highlighter-rouge">( 1+2 )</code>
    <ul>
      <li>This applies to function calls as well</li>
    </ul>
  </li>
  <li>Always use spaces around comparisons, but use your own judgment for common arithmetic operators</li>
  <li>Use <code class="highlighter-rouge">ALL_CAPS_WITH_UNDERSCORES</code> for constants (which should be placed at the top of the file)</li>
  <li>Use <code class="highlighter-rouge">lower_case_with_underscores</code> for function and variable names
    <ul>
      <li>Only use <code class="highlighter-rouge">CamelCase</code> for types and classes, which are outside the scope of this lesson</li>
    </ul>
  </li>
  <li>Use two blank links between each function</li>
  <li>Avoid abbreviations (which can be hard for non-native speakers to understand)
    <ul>
      <li>A good programming editor will auto-complete names, so you don’t have to do much typing</li>
    </ul>
  </li>
  <li>However, short variable names for temporaries and loop variables are OK [<a href="#Beni2017">Beni2017</a>]</li>
  <li>Order within file should be:
    <ul>
      <li>Docstring (<a href="#s:docs">Chapter 16</a>)</li>
      <li>Imports</li>
      <li>Constants</li>
      <li>Functions (highest level first)</li>
      <li><code class="highlighter-rouge">if __name__ == '__main__'</code></li>
    </ul>
  </li>
  <li>A few other rules (some borrowed from <a href="https://jennybryan.org/">Jenny Bryan</a>’s “<a href="https://github.com/jennybc/code-smells-and-feels">Code Smells and Feels</a>”)
    <ul>
      <li>Do not comment and uncomment sections of code to change behavior</li>
      <li>Keep functions short (no more than a page or three levels of control flow)</li>
      <li>Put early exits or decisions at the top of the function (<a href="#g:guard-clause">guard clause</a>)</li>
      <li>Prefer <code class="highlighter-rouge">if</code> to <code class="highlighter-rouge">else</code></li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for standard Python style</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for standard Python style</p>

<h2 id="s:style-defaults">How Can I Specify Default Values for My Functions’ Parameters?</h2>

<ul>
  <li>Give users control over everything <em>and</em> the ability to ignore details</li>
  <li>Example: testing tolerance for image comparison
    <ul>
      <li>How large a difference in color value to notice?</li>
      <li>How many differences above that threshold to tolerate (as percentage)?</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">image_diff</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">per_pixel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="o">...</span><span class="n">implementation</span><span class="o">...</span>
</code></pre>
</div>

<ul>
  <li>Default: “any difference counts” and “more than 1% of pixels differ”
    <ul>
      <li>But can also be called as <code class="highlighter-rouge">image_diff(old, new, per_pixel=2)</code> to raise threshold per pixel</li>
      <li>Or <code class="highlighter-rouge">image_diff(old, new, fraction=0.05)</code> to allow more pixels to differ</li>
      <li>Or <code class="highlighter-rouge">image_diff(old, new, per_pixel=1, fraction=0.005)</code> to raise per-pixel threshold but decrease number of allowed differences</li>
    </ul>
  </li>
  <li>A subtle trap:</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">accumulator</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
    <span class="n">accumulator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">accumulator</span>
</code></pre>
</div>

<ul>
  <li>All calls to <code class="highlighter-rouge">collect</code> will share the same <code class="highlighter-rouge">accumulator</code>
    <ul>
      <li>Python executes code to define a function</li>
      <li>So <code class="highlighter-rouge">set()</code> is called once as the function is being defined</li>
      <li>And <code class="highlighter-rouge">accumulator</code> refers to <em>that</em> set</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">collect</span><span class="p">(</span><span class="s">'first'</span><span class="p">)</span>
<span class="p">{</span><span class="s">'first'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">collect</span><span class="p">(</span><span class="s">'second'</span><span class="p">)</span>
<span class="p">{</span><span class="s">'first'</span><span class="p">,</span> <span class="s">'second'</span><span class="p">}</span>
</code></pre>
</div>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for default parameter values</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for default parameter values</p>

<h2 id="s:style-varargs">How Can I Write Functions to Handle a Variable Number of Arguments?</h2>

<ul>
  <li>Often want functions to be able to accept variable number of arguments (like <code class="highlighter-rouge">print</code> and <code class="highlighter-rouge">max</code> do)</li>
  <li>Can require user to stuff those arguments into a list, e.g., <code class="highlighter-rouge">find_limits([a, b, c, d])</code></li>
  <li>But Python can do this for us</li>
  <li>Declare a single argument whose name starts with <code class="highlighter-rouge">*</code>, and Python will put all “extra” arguments into that tuple
    <ul>
      <li>By convention, this argument is called <code class="highlighter-rouge">args</code></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_limits</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">find_limits</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>This comes after all explicit parameters to avoid ambiguity</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">select_outside</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">high</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">select_outside</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">)</span>
<span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">]</span>
</code></pre>
</div>

<ul>
  <li>Can use the reverse form</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">trim_value</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">saved</span> <span class="o">=</span> <span class="p">[</span><span class="s">'matrix'</span><span class="p">,</span> <span class="s">'low'</span><span class="p">,</span> <span class="s">'high'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">trim_value</span><span class="p">(</span><span class="o">*</span><span class="n">saved</span><span class="p">)</span>
<span class="n">matrix</span> <span class="n">low</span> <span class="n">high</span>
</code></pre>
</div>

<ul>
  <li>Parallel forms exist for keyword arguments
    <ul>
      <li>Prefix catch-all variable’s name with <code class="highlighter-rouge">**</code></li>
      <li>By convention, variable is called <code class="highlighter-rouge">kwargs</code></li>
      <li>Catch-all is a dictionary instead of a tuple</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">settings</span><span class="p">(</span><span class="s">'jenny'</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'CA'</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">'R'</span><span class="p">)</span>
<span class="n">jenny</span> <span class="p">{</span><span class="s">'lang'</span><span class="p">:</span> <span class="s">'R'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">:</span> <span class="s">'CA'</span><span class="p">}</span>
</code></pre>
</div>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for varargs</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for varargs</p>

<h2 id="s:style-summary">Summary</h2>

<p>FIXME: create concept map for style</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>The brain thinks every difference is significant, so removing unnecessary differences in formatting reduces cognitive load.
</li><li>Python software should always conform to the formatting the rules in PEP 8.
</li><li>Use <code class="highlighter-rouge">name=value</code> to define a default value for a function parameter.
</li><li>Use <code class="highlighter-rouge">*args</code> to define a catch-all parameter for functions taking a variable number of unnamed arguments.
</li><li>Use <code class="highlighter-rouge">**kwargs</code> to define a catch-all parameter for functions taking a variable number of named arguments.
</li>
  </ul>
</div>


          

          <h1 id="s:refactoring">Refactoring</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can I go about reorganizing code when I’m making changes?
</li>
  </ul>
</div>


          <ul>
  <li><a href="#g:refactor">Refactoring</a> is changing the structure of code without changing what it does
    <ul>
      <li>Like refactoring an equation</li>
      <li>Because nobody gets it right the first time [<a href="#Bran1995">Bran1995</a>]</li>
    </ul>
  </li>
  <li>Most discussions of refactoring focus on <a href="#g:oop">object-oriented programming</a></li>
  <li>But many patterns can and should be used to clean up <a href="#g:procedural-programming">procedural</a> code
    <ul>
      <li>An example of <a href="#g:design-patterns">design patterns</a></li>
    </ul>
  </li>
</ul>

<h2 id="s:refactoring-replace-value-with-name">Replace Value With Name</h2>

<ul>
  <li>I.e., define a constant</li>
  <li>Easier to understand when read aloud (which is always a good test)</li>
  <li>Easier to change
    <ul>
      <li>You don’t think you’ll have to, but then people want to use your software on Mars [<a href="#Mak2006">Mak2006</a>]</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">num_days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="n">SECONDS_PER_DAY</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
<span class="o">...</span>
<span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">num_days</span> <span class="o">*</span> <span class="n">SECONDS_PER_DAY</span>
</code></pre>
</div>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for replacing value with name</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: exercises for replacing value with name</p>

<h2 id="s:refactoring-hoist-repeated">Hoist Repeated Calculation Out of Loop</h2>

<ul>
  <li>Move something that is being re-calculated inside a loop out of the loop</li>
  <li>More efficient</li>
  <li>More readable: makes it clear that the value actually <em>is</em> the same
    <ul>
      <li>And by naming the common value, you’re signalling its meaning</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">all_signals</span><span class="p">:</span>
    <span class="n">transform</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">sample</span> <span class="o">/</span> <span class="n">normalize</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="n">scaling</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">normalize</span>
<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">all_signals</span><span class="p">:</span>
    <span class="n">transform</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for hoist repeated calculation</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: exercises for hoist repeated calculation</p>

<h2 id="s:refactoring-repeated-test">Replace Repeated Test With Flag</h2>

<ul>
  <li>Booleans are values and can be assigned</li>
  <li>Note: do <em>not</em> need to compare to <code class="highlighter-rouge">True</code> or <code class="highlighter-rouge">False</code>
    <ul>
      <li><code class="highlighter-rouge">if greater == True</code> is the same as <code class="highlighter-rouge">if greater</code></li>
      <li><code class="highlighter-rouge">if greater == False</code> is the same as <code class="highlighter-rouge">if not greater</code></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">greater</span> <span class="o">=</span> <span class="n">estimate</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
<span class="o">...</span><span class="n">other</span> <span class="n">code</span> <span class="n">that</span> <span class="n">possibly</span> <span class="n">changes</span> <span class="n">estimate</span><span class="o">...</span>
<span class="k">if</span> <span class="n">greater</span><span class="p">:</span>
    <span class="o">...</span><span class="n">do</span> <span class="n">something</span><span class="o">...</span>
</code></pre>
</div>

<ul>
  <li>Using a flag instead of repeating the test is therefore like assigning a calculation to a “constant” and using it later</li>
  <li>Like using a constant, doing this makes intention clearer (these really are the same test) and future changes easier</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">scaling</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">THRESHOLD</span><span class="p">:</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span>
    <span class="o">...</span><span class="n">process</span> <span class="n">data</span> <span class="n">to</span> <span class="n">create</span> <span class="n">score</span><span class="o">...</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">THRESHOLD</span><span class="p">:</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">**</span> <span class="mi">2</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">scaling</span><span class="p">):</span>
    <span class="n">is_large_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">THRESHOLD</span>
    <span class="k">if</span> <span class="n">is_large_data</span><span class="p">:</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span>
    <span class="o">...</span><span class="n">process</span> <span class="n">data</span> <span class="n">to</span> <span class="n">create</span> <span class="n">score</span><span class="o">...</span>
    <span class="k">if</span> <span class="n">is_large_data</span><span class="p">:</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">**</span> <span class="mi">2</span>
</code></pre>
</div>

<ul>
  <li>If the test needs to change to <code class="highlighter-rouge">&gt;=</code>, the <code class="highlighter-rouge">AFTER</code> version is more likely to be right the first time</li>
</ul>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for replace repeated test</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: exercises for replace repeated test</p>

<h2 id="s:refactoring-in-place">Use In-Place Operator</h2>

<ul>
  <li>An <a href="#g:in-place-operator">in-place operator</a> does a calculation with two values and overwrites one of those values</li>
  <li>Instead of <code class="highlighter-rouge">x = x + 1</code>, write <code class="highlighter-rouge">x += 1</code></li>
  <li><code class="highlighter-rouge">samples[least_factor_index, max(current_offset, offset_limit)] *= scaling_factor</code> is much easier to read if the array indexing <em>isn’t</em> repeated</li>
  <li>Using in-place operators also makes it clear that a value is being overwritten
    <ul>
      <li><code class="highlighter-rouge">samples[day-1, hour, minute-1] = samples[day-1, hour, minute+1] + latest_reading</code> is really, really hard to spot</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">for</span> <span class="n">least_factor_index</span> <span class="ow">in</span> <span class="n">all_factor_indexes</span><span class="p">:</span>
    <span class="n">samples</span><span class="p">[</span><span class="n">least_factor_index</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_offset</span><span class="p">,</span> <span class="n">offset_limit</span><span class="p">)]</span> <span class="o">=</span> \
        <span class="n">samples</span><span class="p">[</span><span class="n">least_factor_index</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_offset</span><span class="p">,</span> <span class="n">offset_limit</span><span class="p">)]</span> <span class="o">*</span> <span class="n">scaling_factor</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="k">for</span> <span class="n">least_factor_index</span> <span class="ow">in</span> <span class="n">all_factor_indexes</span><span class="p">:</span>
    <span class="n">samples</span><span class="p">[</span><span class="n">least_factor_index</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_offset</span><span class="p">,</span> <span class="n">offset_limit</span><span class="p">)]</span> <span class="o">*=</span> <span class="n">scaling_factor</span>
</code></pre>
</div>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for in-place operator</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: exercises for in-place operator</p>

<h2 id="s:refactoring-short-circuits">Place Short Circuits Early</h2>

<ul>
  <li>A <a href="#g:short-circuit">short circuit</a> test is a quick check to handle a special case</li>
  <li>Place these near the start of functions to give readers a sense of what the remaining code is there to handle</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">rescale_by_average</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">w</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">a</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">rescale_by_average</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">values</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">factors</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">weights</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">w</span>
    <span class="n">a</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">a</span>
</code></pre>
</div>

<h3 id="common-problems-4">Common Problems</h3>

<p>FIXME: common problems for short circuits</p>

<h3 id="exercises-4">Exercises</h3>

<p>FIXME: exercises for short circuits</p>

<h2 id="s:refactoring-default-override">Default and Override</h2>

<ul>
  <li>Make default clear by putting it first, unconditionally</li>
  <li>Then override in special case</li>
  <li>Means executing two assignments instead of one, but fewer lines of code</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">if</span> <span class="n">configuration</span><span class="p">[</span><span class="s">'threshold'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">UPPER_BOUND</span><span class="p">:</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">if</span> <span class="n">configuration</span><span class="p">[</span><span class="s">'threshold'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">UPPER_BOUND</span><span class="p">:</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.8</span>
</code></pre>
</div>

<ul>
  <li>For simple cases, can put onto one line</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># SOMETIMES</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">if</span> <span class="n">configuration</span><span class="p">[</span><span class="s">'threshold'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">UPPER_BOUND</span><span class="p">:</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.8</span>
</code></pre>
</div>

<ul>
  <li>Some programmers prefer to use <a href="#g:conditional-expression">conditional expression</a></li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BETTER</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="k">if</span> <span class="n">configuration</span><span class="p">[</span><span class="s">'threshold'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">UPPER_BOUND</span> <span class="k">else</span> <span class="mf">1.0</span>
</code></pre>
</div>

<ul>
  <li>However, this puts the default last instead of first, which is unclear
    <ul>
      <li>Can invert the sense of the test, but that’s also confusing</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-5">Common Problems</h3>

<p>FIXME: common problems for default and override</p>

<h3 id="exercises-5">Exercises</h3>

<p>FIXME: create exercises for default and override</p>

<h2 id="s:refactoring-extract-function">Extract Function</h2>

<ul>
  <li>Move common operations into functions to reduce amount of code that needs to be read</li>
  <li>Move complex operations into functions to reduce cognitive load
    <ul>
      <li>Signals that something can be understood separately</li>
    </ul>
  </li>
  <li>If you can’t think of a plausible name, or if a lot of data has to come <em>out</em> of the function,
it probably shouldn’t be extracted</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">check_neighbors</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">grid</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="ow">and</span> \
       <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">grid</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
        <span class="o">...</span><span class="n">look</span> <span class="n">at</span> <span class="nb">all</span> <span class="n">four</span> <span class="n">neighbors</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="k">def</span> <span class="nf">check_neighbors</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">in_interior</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="o">...</span><span class="n">look</span> <span class="n">at</span> <span class="nb">all</span> <span class="n">four</span> <span class="n">neighbors</span><span class="o">...</span>

<span class="k">def</span> <span class="nf">in_interior</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="o">...</span><span class="n">four</span> <span class="n">tests</span> <span class="k">as</span> <span class="n">above</span><span class="o">...</span>
</code></pre>
</div>

<ul>
  <li>Function might be usable in other contexts
    <ul>
      <li>But even if not, it is (again) easier to read aloud</li>
    </ul>
  </li>
  <li>Use original variable names as parameter names during refactoring to reduce typing</li>
  <li>Multi-part conditionals, parts of long equations, and bodies of loops are good candidates for extraction</li>
</ul>

<h3 id="common-problems-6">Common Problems</h3>

<p>FIXME: common problems for extract function</p>

<h3 id="exercises-6">Exercises</h3>

<p>FIXME: exercises for extract function</p>

<h2 id="s:refactoring-combine-functions">Combine Functions</h2>

<ul>
  <li>Opposite of Extract Function</li>
  <li>If operations always done together, might be more efficient to combine</li>
  <li>And <em>might</em> be easier to understand</li>
  <li>But probably decreases reusability</li>
  <li>And usually makes code harder to maintain</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">count_vowels</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num</span>

<span class="k">def</span> <span class="nf">count_consonants</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">CONSONANTS</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="k">def</span> <span class="nf">count_vowels_and_consonants</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">num_vowels</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_consonants</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
            <span class="n">num_vowels</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">CONSONANTS</span><span class="p">:</span>
            <span class="n">num_consonants</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num_vowels</span><span class="p">,</span> <span class="n">num_consonants</span>
</code></pre>
</div>

<ul>
  <li>Note that this assumes characters are either vowels or consonants, where the split implementation didn’t
    <ul>
      <li>This implementation <em>could</em> use two independent tests instead of <code class="highlighter-rouge">elif</code></li>
      <li>But you probably didn’t notice the change in semantics</li>
    </ul>
  </li>
  <li>One sign that functions shouldn’t have been combined is how often people use the combination and throw some results away</li>
</ul>

<h3 id="common-problems-7">Common Problems</h3>

<p>FIXME: common problems for combine functions</p>

<h3 id="exercises-7">Exercises</h3>

<p>FIXME: exercises for combine functions</p>

<h2 id="s:refactoring-lookup">Create Lookup Table</h2>

<ul>
  <li>Easier to understand (and therefore maintain) lookup tables than complicated conditionals
    <ul>
      <li>An example of <a href="#g:declarative-programming">declarative programming</a> (see <a href="#s:automate">Chapter 2</a>)</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="k">def</span> <span class="nf">count_vowels_and_consonants</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="o">...</span><span class="k">as</span> <span class="n">above</span><span class="o">...</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>

<span class="n">IS_VOWEL</span> <span class="o">=</span> <span class="p">{</span><span class="s">'a'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'b'</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'c'</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
<span class="n">IS_CONSONANT</span> <span class="o">=</span> <span class="p">{</span><span class="s">'a'</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'b'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'c'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">count_vowels_and_consonants</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">num_vowels</span> <span class="o">=</span> <span class="n">num_consonants</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">num_vowels</span> <span class="o">+=</span> <span class="n">IS_VOWEL</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="n">num_consonants</span> <span class="o">+=</span> <span class="n">IS_CONSONANT</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">num_vowels</span><span class="p">,</span> <span class="n">num_consonants</span>
</code></pre>
</div>

<ul>
  <li>Note that this fails for spaces, punctuation, etc.</li>
  <li>Every lookup table should either:
    <ul>
      <li>Have a value for “none of the above”</li>
      <li>Or raise an error</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BETTER</span>

<span class="n">IS_VOWEL</span> <span class="o">=</span> <span class="p">{</span><span class="s">'a'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'b'</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'c'</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
<span class="n">IS_CONSONANT</span> <span class="o">=</span> <span class="p">{</span><span class="s">'a'</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'b'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'c'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">count_vowels_and_consonants</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">num_vowels</span> <span class="o">=</span> <span class="n">num_consonants</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">num_vowels</span> <span class="o">+=</span> <span class="n">IS_VOWEL</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">num_consonants</span> <span class="o">+=</span> <span class="n">IS_CONSONANT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">num_vowels</span><span class="p">,</span> <span class="n">num_consonants</span>
</code></pre>
</div>

<ul>
  <li>Note: in this case, could use a set, check for membership, and increment</li>
  <li>So we should only use lookup tables when weights differ among elements</li>
</ul>

<h3 id="common-problems-8">Common Problems</h3>

<p>FIXME: common problems for create lookup table</p>

<h3 id="exercises-8">Exercises</h3>

<p>FIXME: exercises for create lookup table</p>

<h2 id="s:refactoring-comprehension">Replace Loop With Comprehension</h2>

<ul>
  <li>Many language features exist to give programmers something to refactor <em>to</em>
    <ul>
      <li>See a pattern in many contexts</li>
      <li>Provide syntactic support for it</li>
      <li>Explain in terms of original</li>
    </ul>
  </li>
  <li>Comprehensions exist to replace simple loops</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
</code></pre>
</div>

<ul>
  <li>Easier to read <em>for simple calculations</em></li>
  <li>Becomes more complicated to understand with conditionals</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</code></pre>
</div>

<ul>
  <li>But <code class="highlighter-rouge">if</code>-<code class="highlighter-rouge">else</code> is structured differently</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># BEFORE</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># AFTER</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
</code></pre>
</div>

<ul>
  <li>Cross-product loops are straightforward</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># BEFORE
result = []
for left in 'ABC':
    for right in 'xyz':
        result.append(left + right)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code># AFTER
result = [left + right for left in 'ABC' for right in 'xyz']
</code></pre>
</div>

<ul>
  <li>What’s hardest to remember is the equivalent of nested loops where the inner loop depends on the outer
    <ul>
      <li>Order in expression feels inverted</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>words = ['first', 'second', 'third']
flattened = [c for w in words for c in w]
</code></pre>
</div>

<ul>
  <li>Works for sets, dictionaries, and anything else that can be iterated over</li>
  <li>This is the direction most modern Python is going, so write comprehensions for new code and refactor wherever you can</li>
  <li>And don’t be afraid (at least during development) to create temporaries</li>
</ul>

<h3 id="common-problems-9">Common Problems</h3>

<p>FIXME: common problems for replace loop with comprehension</p>

<h3 id="exercises-9">Exercises</h3>

<p>FIXME: exercises for replace loop with comprehension</p>

<h2 id="s:refactoring-summary">Summary</h2>

<ul>
  <li>A good test of code quality: each plausible small change to functionality requires one change in one place</li>
</ul>

<p>FIXME: create concept map for refactoring</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Reorganizing code in consistent ways makes errors less likely.
</li><li>Replace a value with a name to make code more readable and to forestall typing errors.
</li><li>Replace a repeated test with a flag to ensure consistency.
</li><li>Turn small pieces of large functions into functions in their own right, even if they are only used once.
</li><li>Combine functions if they are always used together on the same inputs.
</li><li>Use lookup tables to make decision rules easier to follow.
</li><li>Use comprehensions instead of loops.
</li>
  </ul>
</div>


          

          <h1 id="s:structure">Project Structure</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How should I organize the files and directories in my project?
</li>
  </ul>
</div>


          <ul>
  <li>Project organization is like a diet
    <ul>
      <li>There is no such thing as “no diet”, just a good one or a bad one</li>
      <li>Similarly, there is no such thing as “no project organization”</li>
      <li>Your project is either organized <em>well</em> or organized <em>poorly</em></li>
    </ul>
  </li>
  <li>Small pieces in predictable places are easier to recombine than large chunks that have to be re-read</li>
  <li>Organizing software into installable packages is more than just convention
    <ul>
      <li>Certain things have to be in certain places in order for Python to find them</li>
    </ul>
  </li>
  <li>Using <a href="#g:virtual-environment">virtual environments</a> allows you to work on many projects at once without tripping over yourself
    <ul>
      <li>Slowly being superceded by more general solutions like <a href="https://en.wikipedia.org/wiki/Docker_(software)">Docker</a>, but still the easiest solution for most of us</li>
    </ul>
  </li>
</ul>

<h2 id="s:structure-noble">What Are Noble’s Rules?</h2>

<ul>
  <li>From [<a href="#Nobl2009">Nobl2009</a>]</li>
  <li>Top level is logical, next level is chronological
    <ul>
      <li>Source code in <code class="highlighter-rouge">src/</code> (short for “source”)
        <ul>
          <li>Source for C/C++ and the like go here</li>
        </ul>
      </li>
      <li>Compiled programs in <code class="highlighter-rouge">bin/</code> (short for “binary”, meaning “not text”)
        <ul>
          <li>Executables for C/C++ programs go here (but not under version control)</li>
          <li>Shell scripts and Python or R programs go here (but under version control, which can be confusing)</li>
        </ul>
      </li>
      <li>Raw data in <code class="highlighter-rouge">data/</code>
        <ul>
          <li>If it’s too large, use <code class="highlighter-rouge">data/</code> to store data references</li>
        </ul>
      </li>
      <li>Results in <code class="highlighter-rouge">results/</code></li>
      <li>Documentation and manuscripts in <code class="highlighter-rouge">doc/</code></li>
    </ul>
  </li>
  <li>Directory names under <code class="highlighter-rouge">data/</code> and <code class="highlighter-rouge">results/</code> are <code class="highlighter-rouge">YYYY-MM-DD</code> so that they can be sorted chronologically</li>
  <li>Filenames should be easy to match consistently with shell wildcards
    <ul>
      <li>E.g., <code class="highlighter-rouge">species-organ-treatment.csv</code>, like <code class="highlighter-rouge">human-kidney-cm200.csv</code></li>
      <li>Allows <code class="highlighter-rouge">human-*-cm200.csv</code> to match all human organs, or <code class="highlighter-rouge">*-kidney-*.csv</code> to match all kidney data</li>
      <li>Don’t worry about long directory names: <a href="#g:tab-completion">tab completion</a> means you only have to type them once</li>
    </ul>
  </li>
</ul>

<figure>
  <figcaption>Project Layout</figcaption>
  <img id="f:structure-layout" src="../../files/noble.svg" alt="Project Layout" />
</figure>

<ul>
  <li>A few files Noble didn’t mention that have become conventional
    <ul>
      <li><code class="highlighter-rouge">README</code>: one-paragraph description of the project</li>
      <li><code class="highlighter-rouge">LICENSE</code>: the project’s license</li>
      <li><code class="highlighter-rouge">CONDUCT</code>: its code of conduct (discussed below)</li>
      <li><code class="highlighter-rouge">CITATION</code>: how the work should be cited
        <ul>
          <li>May have a separate <code class="highlighter-rouge">CONTRIBUTORS</code> file, or list contributors in <code class="highlighter-rouge">CITATION</code></li>
        </ul>
      </li>
      <li>These files may be plain text or Markdown, or have no suffix at all, but please use the principal names as given</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for Noble’s Rules</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: create exercises for Noble’s Rules</p>

<h2 id="s:structure-summary">Summary</h2>

<p>FIXME: create concept map for project structure</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Put source code for compilation in <code class="highlighter-rouge">src/</code>, runnable code in <code class="highlighter-rouge">bin/</code>, raw data in <code class="highlighter-rouge">data/</code>, results in <code class="highlighter-rouge">results/</code>, and documentation and manuscripts in <code class="highlighter-rouge">doc/</code>.
</li><li>Use file and directory names that are easy to match and include dates for the level under <code class="highlighter-rouge">data/</code> and <code class="highlighter-rouge">results/</code>.
</li><li>Create README, LICENSE, CONDUCT, and CITATION files in the root directory of the project.
</li>
  </ul>
</div>


          

          <h1 id="s:inclusive">Including Everyone</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>Why should I make my project welcoming for everyone?
</li><li>Why do I need a license for my work?
</li><li>What license should I use for my work?
</li><li>How should I tell people what they can and cannot do with my work?
</li><li>Why should my project have an explicit Code of Conduct?
</li><li>How can I be a good ally?
</li>
  </ul>
</div>


          <ul>
  <li>Previous lesson talked about the physical structure of a project</li>
  <li>This one talks about the social structure</li>
  <li>Sources:
    <ul>
      <li><em><a href="https://producingoss.com/">Producing Open Source Software</a></em> describes how good open source software projects are run</li>
      <li>[<a href="#Boll2014">Boll2014</a>] explains what a <a href="#g:commons">commons</a> is and when it’s an appropriate model</li>
    </ul>
  </li>
  <li>Avoid <a href="http://www.jofreeman.com/joreen/tyranny.htm">the tyranny of structurelessness</a>
    <ul>
      <li>Every group of people has a power structure</li>
      <li>Only question is whether it is formal and accountable,
or informal and unaccountable</li>
    </ul>
  </li>
</ul>

<h2 id="s:inclusive-license">How Should I License My Software, Data, and Reports?</h2>

<ul>
  <li>If the law or a publication agreement prevents people from reading your work or using your software,
you’re excluding them
    <ul>
      <li>And probably hurting your own career</li>
    </ul>
  </li>
  <li>Creative works are automatically eligible for intellectual property (and thus copyright) protection</li>
  <li>Every creative work has some sort of license - the only question is whether authors and users know what it is</li>
  <li>See [<a href="#Mori2012">Mori2012</a>] and <a href="http://www.astrobetter.com/blog/2014/03/10/the-whys-and-hows-of-licensing-scientific-code/">this blog post</a> for overviews from a scientist’s point of view</li>
  <li>Every repository (version control or otherwise) should therefore include an explicit license
    <ul>
      <li>Usually <code class="highlighter-rouge">LICENSE</code> or <code class="highlighter-rouge">LICENSE.txt</code> in root directory</li>
      <li>Clearly states under which license(s) the content is being made available</li>
      <li>Plural because code, data, and text may be covered by different licenses</li>
    </ul>
  </li>
  <li>Choose a license early
    <ul>
      <li>Otherwise, each time a new collaborator starts contributing,
they will hold copyright on their work
and will thus need to be asked for approval when a license is chosen</li>
    </ul>
  </li>
  <li><strong>Don’t write your own</strong>, even if you are a lawyer
    <ul>
      <li>Legalese is a highly technical language, and words don’t mean what you think they mean</li>
    </ul>
  </li>
  <li>A few licenses are by far the most popular
    <ul>
      <li>Choosing a common license makes project more intelligible</li>
      <li><a href="http://opensource.org/licenses">Open Source Inititative</a> license list</li>
      <li><a href="http://choosealicense.com/">choosealicense.com</a> will help you find a license that suits your needs</li>
    </ul>
  </li>
  <li>Considerations:
    <ol>
      <li>Do you want to license the code at all?</li>
      <li>Is the content you are licensing source code?</li>
      <li>Do you require people distributing derivative works to also distribute their code?</li>
      <li>Do you want to address patent rights?</li>
      <li>Is your license compatible with the licenses of the software you depend on?
        <ul>
          <li>E.g., can’t use MIT on top of GPL</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Licenses for software
    <ul>
      <li><a href="#g:mit-license">MIT/BSD</a>: do whatever you want as long as you cite the original source,
and the authors accept no responsibility if things go wrong</li>
      <li><a href="#g:gpl">GPL</a>: as above, but requires similar sharing</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>You may copy, distribute and modify the software as long as you track changes/dates in source files.
Any modifications to or software including (via compiler) GPL-licensed code must also be made available under the GPL
along with build &amp; install instructions.</p>

  <p>— <a href="https://tldrlegal.com/license/gnu-general-public-license-v3-(gpl-3)">tl;dr</a></p>
</blockquote>

<ul>
  <li>We recommend MIT
    <ul>
      <li>Fewest complications down the road</li>
      <li>The last thirty years shows that it’s good enough to keep work open</li>
    </ul>
  </li>
  <li>Use <a href="https://creativecommons.org/">Creative Commons</a> licenses for data and manuscripts
    <ul>
      <li>Written and checked by lawyers</li>
      <li>Well understood by the community</li>
    </ul>
  </li>
  <li><a href="#g:cc-0">CC-0</a>: public domain
    <ul>
      <li>Usually the best choice for data, since it simplifies aggregate analysis</li>
    </ul>
  </li>
  <li><a href="#g:cc-by">CC-BY</a>: do whatever you want as long as you cite the original source
    <ul>
      <li>Use for manuscripts, since you <em>want</em> people to share them widely</li>
    </ul>
  </li>
  <li>Other restrictions all inhibit specific use cases
    <ul>
      <li>-ND: no derivative works (e.g., prevents translation or reformatting)</li>
      <li>-NC: no commercial use without explicit permission
        <ul>
          <li>Some publishers try to imply that -NC means <em>nobody</em> can make money from it, which is untrue</li>
        </ul>
      </li>
      <li>-SA: share-alike</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for licensing</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: create exercises for licensing</p>

<h2 id="s:inclusive-conduct">Why Should I Establish a Code of Conduct for My Project?</h2>

<ul>
  <li>A CoC lays out the expectations for personal interaction in your project
    <ul>
      <li>Explicitly communicate standards to which this project holds its participants</li>
      <li>Encourages newcomers to engage with the project</li>
    </ul>
  </li>
  <li>Important to make clear how to report and who handles
    <ul>
      <li>Without that, it’s meaningless</li>
    </ul>
  </li>
  <li>We recommend the <a href="https://www.contributor-covenant.org">Contributor Covenant</a>
    <ul>
      <li>Provides examples of acceptable and unacceptable behavior for your project</li>
      <li>Specifies how unacceptable behavior will be handled</li>
      <li>Specifically designed for project contributors rather than conference participants</li>
      <li>Use the <a href="http://geekfeminism.wikia.com/wiki/Conference_anti-harassment/Policy">model code of conduct</a> from the <a href="http://geekfeminism.wikia.com/">Geek Feminism Wiki</a> for in-person events</li>
    </ul>
  </li>
  <li>Reduces the uncertainty that project participants face about what is acceptable and unacceptable behavior
    <ul>
      <li>While you might think this is obvious,
long experience suggests that articulating it clearly and concisely reduces problems caused by have different expectations</li>
      <li>You don’t expect to have a fire, but every large building or event should have a fire safety plan</li>
    </ul>
  </li>
  <li>Welcomes newcomers specifically, which can help grow your project and encourage user feedback
    <ul>
      <li>Particularly important for people from marginalized groups, who hae probably experienced harassment or unwelcoming behavior before</li>
      <li>Having a CoC signals that your project is trying to be a better place than YouTube, Twitter, and other cesspools</li>
    </ul>
  </li>
  <li>It delineates responsibilities within the project and provides specific points of contact in case of misconduct or harassment,
as well as specifying the process to be followed in these cases</li>
  <li>Some people may (still) push back claiming that it’s unnecessary, or that it infringes freedom of speech, or…
    <ul>
      <li>What they really mean is that thinking about unfairness that may have benefited from makes them uncomfortable</li>
      <li>In our experience, that is also a very useful filter on contributors…</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for code of conduct</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: create exercises for code of conduct</p>

<h2 id="s:inclusive-ally">How Can I Be a Good Ally for Members of Marginalized Groups?</h2>

<ul>
  <li>Drawn primarily from <a href="https://frameshiftconsulting.com/ally-skills-workshop/">Frameshift Consulting Ally Skills Workshop</a>
    <ul>
      <li>Which you should attend if you can</li>
    </ul>
  </li>
  <li>Privilege: an unearned advantage given by society to some people but not all</li>
  <li>Oppression: systemic, pervasive inequality that benefits the privileged and harms those without privilege</li>
  <li>Target: someone who suffers from oppression
    <ul>
      <li>Often called “a member of a marginalized group”, but that phrasing is deliberately passive</li>
      <li>Targets don’t choose to be marginalized: those with privilege marginalize them</li>
    </ul>
  </li>
  <li>Ally: a member of a privileged group who is working to understand their own privilege and end oppression</li>
  <li>Example
    <ul>
      <li>Privilege: being able to walk into a store and have the owner assume you’re there to buy things, not to steal them</li>
      <li>Oppression: the self-perpetuating stories told about (for example) indigenous people being thieves,
and the actions people take as a result of them</li>
      <li>Target: an indigenous person who wants to buy milk</li>
      <li>Ally: a white person who pays attention to lesson like this one (raising their own awareness),
calls out peers who spread racist stories (peer action),
or asks the shopkeeper whether they should leave too (situational action)</li>
    </ul>
  </li>
  <li>Why be an ally?
    <ul>
      <li>Because you can:
taking action to value diversity results in worse performance ratings for minority and female leaders,
while ethnic majority or male leaders who do this aren’t penalized [<a href="#Hekm2017">Hekm2017</a>]</li>
      <li>Because you have benefited, even if you don’t realize it</li>
      <li>As soon as you acknowledge that (for example) women are called on less often than men,
or are less likely to get an interview or a publication given identical work,
you have to acknowledge that white and Asian males are <em>more</em> likely to get these benefits than their performance alone deserves</li>
      <li>See discussion above about willingness or refusal to acknowledge this being a good filter on project participants
    1.  Be short, simple, firm
    1.  Don’t try to be funny
    1.  Play for the audience
    1.  Practice simple responses
    1.  Pick your battles
    1.  Don’t shame or insult one group when trying to help another</li>
      <li>E.g., don’t call someone ugly or stupid when what you really mean is that they’re racist or homophobic</li>
    </ul>
  </li>
  <li><a href="https://captainawkward.com/">Captain Awkward</a> has useful advice</li>
  <li><a href="http://geekfeminism.wikia.com/wiki/Charles%27_Rules_of_Argument">Charles’ Rules of Argument</a> are very useful online
    <ol>
      <li>Don’t go looking for an argument</li>
      <li>State your position once, speaking to the audience</li>
      <li>Wait for absurd replies</li>
      <li>Reply once more to correct any misunderstandings of your original statement</li>
      <li>Do not reply again - go do something fun instead</li>
    </ol>
  </li>
  <li>Recognize that good principles sometimes conflict
    <ul>
      <li>“A manager consistently uses male pronouns to refer to software and people of unknown gender.
When you tell them it makes you uncomfortable to treat maleness as the norm,
they say that male is the default gender in their first language
and you should be more considerate of people from other cultures.”</li>
      <li>Respect for other cultures vs. being inclusive of women</li>
      <li>In this case, discomfort of changing pronouns is less than career harm caused by being exclusionary</li>
    </ul>
  </li>
  <li>Change the terms of the debate
    <ul>
      <li>“Why should we take diversity into account when hiring? Why don’t we just hire the best candidate?”</li>
      <li>Because taking diversity into account <em>is</em> hiring the best candidate</li>
      <li>If you can run a mile in four minutes, and I can do it in 4:15 with a ball and chain on my leg, which one of us is the better athlete?</li>
      <li>Which one of us will perform better <em>if the impediment is removed</em>?</li>
      <li>So sure, if you intend to preserve an exclusionary culture in this lab,
considering how much someone has achieved despite systemic unfairness might not make sense,
but you’re not arguing for that, are you?</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for ally skills</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: create exercises for ally skills</p>

<h2 id="s:inclusive-summary">Summary</h2>

<p>FIXME: create concept map for making an inclusive project</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Create an explicit Code of Conduct for your project modelled on the Contributor Covenant.
</li><li>Be clear about how to report violations of the Code of Conduct and who will handle such reports.
</li><li>People who are not lawyers should not try to write licenses.
</li><li>Every project should include an explicit license to make clear who can do what with the material.
</li><li>People who incorporate GPL’d software into their own software must make their software also open under the GPL license; most other open licenses do not require this.
</li><li>The Creative Commons family of licenses allow people to mix and match requirements and restrictions on attribution, creation of derivative works, further sharing, and commercialization.
</li><li>Be proactive about welcoming and nurturing community members.
</li>
  </ul>
</div>


          

          <h1 id="s:packages">Packages</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How can I manage the libraries my project relies on?
</li><li>How can I package up my work for others to use?
</li>
  </ul>
</div>


          <blockquote>
  <p>Another response of the wizards, when faced with a new and unique situation, was to look through their libraries to see if it had ever happened before.
This was…a good survival trait.
It meant that in times of danger you spent the day sitting very quietly in a building with very thick walls.</p>

  <p>– Terry Pratchett</p>
</blockquote>

<ul>
  <li>A programming language is a way to build and combine software libraries</li>
  <li>Every widely-used language now has a shared repository for installable packages</li>
  <li>This lesson shows you how to use Python’s tools</li>
  <li>Based in part on <a href="https://python-102.readthedocs.io/">Python 102</a> by <a href="https://ccit.clemson.edu/research/researcher-profiles/ashwin-srinath/">Ashwin Srinath</a></li>
</ul>

<h2 id="s:packages-modules">How Can I Turn a Set of Python Source Files Into a Module?</h2>

<ul>
  <li>Any Python source file can be imported
    <ul>
      <li>Statements are executed as the file is loaded</li>
      <li>Variables defined in the file are then available as <code class="highlighter-rouge">module.name</code></li>
      <li>This is why Python files should be named using pothole_case instead of kebab-case</li>
    </ul>
  </li>
  <li>Example: put constant and two functions used in Zipf’s Law study in <code class="highlighter-rouge">zipf.py</code></li>
</ul>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>


<span class="n">RELATIVE_ERROR</span> <span class="o">=</span> <span class="mf">0.05</span>


<span class="k">def</span> <span class="nf">make_zipf</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Zipf distribution must have at least one element'</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">is_zipf</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">RELATIVE_ERROR</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Cannot test Zipfiness without data'</span>
    <span class="n">scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">/</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">]</span>
    <span class="n">perfect</span> <span class="o">=</span> <span class="n">make_zipf</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">scaled</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">perfect</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">rel</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>Can now <code class="highlighter-rouge">import zipf</code>, <code class="highlighter-rouge">from zipf import is_zipf</code>, etc.</li>
</ul>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">zipf</span> <span class="kn">import</span> <span class="n">make_zipf</span><span class="p">,</span> <span class="n">is_zipf</span>

<span class="n">generated</span> <span class="o">=</span> <span class="n">make_zipf</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'generated distribution: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">generated</span><span class="p">))</span>
<span class="n">generated</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="k">print</span><span class="p">(</span><span class="s">'passes test with default tolerance: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">is_zipf</span><span class="p">(</span><span class="n">generated</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'passes test with tolerance of 1.0: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">is_zipf</span><span class="p">(</span><span class="n">generated</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)))</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>generated distribution: [1.0, 0.5, 0.3333333333333333, 0.25, 0.2]
passes test with default tolerance: False
passes test with tolerance of 1.0: True
</code></pre>
</div>

<ul>
  <li>Running this program creates a sub-directory called <code class="highlighter-rouge">__pycache__</code>
    <ul>
      <li>Holds the compiled version of the imported files</li>
      <li>Almost always put <code class="highlighter-rouge">__pycache__</code> in <code class="highlighter-rouge">.gitignore</code></li>
    </ul>
  </li>
  <li>When <code class="highlighter-rouge">import</code> executes, it checks in order:
    <ul>
      <li>Is this module already in memory?</li>
      <li>Is the cached compiled version younger than the source file?</li>
    </ul>
  </li>
  <li>What if we want to be able to import <em>and</em> to be able to run as a program?
    <ul>
      <li>Python creates a variable called <code class="highlighter-rouge">__name__</code> in each module</li>
      <li>If the module is the main program, that variable is assigned the string <code class="highlighter-rouge">'__main__'</code></li>
      <li>Otherwise, it has the module’s name</li>
    </ul>
  </li>
</ul>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>

<span class="n">USAGE</span> <span class="o">=</span> <span class="s">'''zipf num [num...]: are the given values a Zipfy?'''</span>
<span class="n">RELATIVE_ERROR</span> <span class="o">=</span> <span class="mf">0.05</span>


<span class="k">def</span> <span class="nf">make_zipf</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
    <span class="o">...</span><span class="k">as</span> <span class="n">before</span><span class="o">...</span>

<span class="k">def</span> <span class="nf">is_zipf</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">RELATIVE_ERROR</span><span class="p">):</span>
    <span class="o">...</span><span class="k">as</span> <span class="n">before</span><span class="o">...</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">USAGE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">is_zipf</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'{}: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>Code guarded by <code class="highlighter-rouge">if __name__ == '__main__'</code> isn’t executed when file loaded by something else</li>
  <li>Can test by re-running <code class="highlighter-rouge">use.py</code>
    <ul>
      <li>The usage message doesn’t appear, which means the main block wasn’t executed, which is what we want</li>
      <li>So now we can go back and put its content in a function and call that function, because we are good people</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for writing modules</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: create exercises for writing modules</p>

<h2 id="s:packages-install">How Can I Install a Python Package?</h2>

<ul>
  <li><code class="highlighter-rouge">pip install package</code>
    <ul>
      <li>Checks to see if the package is already installed (or needs to be upgraded)</li>
      <li>Downloads from <a href="https://pypi.org/">PyPI</a> (the Python Package Index)</li>
      <li>Unpacks and installs</li>
    </ul>
  </li>
  <li>May require admin privileges to write files, depending on where Python is installed</li>
  <li><code class="highlighter-rouge">pip install -r filename</code> will install dependencies listed in a file
    <ul>
      <li>File is conventionally called <code class="highlighter-rouge">requirements.txt</code> and placed in the project’s root directory</li>
    </ul>
  </li>
  <li>Can be just a list of package names</li>
  <li>Or specify exact versions, minimum versions, etc.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>request
scipy==1.1.0
tdda&gt;=1.0
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">pip freeze</code> will print exact versions of all installed packages
    <ul>
      <li>Save this when producing reports (<a href="#s:publish">Chapter 15</a>)</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for installing packages</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: create exercises for installing packages</p>

<h2 id="s:packages-package">How Can I Create an Installable Python Package?</h2>

<ul>
  <li>Next step: put the two functions in their own files underneath a <code class="highlighter-rouge">zipf</code> package
    <ul>
      <li>Would probably keep them in the same file in a real project, because they’re small and closely related</li>
      <li>But this will illustrate the key ideas</li>
    </ul>
  </li>
  <li>A <a href="#g:package">package</a> is a directory that contains a file called <code class="highlighter-rouge">__init__.py</code>, and may contain other files or sub-directories containing files
    <ul>
      <li><code class="highlighter-rouge">__init__.py</code> can contain useful code</li>
      <li>Or it can be empty, but it has to be there to tell Python that this directory is a package</li>
    </ul>
  </li>
  <li>Files and directories are:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>+- use.py
+- zipf
    +- __init__.py
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">zipf/__init__.py</code> contains the functions and <code class="highlighter-rouge">RELATIVE_ERROR</code></li>
  <li>Import and use as before
    <ul>
      <li>The <code class="highlighter-rouge">__pycache__</code> directory is created inside <code class="highlighter-rouge">zipf</code></li>
    </ul>
  </li>
  <li>Now split code between two files to show how that works
    <ul>
      <li>Put the generator in <code class="highlighter-rouge">zipf/generate.py</code></li>
      <li><code class="highlighter-rouge">__init__.py</code> must now import that</li>
      <li>But can do so using <code class="highlighter-rouge">from . import ...</code> (where “.” means the same thing it does in the Unix shell)</li>
      <li>Client code now uses <code class="highlighter-rouge">zipf.generate.make_zipf</code></li>
    </ul>
  </li>
</ul>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">generate</span>

<span class="n">RELATIVE_ERROR</span> <span class="o">=</span> <span class="mf">0.05</span>


<span class="k">def</span> <span class="nf">is_zipf</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">RELATIVE_ERROR</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Cannot test Zipfiness without data'</span>
    <span class="n">scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">/</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">]</span>
    <span class="n">perfect</span> <span class="o">=</span> <span class="n">generate</span><span class="o">.</span><span class="n">make_zipf</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">scaled</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">perfect</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">rel</span><span class="p">)</span>
<span class="sb">``</span>
<span class="sb">``</span><span class="n">py</span>
<span class="kn">import</span> <span class="nn">zipf</span>

<span class="n">generated</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">generate</span><span class="o">.</span><span class="n">make_zipf</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'generated distribution: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">generated</span><span class="p">))</span>
<span class="n">generated</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="k">print</span><span class="p">(</span><span class="s">'passes test with default tolerance: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">is_zipf</span><span class="p">(</span><span class="n">generated</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'passes test with tolerance of 1.0: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">is_zipf</span><span class="p">(</span><span class="n">generated</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)))</span>
</code></pre>
</div>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for creating packages</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: create exercises for creating packages</p>

<h2 id="s:packages-distribute">How Can I Distribute Software Packages That I Have Created?</h2>

<ul>
  <li>Yes, people can clone your repository and copy files from that</li>
  <li>But it’s much friendlier to create something they can install</li>
  <li>Unfortunately, Python has several ways to do this</li>
  <li>We will show <a href="https://setuptools.readthedocs.io/">setuptools</a>, which is the tried-and-true approach
    <ul>
      <li><code class="highlighter-rouge">conda</code> is the modern does-everything solution, but has larger startup overhead</li>
    </ul>
  </li>
  <li>Create a file in the directory <em>above</em> the root directory of the package called <code class="highlighter-rouge">setup.py</code>
    <ul>
      <li>Must be called exactly that</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>+- setup.py
+- use.py
+- zipf
    +- __init__.py
    +- generate.py
</code></pre>
</div>

<ul>
  <li>Add exactly and only these lines</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>from setuptools import setup, find_packages

setup(
    name='zipf',
    version='0.1',
    author='Greg Wilson',
    packages=find_packages()
)
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">find_packages</code> returns a list of things worth packaging</li>
  <li>Run <code class="highlighter-rouge">python setup.py sdist</code> to create a source distribution</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ python setup.py sdist
running sdist
running egg_info
creating zipf.egg-info
writing zipf.egg-info/PKG-INFO
writing dependency_links to zipf.egg-info/dependency_links.txt
writing top-level names to zipf.egg-info/top_level.txt
writing manifest file 'zipf.egg-info/SOURCES.txt'
reading manifest file 'zipf.egg-info/SOURCES.txt'
writing manifest file 'zipf.egg-info/SOURCES.txt'
warning: sdist: standard file not found: should have one of README, README.rst, README.txt, README.md

running check
warning: check: missing required meta-data: url

warning: check: missing meta-data: if 'author' supplied, 'author_email' must be supplied too

creating zipf-0.1
creating zipf-0.1/zipf
creating zipf-0.1/zipf.egg-info
copying files to zipf-0.1...
copying setup.py -&gt; zipf-0.1
copying zipf/__init__.py -&gt; zipf-0.1/zipf
copying zipf/generate.py -&gt; zipf-0.1/zipf
copying zipf.egg-info/PKG-INFO -&gt; zipf-0.1/zipf.egg-info
copying zipf.egg-info/SOURCES.txt -&gt; zipf-0.1/zipf.egg-info
copying zipf.egg-info/dependency_links.txt -&gt; zipf-0.1/zipf.egg-info
copying zipf.egg-info/top_level.txt -&gt; zipf-0.1/zipf.egg-info
Writing zipf-0.1/setup.cfg
creating dist
Creating tar archive
removing 'zipf-0.1' (and everything under it)
</code></pre>
</div>

<ul>
  <li>Creates <code class="highlighter-rouge">dist/zipf-0.1.tar.gz</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tar ztvf dist/zipf-0.1.tar.gz 
drwxr-xr-x  0 standage staff       0 20 Aug 15:36 zipf-0.1/
-rw-r--r--  0 standage staff     180 20 Aug 15:36 zipf-0.1/PKG-INFO
-rw-r--r--  0 standage staff      38 20 Aug 15:36 zipf-0.1/setup.cfg
-rw-r--r--  0 standage staff     145 20 Aug 13:40 zipf-0.1/setup.py
drwxr-xr-x  0 standage staff       0 20 Aug 15:36 zipf-0.1/zipf/
-rw-r--r--  0 standage staff     317 20 Aug 13:34 zipf-0.1/zipf/__init__.py
-rw-r--r--  0 standage staff     163 20 Aug 13:34 zipf-0.1/zipf/generate.py
drwxr-xr-x  0 standage staff       0 20 Aug 15:36 zipf-0.1/zipf.egg-info/
-rw-r--r--  0 standage staff       1 20 Aug 15:36 zipf-0.1/zipf.egg-info/dependency_links.txt
-rw-r--r--  0 standage staff     180 20 Aug 15:36 zipf-0.1/zipf.egg-info/PKG-INFO
-rw-r--r--  0 standage staff     154 20 Aug 15:36 zipf-0.1/zipf.egg-info/SOURCES.txt
-rw-r--r--  0 standage staff       5 20 Aug 15:36 zipf-0.1/zipf.egg-info/top_level.txt
</code></pre>
</div>

<ul>
  <li>Next step is to test installation…</li>
  <li>…but first we should clean up the warnings about <code class="highlighter-rouge">README.md</code>, <code class="highlighter-rouge">url</code>, and <code class="highlighter-rouge">author_email</code></li>
</ul>

<h3 id="common-problems-3">Common Problems</h3>

<p>FIXME: common problems for distributing software</p>

<h3 id="exercises-3">Exercises</h3>

<p>FIXME: create exercises for distributing software</p>

<h2 id="s:packages-virtualenv">How Can I Manage the Packages My Projects Need?</h2>

<ul>
  <li>Want to test the package we just created</li>
  <li>But <em>don’t</em> want to damage the packages we already have installed</li>
  <li>And may not have permission to write into the directory that contains system-wide packages
    <ul>
      <li>E.g., on a cluster</li>
    </ul>
  </li>
  <li>Solution: use a <a href="#g:virtual-environment">virtual environment</a></li>
  <li><code class="highlighter-rouge">pip install virtualenv</code></li>
  <li><code class="highlighter-rouge">virtualenv test</code>
    <ul>
      <li>Creates a new directory called <code class="highlighter-rouge">test</code></li>
      <li>That directory contains <code class="highlighter-rouge">bin</code>, <code class="highlighter-rouge">lib</code>, and so on</li>
      <li><code class="highlighter-rouge">test/bin/python</code> checks for packages in <code class="highlighter-rouge">test/lib</code> <em>before</em> checking the system-wide install</li>
    </ul>
  </li>
  <li>Switch to the envrionment with <code class="highlighter-rouge">source test/bin/activate</code>
    <ul>
      <li><code class="highlighter-rouge">source</code> is a Unix shell command meaning “run all the commands from a file in this currently-active shell”</li>
      <li>Just typing <code class="highlighter-rouge">test/bin/activate</code> on its own would run those commans in a sub-shell</li>
    </ul>
  </li>
  <li>Can switch back to default with <code class="highlighter-rouge">deactivate</code></li>
  <li>Common to create <code class="highlighter-rouge">$HOME/envs</code> to store all environments</li>
  <li>Note how every command now displays <code class="highlighter-rouge">(test)</code> when that virtual environment is active</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd ~
$ mkdir envs

$ which python
/Users/standage/anaconda3/bin/python

$ virtualenv envs/test
Using base prefix '/Users/standage/anaconda3'
New python executable in /Users/standage/envs/test/bin/python
Installing setuptools, pip, wheel...done.

$ which python
/Users/standage/anaconda3/bin/python

$ source envs/test/bin/activate
(test) 

$ which python
/Users/standage/envs/test/bin/python
(test)

$ deactivate

$ which python
/Users/standage/anaconda3/bin/python
</code></pre>
</div>

<ul>
  <li>Now test installation</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pip install ./src/package/05/dist/zipf-0.1.tar.gz 
Processing ./src/package/05/dist/zipf-0.1.tar.gz
Building wheels for collected packages: zipf
  Running setup.py bdist_wheel for zipf ... done
  Stored in directory: /Users/stanage/Library/Caches/pip/wheels/6b/de/80/d72bb0d6e7c65b6e413f0cf10f04b4bbccb329767853fe1644
Successfully built zipf
Installing collected packages: zipf
Successfully installed zipf-0.1
(test)

$ python
&gt;&gt;&gt; import zipf
&gt;&gt;&gt; zipf.RELATIVE_ERROR
0.05

$ pip uninstall zipf
Uninstalling zipf-0.1:
  Would remove:
    /Users/standage/envs/test/lib/python3.6/site-packages/zipf-0.1.dist-info/*
    /Users/standage/envs/test/lib/python3.6/site-packages/zipf/*
Proceed (y/n)? y
  Successfully uninstalled zipf-0.1
(test)
</code></pre>
</div>

<ul>
  <li>One environment per project, one project per environment</li>
  <li>Uses more disk space than absolutely necessary…</li>
  <li>…but less than most of your data sets…</li>
  <li>…and saves a <em>lot</em> of pain</li>
</ul>

<h3 id="common-problems-4">Common Problems</h3>

<p>FIXME: common problems for virtual environments</p>

<h3 id="exercises-4">Exercises</h3>

<p>FIXME: create exercises for virtual environments</p>

<h2 id="s:packages-summary">Summary</h2>

<p>FIXME: create concept map for packages</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Use <code class="highlighter-rouge">virtualenv</code> to create a separate virtual environment for each project.
</li><li>Use <code class="highlighter-rouge">pip</code> to create a distributable package containing your project’s software, documentation, and data.
</li>
  </ul>
</div>


          

          <h1 id="s:publish">Publishing</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>How and where should I publish my reports?
</li><li>What should I include in my publications?
</li>
  </ul>
</div>


          <ul>
  <li>Now that we know <em>how</em> to publish (<a href="#s:ghp">Chapter 7</a>), the next questions are <em>what</em> and <em>where</em></li>
  <li>Use the generic term “report” to include research papers, summaries for clients,
and everything else that is shorter than a book and is going to be read by someone else
    <ul>
      <li>“A report is a PDF you would print on your own printer.”</li>
    </ul>
  </li>
</ul>

<h2 id="s:publish-what-where">What Should I Publish and Where?</h2>

<ul>
  <li>Small raw data (under 500 MB): store in GitHub</li>
  <li>Medium-size raw data (between 500 MB and 5 GB)
    <ul>
      <li>Use platforms like the <a href="https://osf.io/">Open Science Framework</a>, <a href="https://datadryad.org/">Dryad</a>, and <a href="https://figshare.com/">Figshare</a></li>
      <li>Include dataset identifiers and/or download scripts with the report</li>
    </ul>
  </li>
  <li>Big raw data (more than 5 GB)
    <ul>
      <li>May not be yours in the first place, and needs professional archiving</li>
      <li>Again, include identifiers or download scripts</li>
    </ul>
  </li>
  <li>Whichever you use, get or create a <a href="#g:doi">DOI</a> for each version of each dataset (<a href="#s:publish-identifiers">Section 15.2</a>)</li>
  <li>Also publish intermediate files that take a long time to generate
    <ul>
      <li>Same sizing rules as above</li>
      <li>If they’re likely to be used by other people or in other reports, get a DOI</li>
    </ul>
  </li>
  <li>Publish the version IDs of the standard software used in the analysis
    <ul>
      <li><code class="highlighter-rouge">pip freeze &gt; requirements.txt</code> for Python packages (<a href="#s:packages-install">Section 14.2</a>)</li>
      <li>Helps to write a script to get versions for everything else</li>
      <li>Or put commands in a Makefile</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>## versions : dump versions of everything used in this run
versions :
        @echo '# Python packages'
        @pip freeze
        @echo '# dezply'
        @dezply --version
        @echo '# parajune'
        @parajune --status | head 1
</code></pre>
</div>

<ul>
  <li>The scripts, notebooks, and/or Makefiles used to produce results
    <ul>
      <li>These tend to evolve at a different rate than data, so get separate DOIs</li>
      <li>May publish script by script, or create a Zipfile or tar file that includes everything</li>
      <li>The Makefile fragment below creates <code class="highlighter-rouge">~/archive/meow-2018-08-21.tgz</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>ARCHIVE=${HOME}/archive
PROJECT=meow
TODAY=$(shell date "+%Y-%m-%d")
SCRIPTS=./Makefile ./bin/*.py ./bin/*.sh

## archive : create an archive of all the scripts used in this run
archive :
        @mkdir -p ${ARCHIVE}
        @tar zcf ${ARCHIVE}/${PROJECT}-${TODAY}.tgz
</code></pre>
</div>

<ul>
  <li>The configurations and parameters used for that software
    <ul>
      <li>If all parameters are in a configuration file, use that (<a href="#s:configuration">Chapter 6</a>)</li>
      <li>Or log all configuration parameters and use <code class="highlighter-rouge">grep</code> or a script to extract from the logfile (<a href="#s:logging">Chapter 5</a>)</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems">Common Problems</h3>

<p>FIXME: common problems for what to publish and where</p>

<h3 id="exercises">Exercises</h3>

<p>FIXME: create exercises for what to publish and where</p>

<h2 id="s:publish-identifiers">How Can I Identify Myself and My Work in Bibliographies?</h2>

<ul>
  <li>An <a href="#g:orcid">ORCID</a> is an Open Researcher and Contributor ID
    <ul>
      <li>Because names and affiliations change</li>
    </ul>
  </li>
  <li>Can <a href="https://orcid.org/">get an ORCID</a> for free and include in publications
    <ul>
      <li>Greg Wilson’s is 0000-0001-8659-8979</li>
    </ul>
  </li>
  <li>A <a href="#g:doi">DOI</a> is a Digital Object Identifier
    <ul>
      <li>Uniquely identifies a particular version of a particular digital artefact</li>
      <li>Can be a report, a dataset, or a version of software</li>
      <li>Format is <code class="highlighter-rouge">doi:prefix/suffix</code>, but will often see URLs like <code class="highlighter-rouge">http://dx.doi.org/prefix/suffix</code></li>
    </ul>
  </li>
  <li>Use <a href="https://zenodo.org/">Zenodo</a> to <a href="https://guides.github.com/activities/citable-code/">get DOIs for free</a></li>
  <li>Log in to <a href="https://zenodo.org/">Zenodo</a> using GitHub ID
    <ul>
      <li>Authorize application (so Zenodo can read data from your GitHub repositories)</li>
      <li>Pick a repository and click the “On” button</li>
    </ul>
  </li>
  <li>Go back to GitHub repository
    <ul>
      <li>Go to the “Releases” tab</li>
      <li>Create a new release and give it a version number (<a href="#s:workflow-tag">Section 8.3</a>)</li>
      <li>Click “Publish release”</li>
    </ul>
  </li>
  <li>Go back to Zenodo
    <ul>
      <li>Look under the “Upload” tab for a new upload corresponding to this release</li>
      <li>Fill in information and publish</li>
      <li>Zenodo DOI badge will automatically appear on the GitHub project’s site</li>
    </ul>
  </li>
  <li>Cite datasets and software versions in reports
    <ul>
      <li>Include DOIs in bibliography entries</li>
    </ul>
  </li>
  <li>Publish software in <a href="https://joss.theoj.org/">JOSS</a> or <a href="https://f1000research.com/">F1000 Research</a></li>
  <li>Publish <em>everything</em> in open access venues (<a href="#s:inclusive-license">Section 13.1</a>)
    <ul>
      <li>Use <a href="http://unpaywall.org/">Unpaywall</a> browser extension to check and find things</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-1">Common Problems</h3>

<p>FIXME: common problems for ORCIDs and DOIs</p>

<h3 id="exercises-1">Exercises</h3>

<p>FIXME: create exercises for ORCIDs and DOIs</p>

<h2 id="s:publish-fair">What Is the Most Useful Way to Share My Data?</h2>

<ul>
  <li>The <a href="https://www.go-fair.org/fair-principles/">FAIR Principles</a> describe what research data should look like
    <ul>
      <li>Still mostly aspirational for most researchers</li>
      <li>But it tells us what we need to work on</li>
      <li>And yes, the acronym probably came first…</li>
    </ul>
  </li>
  <li>Findable: because the first step in using or re-using data is to find it
    <ol>
      <li>(Meta)data is assigned a globally unique and persistent identifier</li>
      <li>Data is described with rich metadata</li>
      <li>Metadata clearly and explicitly includes the identifier of the data it describes</li>
      <li>(Meta)data is registered or indexed in a searchable resource (FIXME: such as?)</li>
    </ol>
  </li>
  <li>Accessible: you can’t use data if you don’t have access to it (which means a way to authenticate, and having permission)
    <ol>
      <li>(Meta)data is retrievable by its identifier using a standardised communications protocol
        <ul>
          <li>The protocol is open, free, and universally implementable</li>
          <li>The protocol allows for an authentication and authorisation procedure if necessary</li>
        </ul>
      </li>
      <li>Metadata is accessible even when the data is no longer available</li>
    </ol>
  </li>
  <li>Interoperable: data usually needs to be integrated with other data, which means that tools need to be able to process it
    <ol>
      <li>(Meta)data uses a formal, accessible, shared, and broadly applicable language for knowledge representation</li>
      <li>(Meta)data uses vocabularies that follow FAIR principles</li>
      <li>(Meta)data includes qualified references to other (meta)data</li>
    </ol>
  </li>
  <li>Reusable: because this is the ultimate purpose of all of this
    <ol>
      <li>Meta(data) is described with accurate and relevant attributes</li>
      <li>(Meta)data is released with a clear and accessible data usage license</li>
      <li>(Meta)data has detailed provenance</li>
      <li>(Meta)data meets domain-relevant community standards</li>
    </ol>
  </li>
  <li>In practice:
    <ul>
      <li>Always use <a href="#g:tidy-data">tidy data</a></li>
      <li>Include keywords in the project’s <code class="highlighter-rouge">README.md</code> so that they appear on its home page</li>
      <li>Give everything DOIs</li>
      <li>Put data in open repositories</li>
      <li>Use well-known formats like CSV and HDF5</li>
      <li>Include an explicit license in every project and every dataset</li>
      <li>Include scripts or documentation on how to get or regenerate data</li>
      <li>Include units (please)</li>
    </ul>
  </li>
</ul>

<h3 id="common-problems-2">Common Problems</h3>

<p>FIXME: common problems for FAIR Principles</p>

<h3 id="exercises-2">Exercises</h3>

<p>FIXME: create exercises for FAIR Principles</p>

<h2 id="s:publish-summary">Summary</h2>

<p>FIXME: create concept map for publishing</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Include small datasets in repositories; store large ones on data sharing sites, and include metadata in the repository to locate them.
</li><li>An ORCID is a unique personal identifier that you can use to identify your work.
</li><li>A DOI is a unique identifier for a particular dataset, report, or software release.
</li><li>Data should be findable, accessible, interoperable, and reusable (FAIR).
</li><li>Use Zenodo to obtain DOIs.
</li><li>Publish your software as you would a paper.
</li>
  </ul>
</div>


          

          <h1 id="s:docs">Documenting Code</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>What kind of documentation should I write and where should I put it?
</li>
  </ul>
</div>


          <ul>
  <li>Design code to be comprehensible, but document</li>
  <li>Some people argue that if you need to add comments to your software, you should have written clearer software</li>
  <li>But software is only “self-explanatory” if you understand intention and design constraints,
neither of which usually show up in the software itself
    <ul>
      <li>“Why does the software do this?”</li>
      <li>“Why doesn’t it do this in a simpler way?”</li>
    </ul>
  </li>
  <li>A more reasonable guideline is therefore “if you need to document something in the middle of a function, put it in a separate function”</li>
  <li>And then document:
    <ul>
      <li>The overall purpose of the code in that file</li>
      <li>The purpose of each function in the file</li>
    </ul>
  </li>
</ul>

<h2 id="s:docs-docstrings">How Can I Embed Documentation for My Code in the Code Itself?</h2>

<ul>
  <li>Instead of using comments for this, use <a href="#g:docstring">docstrings</a> (short for “documentation string”)
    <ul>
      <li>A string that is created at the start of a file or function, but not assigned to a variable</li>
      <li>Python automatically attaches this to the file (when it is loaded as a library) or to the function</li>
      <li>Available as <code class="highlighter-rouge">module.__doc__</code> or <code class="highlighter-rouge">function.__doc__</code></li>
    </ul>
  </li>
  <li>The <code class="highlighter-rouge">help</code> function takes this string, formats it nicely using [Markdown][markdown] rules, and displays it</li>
  <li>Typically format docstrings using triple quotes (so that they can span multiple lines)</li>
  <li>Example: <code class="highlighter-rouge">trim.py</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>'''
Tools for trimming values to lie in a specified range.
'''

def trim(values, low, high, in_place=False):
    '''
    Ensure that all values in the result list lie in low...high (inclusive).
    If 'in_place' is 'True', modifies the input instead of creating a new list.

    Args:
        values: List of values to be trimmed.
        low: Lower bound on values (inclusive).
        high: Upper bound on values (inclusive).
        in_place: If true, modify input list (default False).

    Returns:
        List of trimmed values (which may be the input list).

    Raises:
        AssertionError: if 'low' is greater than 'high'.
    '''
    assert low &lt;= high, 'Nonsensical trim range {}..{}'.format(low, high)
    result = values if in_place else values[:]
    for (i, x) in enumerate(result):
        result[i] = min(high, max(low, x))
    return result
</code></pre>
</div>

<ul>
  <li>Run <code class="highlighter-rouge">pydoc bin/trim.py</code> on the command line</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>NAME
    trim - Tools for trimming values to lie in a specified range.

FUNCTIONS
    trim(values, low, high, in_place=False)
        Ensure that all values in the result list lie in low...high (inclusive).
        If 'in_place' is 'True', modifies the input instead of creating a new list.
        
        Args:
            values: List of values to be trimmed.
            low: Lower bound on values (inclusive).
            high: Upper bound on values (inclusive).
            in_place: If true, modify input list (default False).
        
        Returns:
            List of trimmed values (which may be the input list).
        
        Raises:
            AssertionError: if 'low' is greater than 'high'.

FILE
    /Users/standage/magic/bin/trim.py
</code></pre>
</div>

<ul>
  <li>Get the same output from within the Python interpreter:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>import trim
help(trim)
</code></pre>
</div>

<ul>
  <li>Or run <code class="highlighter-rouge">pydoc -w bin/trim.py</code> to generate an HTML page <code class="highlighter-rouge">trim.html</code>
    <ul>
      <li>Formatting is a bit garish</li>
    </ul>
  </li>
</ul>

<div>
<table width="100%" cellspacing="0" cellpadding="2" border="0" summary="heading">
<tr>
<td bgcolor="#7799ee" valign="bottom">
<font face="helvetica, arial">&nbsp;<br /><big><big><strong>trim</strong></big></big></font></td>
<td bgcolor="#7799ee" align="right" valign="bottom">
<font face="helvetica, arial">/Users/standage/magic/bin/trim.py</font></td></tr></table>
    <p><tt>Tools&nbsp;for&nbsp;trimming&nbsp;values&nbsp;to&nbsp;lie&nbsp;in&nbsp;a&nbsp;specified&nbsp;range.</tt></p>
<p>
<table width="100%" cellspacing="0" cellpadding="2" border="0" summary="section">
<tr>
<td bgcolor="#eeaa77" colspan="3" valign="bottom">
<font face="helvetica, arial"><big><strong>Functions</strong></big></font></td></tr>
    
<tr><td bgcolor="#eeaa77"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><dl><dt><a name="-trim"><strong>trim</strong></a>(values, low, high, in_place=False)</dt><dd><tt>Ensure&nbsp;that&nbsp;all&nbsp;values&nbsp;in&nbsp;the&nbsp;result&nbsp;list&nbsp;lie&nbsp;in&nbsp;low...high&nbsp;(inclusive).<br />
If&nbsp;'in_place'&nbsp;is&nbsp;'True',&nbsp;modifies&nbsp;the&nbsp;input&nbsp;instead&nbsp;of&nbsp;creating&nbsp;a&nbsp;new&nbsp;list.<br />
&nbsp;<br />
Args:<br />
&nbsp;&nbsp;&nbsp;&nbsp;values:&nbsp;List&nbsp;of&nbsp;values&nbsp;to&nbsp;be&nbsp;trimmed.<br />
&nbsp;&nbsp;&nbsp;&nbsp;low:&nbsp;Lower&nbsp;bound&nbsp;on&nbsp;values&nbsp;(inclusive).<br />
&nbsp;&nbsp;&nbsp;&nbsp;high:&nbsp;Upper&nbsp;bound&nbsp;on&nbsp;values&nbsp;(inclusive).<br />
&nbsp;&nbsp;&nbsp;&nbsp;in_place:&nbsp;If&nbsp;true,&nbsp;modify&nbsp;input&nbsp;list&nbsp;(default&nbsp;False).<br />
&nbsp;<br />
Returns:<br />
&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;of&nbsp;trimmed&nbsp;values&nbsp;(which&nbsp;may&nbsp;be&nbsp;the&nbsp;input&nbsp;list).<br />
&nbsp;<br />
Raises:<br />
&nbsp;&nbsp;&nbsp;&nbsp;AssertionError:&nbsp;if&nbsp;'low'&nbsp;is&nbsp;greater&nbsp;than&nbsp;'high'.</tt></dd></dl>
</td></tr></table>
&lt;/div&gt;


-   Can use a more sophisticated tool (i.e., more powerful but also more complicated) called [Sphinx][sphinx]
    -   Reads a superset of Markdown called [reStructredText](#g:restructured-text)
    -   Generates cross-indexed documentation that is more nicely formatted
-   Used by [ReadTheDocs][readthedocs]
    -   Extracts and formats documentation from GitHub repositories (and other places)
    -   Automatically regenerates documentation every time there's a change
    -   An example of [continuous integration](#g:continuous-integration)
    -   And it's free
    -   But out of the scope of this lesson

### Common Problems

FIXME: common problems for using docstrings

### Exercises

FIXME: exercises for using docstrings

## Summary {#s:docs-summary}

FIXME: create concept maps for documentation



[ally-skills]: https://frameshiftconsulting.com/ally-skills-workshop/
[authorea]: https://www.authorea.com/

[branch-per-feature]: https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow
[bryan-jenny]: https://jennybryan.org/
[build-tools]: https://en.wikipedia.org/wiki/List_of_build_automation_software

[capes-gerard]: https://github.com/gcapes
[captain-awkward]: https://captainawkward.com/
[charles-rules]: http://geekfeminism.wikia.com/wiki/Charles%27_Rules_of_Argument
[choose-license]: http://choosealicense.com/
[code-smells-and-feels]: https://github.com/jennybc/code-smells-and-feels
[covenant]: https://www.contributor-covenant.org
[creative-commons]: https://creativecommons.org/

[dc]: https://datacarpentry.org/
[docker]: https://en.wikipedia.org/wiki/Docker_(software)
[dryad]: https://datadryad.org/
[dursi-jonathan]: https://www.dursi.ca/
[dursi-pattern-rules]: https://github.com/ljdursi/make_pattern_rules

[f1000-research]: https://f1000research.com/
[figshare]: https://figshare.com/
[format-r]: https://yihui.name/formatr/

[geek-feminism]: http://geekfeminism.wikia.com/
[gfm]: https://help.github.com/articles/github-flavored-markdown/
[github]: http://github.com
[github-pages]: https://pages.github.com/
[github-zenodo-tutorial]: https://guides.github.com/activities/citable-code/
[gnu-make]: http://www.gnu.org/software/make/
[go-fair]: https://www.go-fair.org/fair-principles/
[google-docs]: https://en.wikipedia.org/wiki/Google_Docs,_Sheets,_and_Slides

[huff-katy]: http://katyhuff.github.io/
[huff-testing]: https://github.com/katyhuff/python-testing

[insight]: https://www.insightdatascience.com/

[jekyll]: https://jekyllrb.com/
[joss]: https://joss.theoj.org/
[jupyter]: http://jupyter.org/

[kirk-matthew]: https://www.matthewkirk.com/

[latex]: http://www.latex-project.org/
[libreoffice]: https://www.libreoffice.org/
[lint]: https://en.wikipedia.org/wiki/Lint_(software)

[make]: https://www.gnu.org/software/make/
[markdown]: https://en.wikipedia.org/wiki/Markdown
[mathjax]: https://www.mathjax.org/
[model-coc]: http://geekfeminism.wikia.com/wiki/Conference_anti-harassment/Policy
[ms-word]: https://en.wikipedia.org/wiki/Microsoft_Word

[one-extra-thing]: https://merely-useful.github.io/one-extra-thing/
[orcid]: https://orcid.org/
[orwells-rules]: https://en.wikipedia.org/wiki/Politics_and_the_English_Language#Remedy_of_Six_Rules
[osi-license-list]: http://opensource.org/licenses
[osf]: https://osf.io/
[overleaf]: https://www.overleaf.com/

[pandoc]: https://pandoc.org/
[pep-8]: https://www.python.org/dev/peps/pep-0008/
[poisot-timothee]: http://poisotlab.io/
[producing-oss]: https://producingoss.com/
[pypi]: https://pypi.org/
[python-102]: https://python-102.readthedocs.io/
[pytest-mpl]: https://github.com/matplotlib/pytest-mpl

[r-markdown]: https://rmarkdown.rstudio.com/
[readthedocs]: https://docs.readthedocs.io/en/latest/

[setuptools]: https://setuptools.readthedocs.io/
[seven-ways]: http://blog.jonudell.net/2011/01/24/seven-ways-to-think-like-the-web/
[shapiro-wilk]: https://en.wikipedia.org/wiki/Shapiro%E2%80%93Wilk_test
[snakemake]: https://snakemake.readthedocs.io/
[sphinx]: http://www.sphinx-doc.org/en/master/
[srinath-ashwin]: https://ccit.clemson.edu/research/researcher-profiles/ashwin-srinath/
[standage-daniel]: https://standage.github.io/
[swc]: http://software-carpentry.org
[swc-make]: https://github.com/swcarpentry/make-novice

[tables-generator]: https://www.tablesgenerator.com/
[tdda-site]: http://www.tdda.info/
[tf-idf]: https://en.wikipedia.org/wiki/Tf%E2%80%93idf
[tldr-gpl]: https://tldrlegal.com/license/gnu-general-public-license-v3-(gpl-3)
[travis-ci]: https://travis-ci.org/
[tyranny-structurelessness]: http://www.jofreeman.com/joreen/tyranny.htm

[unpaywall]: http://unpaywall.org/

[vanderplas-licensing]: http://www.astrobetter.com/blog/2014/03/10/the-whys-and-hows-of-licensing-scientific-code/

[wilson-greg]: http://third-bit.com

[yaml]: https://en.wikipedia.org/wiki/YAML

[zenodo]: https://zenodo.org/
[zipfs-law]: http://en.wikipedia.org/wiki/Zipf%27s_law

</p></div>

          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>Documentation strings (docstrings) can be placed at the start of a file or at the start of a function.
</li><li>Docstrings can be formatted using a superset of Markdown.
</li><li>Tools like <code class="highlighter-rouge">pydoc</code> and Sphinx can extract and format docstrings to create documentation for software.
</li>
  </ul>
</div>


          

          <h1 id="s:finale">Finale</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          
<div class="listblock">
  <p><strong>Questions this lesson answers</strong></p>
  <ul>
    <li>What does it all mean?
</li><li>Where do we go next?
</li>
  </ul>
</div>


          <p>Jon Udell’s essay “<a href="http://blog.jonudell.net/2011/01/24/seven-ways-to-think-like-the-web/">Seven Ways to Think Like the Web</a>” completely
changed the way I think about what the Internet is for and how we ought to use
it.  I tried to sum up the big ideas of an earlier incarnation of <a href="http://software-carpentry.org">Software
Carpentry</a> in response; after some updates, the list is:</p>

<ol>
  <li>It’s all just data.</li>
  <li>Data doesn’t mean anything on its own: it has to be interpreted.</li>
  <li>Programming is about creating and composing abstractions.</li>
  <li>Models are for computers, and views are for people.</li>
  <li>Slowing down makes us go faster.</li>
  <li>Better algorithms are better than better hardware.</li>
  <li>The tool shapes the hand.</li>
  <li>No human interpretation of data is neutral.</li>
</ol>

<p>First, and most importantly, <strong>it’s all just data</strong>.  Shopping lists, email,
pictures of far-off galaxies: inside the computer, they’re all just ones and
zeroes.  Even programs are just data: in fact, this is the key insight that all
of modern computing is built on.  The source code for a program is just a bunch
of text files, no different from a thesis.  Once that text is compiled or loaded
into memory, it’s just bytes too, and pushing those bytes around is no different
from correcting a typo in an address list or changing the color of a pixel in an
image file.  If you understand this—if you understand that programs are just
another kind of data—then every bit of programming you do will be easier.</p>

<p>The second idea is a complement to the first.  <strong>Data doesn’t mean anything on
its own—it has to be interpreted</strong>.  01100100011000010111100001100001
simultaneously represents the word “data”, the integer 1,684,108,385, the
floating-point number 1.6635613602263159e+22, a bluish-gray pixel that’s
slightly transparent, a medium-loud sound sample with slightly higher volume in
the left channel, or an instruction to add the value of register 100 to a
location in memory that is 97 bytes past the address currently stored in
register 116.</p>

<p>The reason for this is that machines don’t understand; they obey.  If
you look at this image, you can’t help but see the word “data”:</p>

<figure>
  <figcaption>The Word "Data"</figcaption>
  <img id="f:finale-data" src="../../files/finale-data.png" alt="The Word 'Data'" />
</figure>

<p>A machine doesn’t; it doesn’t even see four blobs of blue pixels on a gray
background, because it doesn’t “see” anything.  The computer stores this image,
and a program, as bits in memory.  If those bits happen to correspond to
instructions for the computer’s CPU, and if those instructions happen to make up
a program for detecting shapes in images and matching those shapes with letters
in the alphabet, then the computer may very well output “data”, but <em>it doesn’t
understand</em>.  Calling a variable “temperature” doesn’t mean the computer will
store a temperature in it—it would do exactly the same thing if the variable was
called “pressure” or “frankenstein” or “a7”.</p>

<p>This brings us to the third idea: <strong>programming is about creating and composing
abstractions</strong>.  Our brains can only keep track of a few things at once, so if
we want to understand something, we have to stuff the details into boxes and put
labels on them like “find the maximum” or “patient record”.</p>

<p>One key to making abstraction work is to separate <em>interface</em> from
<em>implementation</em>.  An interface is what something knows how to do: the questions
it can answer, or the operations it can carry out. Its implementation is how it
does those things: what data it stores, what algorithms it uses, and so on.
There can be dozens of ways to implement a particular interface; if we do our
work well, we shouldn’t have to care about the implementation until something
goes wrong or we need to improve its performance.  “Spare me the details” may be
rude in real life, but it’s essential in programming.</p>

<p>Another key to making abstraction work is to always choose clarity over
cleverness.  As Brian Kernighan once said, “…debugging is twice as hard as
writing a program in the first place.  So if you are as clever as you can be
when you write it, how will you ever debug it?”  Programs are among the most
complex things human beings have ever created; it may be tempting to use little
tricks here and there to make them smaller or faster, but somebody (maybe you)
is going to have to figure it out again later, and really, nobody likes being
tricked.</p>

<p>One implication of the abstraction principle is important enough to be our
fourth principle in its own right: <strong>models are for computers, and views are for
people</strong>.  A model is a representation of something that is easy for a computer
to operate on; a view is a way of displaying part or all of that model that
human beings can understand.  For example, an HTML document consists of elements
with attributes that contain other elements or blocks of raw text:</p>

<figure>
  <figcaption>Model-View Separation</figcaption>
  <img id="f:finale-modelview" src="../../files/finale-modelview.png" alt="Model-View Separation" />
</figure>

<p>That model can be rendered in a browser, turned into speech for someone who is
visually impaired, or displayed as text using angle brackets, quotes, and some
indentation.  None of these <em>is</em> the model: they’re all views that make the
model’s content accessible to human beings in different contexts.  The model
itself isn’t just easier for the computer to work with: it’s essential, since as
we said before, the computer can’t “see” the views that we create for human
beings.</p>

<p>Turning one of those views back into a model is hard: parsing the textual
representation of HTML takes thousands of lines of code, and doing OCR or speech
recognition to translate the rendered page or its spoken equivalent can take
millions.  What big idea number four implies, therefore, is that <em>structured
data is better than unstructured data</em>.  The tags and attributes in the textual
representation of an HTML page are there because without it, the computer can’t
tell whether something is in italics because it’s being emphasized or because
it’s the title of a book.  To borrow an example from Jon Udell, a PDF with a
cartoon whose caption says, “The knitting circle meets on the second Tuesday of
every month” is a lot easier for human beings to understand than a blob of
iCal-formatted text, but the second is much easier for the computer.</p>

<p>We said earlier that we only want to care about how something is implemented
when things go wrong or when we need to improve its performance.  Big idea
number five is about things going wrong, and can be summed up by saying that
<strong>slowing down makes us go faster</strong>.  The best way—in fact, the only way—to
improve productivity is to improve quality, and this starts before we write the
first line of code.  “I want to count all the stars in this photograph” is easy
to say, but what does it actually <em>mean</em>?  What constitutes a star?  When do you
decide that a lumpy blob of pixels is two stars rather than one, or three
instead of two?  Every program embodies decisions about questions like these,
even if you don’t realize that there was a question and that you made a choice.
The sooner we worry about this, the less time we’ll waste building the wrong
thing.</p>

<p>Of course, we don’t stop worrying once we’ve typed our code in.  We check that
data is formatted properly to protect ourselves against “garbage in, garbage
out”.  We put checks in our code to make sure that parameters are sensible, data
structures consistent, files aren’t empty, and so on.  And we write tests, and
use a build system, to catch errors as soon as possible.  This might feel like
it’s slowing us down at first, but study after study has shown that it works.</p>

<p>One of the best ways to apply this principle, by the way, is to automate
everything.  As Alfred North Whitehead said, “Civilization advances by extending
the number of important operations which we can perform without thinking about
them.”  We don’t just write programs because we want to do things quickly: we
write them because we don’t want to do some things ever again.  Version control
systems keep track of our work for us; spreadsheets update graphs and summary
statistics whenever a single value changes, and so on.  Every time we automate a
task, we reduce the chances of getting it wrong the next time, and have more
time to think about things that machines <em>can’t</em> do for us.  And it’s not just a
one-time saving: if we automate things well, that extra time is ours over and
over again.</p>

<p>Big idea number six is that we can think about how fast the algorithms embodied
in programs are, and that <strong>better algorithms are better than better hardware</strong>.
One of the greatest mathematical advances of the Twentieth Century was the idea
of <em>algorithmic complexity</em>, and its practical implications shape everything we
do with computers, whether we realize it or not.  The basic idea is that we can
estimate how many operations an algorithm will do, or how much memory it
requires, as a function of the size of the problem we’re trying to solve.  It
turns out that some algorithms slow down gently as their inputs get larger,
while others slow down so much that even if the whole universe was one large
computer, it couldn’t solve any problem big enough to be interesting.  Faster
chips help—a lot—but the real key to speed is to focus on what we’re doing,
not what we’re doing it with.</p>

<p>But algorithms are nothing without data structures to operate on, just as data
structures are pointless without algorithms to manipulate them.  That’s why the
two topics are usually taught together: arrays with loops, trees with recursion,
and so on.  Knowing the syntax of this language or the API of that library is
useful, but good programmers know their data structures and algorithms the way a
plumber knows pipes or a musician knows scales.</p>

<p>Thinking about pipes and scales bring us to something that artisans have known
for thousands of years: <strong>the tool shapes the hand</strong>.  Building software changes
how you use software; making computers do new things changes your understanding
of what computers can do.  That’s why any course about computational thinking
should ask you to write software: however frustrating it may sometimes be, it’s
the only way to teach you what software can do.</p>

<p>The eighth and final idea is probably the most important.  While computers don’t
have points of view, human beings do, which means that <strong>no human interpretation
of data is neutral</strong>.  If the last few years have taught us anything, it’s that
there’s no such thing as a “purely technical” decision.  Every decision about
what data to collect, who to share it with, how to analyze it, what thresholds
to consider “significant”, and how to use the results of those analyses
necessarily and unavoidably serves someone’s interests.  Many programmers try to
ignore this; many others pretend that there are purely technical solutions to
it, because if the problem is technical, they only have to change their code,
but if the problem is human, they might have to change themselves.</p>

<h2 id="s:finale-next">Where to Go Next</h2>

<p>FIXME: links to other resources</p>


          
<div class="listblock">
  <p><strong>Key points</strong></p>
  <ul>
    <li>It’s all just data.
</li><li>Data doesn’t mean anything on its own: it has to be interpreted.
</li><li>Programming is about creating and composing abstractions.
</li><li>Models are for computers, and views are for people.
</li><li>Slowing down makes us go faster.
</li><li>Better algorithms are better than better hardware.
</li><li>The tool shapes the hand.
</li><li>No human interpretation of data is neutral.
</li>
  </ul>
</div>


          

          <h1 id="s:license">License</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          <p><em>This is a human-readable summary of (and not a substitute for) the license.
Please see <a href="https://creativecommons.org/licenses/by/4.0/legalcode">https://creativecommons.org/licenses/by/4.0/legalcode</a> for the full legal text.</em></p>

<p>This work is licensed under the Creative Commons Attribution 4.0
International license (CC-BY-4.0).</p>

<p><strong>You are free to:</strong></p>

<ul>
  <li>
    <p><strong>Share</strong>—copy and redistribute the material in any medium or
format</p>
  </li>
  <li>
    <p><strong>Remix</strong>—remix, transform, and build upon the material for any
purpose, even commercially.</p>
  </li>
</ul>

<p>The licensor cannot revoke these freedoms as long as you follow the
license terms.</p>

<p><strong>Under the following terms:</strong></p>

<ul>
  <li>
    <p><strong>Attribution</strong>—You must give appropriate credit, provide a link
to the license, and indicate if changes were made. You may do so in
any reasonable manner, but not in any way that suggests the licensor
endorses you or your use.</p>
  </li>
  <li>
    <p><strong>No additional restrictions</strong>—You may not apply legal terms or
technological measures that legally restrict others from doing
anything the license permits.</p>
  </li>
</ul>

<p><strong>Notices:</strong></p>

<p>You do not have to comply with the license for elements of the
material in the public domain or where your use is permitted by an
applicable exception or limitation.</p>

<p>No warranties are given. The license may not give you all of the
permissions necessary for your intended use. For example, other rights
such as publicity, privacy, or moral rights may limit how you use the
material.</p>


          

          

          <h1 id="s:conduct">Code of Conduct</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          <p>In the interest of fostering an open and welcoming environment, we as
contributors and maintainers pledge to making participation in our
project and our community a harassment-free experience for everyone,
regardless of age, body size, disability, ethnicity, gender identity
and expression, level of experience, education, socio-economic status,
nationality, personal appearance, race, religion, or sexual identity
and orientation.</p>

<h2 id="our-standards">Our Standards</h2>

<p>Examples of behavior that contributes to creating a positive
environment include:</p>

<ul>
  <li>using welcoming and inclusive language,</li>
  <li>being respectful of differing viewpoints and experiences,</li>
  <li>gracefully accepting constructive criticism,</li>
  <li>focusing on what is best for the community, and</li>
  <li>showing empathy towards other community members.</li>
</ul>

<p>Examples of unacceptable behavior by participants include:</p>

<ul>
  <li>the use of sexualized language or imagery and unwelcome sexual
attention or advances,</li>
  <li>trolling, insulting/derogatory comments, and personal or political
attacks,</li>
  <li>public or private harassment,</li>
  <li>publishing others’ private information, such as a physical or
electronic address, without explicit permission, and</li>
  <li>other conduct which could reasonably be considered inappropriate in
a professional setting</li>
</ul>

<h2 id="our-responsibilities">Our Responsibilities</h2>

<p>Project maintainers are responsible for clarifying the standards of
acceptable behavior and are expected to take appropriate and fair
corrective action in response to any instances of unacceptable
behavior.</p>

<p>Project maintainers have the right and responsibility to remove, edit,
or reject comments, commits, code, wiki edits, issues, and other
contributions that are not aligned to this Code of Conduct, or to ban
temporarily or permanently any contributor for other behaviors that
they deem inappropriate, threatening, offensive, or harmful.</p>

<h2 id="scope">Scope</h2>

<p>This Code of Conduct applies both within project spaces and in public
spaces when an individual is representing the project or its
community. Examples of representing a project or community include
using an official project e-mail address, posting via an official
social media account, or acting as an appointed representative at an
online or offline event. Representation of a project may be further
defined and clarified by project maintainers.</p>

<h2 id="enforcement">Enforcement</h2>

<p>Instances of abusive, harassing, or otherwise unacceptable behavior
may be reported by <a href="gvwilson@third-bit.com">emailing the project team</a>. All
complaints will be reviewed and investigated and will result in a
response that is deemed necessary and appropriate to the
circumstances. The project team is obligated to maintain
confidentiality with regard to the reporter of an incident.  Further
details of specific enforcement policies may be posted separately.</p>

<p>Project maintainers who do not follow or enforce the Code of Conduct
in good faith may face temporary or permanent repercussions as
determined by other members of the project’s leadership.</p>

<h2 id="attribution">Attribution</h2>

<p>This Code of Conduct is adapted from
the <a href="https://www.contributor-covenant.org">Contributor Covenant</a> version 1.4.</p>


          

          

          <h1 id="s:citation">Citation</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          <p>Please cite this work as:</p>

<blockquote>
  <p>Greg Wilson (ed.): <em>Still Magic: How to Build Research Software You Can Trust and Still Be Home in Time for Dinner</em>.  <a href="http://merely-useful.github.io/still-magic/">http://merely-useful.github.io/still-magic/</a>, 2018.</p>
</blockquote>

<h2 id="contributors">Contributors</h2>

<ul>
  <li><a href="http://third-bit.com">Greg Wilson</a></li>
</ul>

<h2 id="acknowledgments">Acknowledgments</h2>

<ul>
  <li><a href="https://github.com/gcapes">Gerard Capes</a></li>
  <li><a href="http://katyhuff.github.io/">Katy Huff</a></li>
  <li><a href="https://www.matthewkirk.com/">Matthew J. Kirk</a></li>
  <li><a href="http://poisotlab.io/">Timothée Poisot</a></li>
  <li><a href="https://ccit.clemson.edu/research/researcher-profiles/ashwin-srinath/">Ashwin Srinath</a></li>
  <li><a href="https://standage.github.io/">Daniel Standage</a></li>
</ul>


          

          

          <h1 id="s:gloss">Glossary</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          <p><strong id="g:absolute-error">Absolute error</strong>: FIXME</p>

<p><strong id="g:accuracy">Accuracy</strong>: FIXME</p>

<p><strong id="g:make-action">Action</strong> (in Makefile): FIXME</p>

<p><strong id="g:annotated-tag">Annotated tag</strong>: FIXME</p>

<p><strong id="g:automatic-variable">Automatic variable</strong>: FIXME</p>

<p><strong id="g:build-tool">Build tool</strong>: FIXME</p>

<p><strong id="g:chunking">Chunking</strong>: FIXME</p>

<p><strong id="g:cognitive-load">Cognitive load</strong>: FIXME</p>

<p><strong id="g:commit-hash">Commit hash</strong>: FIXME</p>

<p><strong id="g:commons">Commons</strong>: FIXME</p>

<p><strong id="g:conditional-expression">Conditional expression</strong>: FIXME</p>

<p><strong id="g:cdn">Content delivery network</strong> (CDN): FIXME</p>

<p><strong id="g:context-manager">Context manager</strong>: FIXME</p>

<p><strong id="g:continuous-integration">Continuous integration</strong>: FIXME</p>

<p><strong id="g:coverage">Coverage</strong>: FIXME</p>

<p><strong id="g:cc-by">Creative Commons - Attribution License</strong> (CC-BY): FIXME</p>

<p><strong id="g:declarative-programming">Declarative programming</strong>: FIXME</p>

<p><strong id="g:default-target">Default target</strong>: FIXME</p>

<p><strong id="g:make-dependency">Dependency</strong> (in Makefile): FIXME</p>

<p><strong id="g:dependency-graph">Dependency graph</strong>: FIXME</p>

<p><strong id="g:design-patterns">Design patterns</strong>: FIXME</p>

<p><strong id="g:docstring">Docstring</strong>: FIXME</p>

<p><strong id="g:doi">DOI</strong> (Digital Object Identifier): FIXME</p>

<p><strong id="g:exit-status">Exit status</strong>: FIXME</p>

<p><strong id="g:exponent">Exponent</strong>: FIXME</p>

<p><strong id="g:filename-stem">Filename stem</strong>: FIXME</p>

<p><strong id="g:jekyll-filter">Filter</strong> (in Jekyll): FIXME</p>

<p><strong id="g:fixture">Fixture</strong>: FIXME</p>

<p><strong id="g:make-function">Function</strong> (in Make): FIXME</p>

<p><strong id="g:function-attribute">Function attribute</strong>: FIXME</p>

<p><strong id="g:gpl">GNU Public License</strong> (GPL): FIXME</p>

<p><strong id="g:guard-clause">Guard clause</strong>: FIXME</p>

<p><strong id="g:in-place-operator">In-place operator</strong>: FIXME</p>

<p><strong id="g:issue">Issue</strong>: FIXME</p>

<p><strong id="g:linter">Linter</strong>: FIXME</p>

<p><strong id="g:magnitude">Magnitude</strong>: FIXME</p>

<p><strong id="g:mantissa">Mantissa</strong>: FIXME</p>

<p><strong id="g:mit-license">MIT License</strong>: FIXME</p>

<p><strong id="g:oop">Object-oriented programming</strong>: FIXME</p>

<p><strong id="g:operational-test">Operational test</strong>: FIXME</p>

<p><strong id="g:orcid">ORCID</strong>: FIXME</p>

<p><strong id="g:overlay-configuration">Overlay configuration</strong>: FIXME</p>

<p><strong id="g:package">Package</strong>: FIXME</p>

<p><strong id="g:page-template">Page template</strong>: FIXME</p>

<p><strong id="g:pattern-rule">Pattern rule</strong>: FIXME</p>

<p><strong id="g:phony-target">Phony target</strong>: FIXME</p>

<p><strong id="g:precision">Precision</strong>: FIXME</p>

<p><strong id="g:procedural-programming">Procedural programming</strong>: FIXME</p>

<p><strong id="g:cc-0">Public domain license</strong> (CC-0): FIXME</p>

<p><strong id="g:pull-request">Pull request</strong>: FIXME</p>

<p><strong id="g:raster-image">Raster image</strong>: FIXME</p>

<p><strong id="g:rebase">Rebase</strong>: FIXME</p>

<p><strong id="g:refactor">Refactor</strong>: FIXME</p>

<p><strong id="g:relative-error">Relative error</strong>: FIXME</p>

<p><strong id="g:restructured-text">reStructured Text</strong>: FIXME</p>

<p><strong id="g:make-rule">Rule</strong> (in Make): FIXME</p>

<p><strong id="g:semantic-versioning">Semantic versioning</strong>: FIXME <a href="https://semver.org/">https://semver.org/</a></p>

<p><strong id="g:short-circuit">Short circuit</strong>: FIXME</p>

<p><strong id="g:sign">Sign</strong>: FIXME</p>

<p><strong id="g:silent-error">Silent error</strong>: FIXME</p>

<p><strong id="g:tab-completion">Tab completion</strong>: FIXME</p>

<p><strong id="g:git-tag">Tag</strong>: FIXME</p>

<p><strong id="g:make-target">Target</strong> (in Make): FIXME</p>

<p><strong id="g:technical-debt">Technical debt</strong>: FIXME</p>

<p><strong id="g:test-coverage">Test coverage</strong>: FIXME</p>

<p><strong id="g:test-double">Test double</strong>: FIXME</p>

<p><strong id="g:tdd">Test-driven development</strong>: FIXME</p>

<p><strong id="g:test-runner">Test runner</strong>: FIXME</p>

<p><strong id="g:theme">Theme</strong> (in Jekyll): FIXME</p>

<p><strong id="g:tidy-data">Tidy data</strong>: tabular data organized so that:</p>
<ol>
  <li>Each variable is in one column.</li>
  <li>Each different observation of that variable is in a different row.</li>
  <li>There is one table for each “kind” of variable.</li>
  <li>If there are multiple tables, each includes a key so that related data can be linked.</li>
</ol>

<p><strong id="g:timestamp">Timestamp</strong> (on file): FIXME</p>

<p><strong id="g:tolerance">Tolerance</strong>: FIXME</p>

<p><strong id="g:typesetting-language">Typesetting language</strong>: FIXME</p>

<p><strong id="g:unit-test">Unit test</strong>: FIXME</p>

<p><strong id="g:vector-image">Vector image</strong>: FIXME</p>

<p><strong id="g:virtual-environment">Virtual environment</strong>: FIXME</p>

<p><strong id="g:wildcard">Wildcard</strong>: FIXME</p>

<p><strong id="g:wysiwyg">WYSIWYG</strong> (What You See Is What You Get): FIXME</p>


          

          

          <h1 id="s:objectives">Learning Objectives</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          
<h2><a href="/en/intro/">Introduction</a></h2>
<ul><li>Explain the difference between open science, reproducible research, and computational competence.
</li><li>Determine readiness for using this material.
</li><li>Explain what ‘done’ looks like for the computational component of a small or medium-sized research project.
</li><li>Determine whether a particular research project meets that standard.
</li></ul>
<h2><a href="/en/automate/">Automating Analyses</a></h2>
<ul><li>Explain what a build tool is and how build tools aid reproducible research.
</li><li>Describe and identify the three parts of a Make rule.
</li><li>Write a Makefile that re-runs a multi-stage data analysis.
</li><li>Explain and trace how Make chooses an order in which to execute rules.
</li><li>Explain what phony targets are and define a phony target.
</li><li>Explain what automatic variables are and correctly identify three commonly-used automatic variables.
</li><li>Rewrite Make rules to use automatic variables.
</li><li>Explain why and how to write a pattern rule in a Makefile.
</li><li>Rewrite Make rules to use patterns.
</li><li>Define variables in a Makefile explicitly and by using functions.
</li><li>Make a self-documenting Makefile.
</li></ul>
<h2><a href="/en/unit/">Unit Testing</a></h2>
<ul><li>Explain what realistic technical and social goals for software testing are.
</li><li>Explain what a test runner is.
</li><li>Explain what a text fixture is.
</li><li>Write and run unit tests using Python’s <code class="highlighter-rouge">pytest</code> test runner.
</li><li>Check test coverage using Python’s <code class="highlighter-rouge">coverage</code> module.
</li></ul>
<h2><a href="/en/correct/">Testing Data Analysis</a></h2>
<ul><li>Explain why floating point results aren’t random but can still be unpredictable.
</li><li>Explain why it is hard to test code that produces plots or other graphical output.
</li><li>Describe and implement heuristics for testing data analysis.
</li><li>Describe the role of inference in data analysis testing and use the <code class="highlighter-rouge">tdda</code> library to find and check constraints on tabular data.
</li></ul>
<h2><a href="/en/logging/">Logging</a></h2>
<ul><li>Explain the advantages of using a logging library rather than <code class="highlighter-rouge">print</code> statements in data science pipelines.
</li><li>Describe the intent of the five standard logging levels.
</li><li>Create and configure a simple logger.
</li><li>Define a custom format for log messages.
</li><li>Define a source name to use in consolidated logs.
</li></ul>
<h2><a href="/en/configuration/">Configuration</a></h2>
<ul><li>Describe the four levels of configuration typically used by robust software.
</li><li>Explain what an overlay configuration is.
</li><li>Explain why nested configuration options are usually not a good idea.
</li><li>Add flat overlay configuration to a small application.
</li></ul>
<h2><a href="/en/ghp/">Using GitHub Pages</a></h2>
<ul><li>Explain the strengths and shortcomings of today’s publishing options for research reports.
</li><li>Format pages using Markdown.
</li><li>Publish pages online using GitHub Pages.
</li><li>Use metadata headers, templates, and configuration files to eliminate redundancy in GitHub Pages.
</li><li>Preview GitHub Pages sites locally.
</li><li>Publish sites on GitHub Pages by generating documentation locally and committing it to the repository.
</li><li>Configure and use MathJax to add mathematics to web pages.
</li></ul>
<h2><a href="/en/workflow/">A Scalable Workflow</a></h2>
<ul><li>Explain what rebasing is and use it interactively to collapse a sequence of commits into a single commit.
</li><li>Describe a branch-per-feature workflow and explain why to use it.
</li><li>Describe what a repository tag is and create an annotated tag in a Git repository.
</li><li>Explain what an issue tracking tool does and what it should be used for.
</li><li>Explain how to use labels on issues to manage work.
</li><li>Describe the information a well-written issue should contain.
</li></ul>
<h2><a href="/en/continuous/">Continuous Integration</a></h2>
<ul><li>Explain how continuous integration works.
</li><li>Configure continuous integration for a small software project.
</li></ul>
<h2><a href="/en/style/">Programming Style</a></h2>
<ul><li>Explain why consistent formatting of code is important.
</li><li>Describe standard Python formatting rules and identify cases where code does or doesn’t conform to them.
</li><li>Write functions whose parameters have default values.
</li><li>Explain which parameters should have default values and how to select good ones.
</li><li>Write functions that can handle variable numbers of arguments.
</li><li>Explain what problems can most easily be solved by creating functions with variable numbers of arguments.
</li></ul>
<h2><a href="/en/refactoring/">Refactoring</a></h2>
<ul><li>Describe at least four common refactorings and correctly apply each.
</li></ul>
<h2><a href="/en/structure/">Project Structure</a></h2>
<ul><li>Describe and justify Noble’s Rules for organizing projects.
</li><li>Explain the purpose of README, LICENSE, CONDUCT, and CITATION files.
</li></ul>
<h2><a href="/en/inclusive/">Including Everyone</a></h2>
<ul><li>Explain the purpose of a Code of Conduct and the essential features an effective one must have.
</li><li>Explain why adding licensing information to a repository is important.
</li><li>Explain differences in licensing and social expectations.
</li><li>Choose an appropriate license.
</li><li>Explain where and how to communicate licensing.
</li><li>Explain steps a project lead can take to be a good ally.
</li></ul>
<h2><a href="/en/packages/">Packages</a></h2>
<ul><li>Create and use virtual environments to manage library versions without conflict.
</li><li>Create and test a citable, shareable Pip package.
</li></ul>
<h2><a href="/en/publish/">Publishing</a></h2>
<ul><li>Explain what to include in publications, and where to publish large, medium, and small datasets.
</li><li>Explain what DOIs and ORCIDs are.
</li><li>Get an ORCID.
</li><li>Describe the FAIR Principles and determine whether a dataset conforms to them.
</li><li>Obtain DOIs for datasets, reports, and software packages.
</li></ul>
<h2><a href="/en/docs/">Documenting Code</a></h2>
<ul><li>Explain what docstrings are and add correctly-formatted docstrings to short Python programs.
</li><li>Extract and format documentation from docstrings using <code class="highlighter-rouge">pydoc</code>.
</li></ul>
<h2><a href="/en/finale/">Finale</a></h2>
<ul><li>Explain eight rules for thinking like a programmer.
</li><li>Describe the next steps in a research programmer’s development.
</li></ul>


          

          

          <h1 id="s:keypoints">Key Points</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          
<h2><a href="/en/intro/">Introduction</a></h2>
<ul><li>Research is ‘open’ if everyone can read it, ‘reproducible’ if people who have access can regenerate it, and ‘competent’ if it was built in reasonable time and without heroic effort.
</li><li>Computational competence is the digital equivalent of knowing how to use lab equipment properly.
</li><li>A project is ‘done’ when stakeholders can be reasonably sure the results are correct and the software can be understood, run, and extended by people other than the original authors without heroic effort.
</li></ul>
<h2><a href="/en/automate/">Automating Analyses</a></h2>
<ul><li>A build tool re-runs commands to bring files up to date with respect to the things they depend on.
</li><li>Make is a widely-used build tool that uses files’ timestamps to find out-of-date dependencies.
</li><li>A Make rule has targets, dependencies, and actions.
</li><li>A target can correspond to a file or be a phony target (used simply to trigger actions).
</li><li>When a target is out of date with respect to its dependencies, Make executes the actions associated with its rule.
</li><li>Make executes as many rules as it needs to when updating files, but always respect depdendency order.
</li><li>Make defines the automatic variables <code class="highlighter-rouge">$@</code> (target), <code class="highlighter-rouge">$^</code> (all dependencies), and <code class="highlighter-rouge">$&lt;</code> (first dependency).
</li><li>Pattern rules can use <code class="highlighter-rouge">%</code> as a placeholder for parts of filenames.
</li><li>Makefiles can define variables using <code class="highlighter-rouge">NAME=value</code>.
</li><li>Makefiles can also use functions such as <code class="highlighter-rouge">$(wildcard ...)</code> and <code class="highlighter-rouge">$(patsubst ...)</code>.
</li><li>Specially-formatted comments can be used to make Makefiles self-documenting.
</li></ul>
<h2><a href="/en/unit/">Unit Testing</a></h2>
<ul><li>Testing can only ever show that software has flaws, not that it is correct.
</li><li>Its real purpose is to convince people (including yourself) that software is correct enough, and to make tolerances on ‘enough’ explicit.
</li><li>A test runner finds and runs tests written in a prescribed fashion and reports their results.
</li><li>A unit test can pass (work as expected), fail (meaning the software under test is flawed), or produce an error (meaning the test itself is flawed).
</li><li>A fixture is the data or other input that a test is run on.
</li><li>Every unit test should be independent of every other to keep results comprehensible and reliable.
</li><li>Programmers should check that their software fails when and as it is supposed to in order to avoid silent errors.
</li><li>Write test doubles to replace unpredictable inputs such as random numbers or the current date or time with a predictable value.
</li><li>Use string I/O doubles when testing file input and output.
</li><li>Use a coverage tool to check how well tests have exercised code.
</li></ul>
<h2><a href="/en/correct/">Testing Data Analysis</a></h2>
<ul><li>Programmers should use tolerances when comparing floating-point numbers (not just in tests).
</li><li>Test the data structures used in plotting rather than the plots themselves.
</li><li>Check that parametric or non-parametric statistics of data do not differ from saved values by more than a specified tolerance.
</li><li>Infer constraints on data and then check that subsequent data sets obey these constraints.
</li></ul>
<h2><a href="/en/logging/">Logging</a></h2>
<ul><li>Use <code class="highlighter-rouge">logging</code> instead of <code class="highlighter-rouge">print</code> to report program activity.
</li><li>Separate  messages into <code class="highlighter-rouge">DEBUG</code>, <code class="highlighter-rouge">INFO</code>, <code class="highlighter-rouge">WARNING</code>, <code class="highlighter-rouge">ERROR</code>, and <code class="highlighter-rouge">CRITICAL</code> levels.
</li><li>Use <code class="highlighter-rouge">logging.basicConfig</code> to define basic logging parameters.
</li><li>Always provide timestamps using YYYY-MM-DDTHH:MM:SS format.
</li><li>Use standard input and standard output for normal input and output, and send log messages to a file.
</li><li>Use <code class="highlighter-rouge">tail -f</code> to monitor log files.
</li></ul>
<h2><a href="/en/configuration/">Configuration</a></h2>
<ul><li>Use short command-line parameters to set commonly-changed options.
</li><li>Allow long command-line parameters to change all other options to facilitate scripting.
</li><li>Use the <code class="highlighter-rouge">getopt</code> library to parse command-line flags.
</li><li>Read a system-wide configuration file, then a user configuration file, then a job configuration file.
</li><li>Format configuration files using YAML.
</li><li>Dump all configuration values in the same format used for input on request.
</li><li>Include the software version number in the dumped configuration.
</li></ul>
<h2><a href="/en/ghp/">Using GitHub Pages</a></h2>
<ul><li>WYSIWYG editors make simple things simple, but complex things hard, and are not well suited to large-scale collaboration.
</li><li>Typesetting pipelines are more complex to use, but scale well and are easier to integrate into reproducible research pipelines.
</li><li>Markdown is a family of throwback text formats that provides a subset of the formatting available in HTML.
</li><li>GitHub can be configured to use Jekyll to publish files located in the <code class="highlighter-rouge">docs</code> directory of a repository’s <code class="highlighter-rouge">master</code> branch as a website.
</li><li>Jekyll can be controlled using YAML metadata in page headers, configuration data in <code class="highlighter-rouge">_config.yml</code>, and page templates in <code class="highlighter-rouge">_layouts</code>.
</li><li>Instead of using Jekyll, pages can be generated locally and committed to the repository’s <code class="highlighter-rouge">docs</code> directory.
</li><li>Math can be added to pages using MathJax and LaTeX equation syntax.
</li></ul>
<h2><a href="/en/workflow/">A Scalable Workflow</a></h2>
<ul><li>Create a new branch for every feature, and only work on that feature in that branch.
</li><li>Always create branches from <code class="highlighter-rouge">master</code>, and always merge to <code class="highlighter-rouge">master</code>.
</li><li>Use rebasing to combine several related commits into a single commit before merging.
</li><li>Create issues for bugs, enhancement requests, and discussions.
</li><li>Add people to issues to show who is responsible for working on what.
</li><li>Add labels to issues to identify their purpose.
</li><li>Use rules for issue state transitions to define a workflow for a project.
</li></ul>
<h2><a href="/en/continuous/">Continuous Integration</a></h2>
<ul><li>Continuous integration rebuilds and/or re-tests software every time something changes.
</li><li>Use continuous integration to check changes before they are inspected.
</li><li>Check style as well as correctness.
</li></ul>
<h2><a href="/en/style/">Programming Style</a></h2>
<ul><li>The brain thinks every difference is significant, so removing unnecessary differences in formatting reduces cognitive load.
</li><li>Python software should always conform to the formatting the rules in PEP 8.
</li><li>Use <code class="highlighter-rouge">name=value</code> to define a default value for a function parameter.
</li><li>Use <code class="highlighter-rouge">*args</code> to define a catch-all parameter for functions taking a variable number of unnamed arguments.
</li><li>Use <code class="highlighter-rouge">**kwargs</code> to define a catch-all parameter for functions taking a variable number of named arguments.
</li></ul>
<h2><a href="/en/refactoring/">Refactoring</a></h2>
<ul><li>Reorganizing code in consistent ways makes errors less likely.
</li><li>Replace a value with a name to make code more readable and to forestall typing errors.
</li><li>Replace a repeated test with a flag to ensure consistency.
</li><li>Turn small pieces of large functions into functions in their own right, even if they are only used once.
</li><li>Combine functions if they are always used together on the same inputs.
</li><li>Use lookup tables to make decision rules easier to follow.
</li><li>Use comprehensions instead of loops.
</li></ul>
<h2><a href="/en/structure/">Project Structure</a></h2>
<ul><li>Put source code for compilation in <code class="highlighter-rouge">src/</code>, runnable code in <code class="highlighter-rouge">bin/</code>, raw data in <code class="highlighter-rouge">data/</code>, results in <code class="highlighter-rouge">results/</code>, and documentation and manuscripts in <code class="highlighter-rouge">doc/</code>.
</li><li>Use file and directory names that are easy to match and include dates for the level under <code class="highlighter-rouge">data/</code> and <code class="highlighter-rouge">results/</code>.
</li><li>Create README, LICENSE, CONDUCT, and CITATION files in the root directory of the project.
</li></ul>
<h2><a href="/en/inclusive/">Including Everyone</a></h2>
<ul><li>Create an explicit Code of Conduct for your project modelled on the Contributor Covenant.
</li><li>Be clear about how to report violations of the Code of Conduct and who will handle such reports.
</li><li>People who are not lawyers should not try to write licenses.
</li><li>Every project should include an explicit license to make clear who can do what with the material.
</li><li>People who incorporate GPL’d software into their own software must make their software also open under the GPL license; most other open licenses do not require this.
</li><li>The Creative Commons family of licenses allow people to mix and match requirements and restrictions on attribution, creation of derivative works, further sharing, and commercialization.
</li><li>Be proactive about welcoming and nurturing community members.
</li></ul>
<h2><a href="/en/packages/">Packages</a></h2>
<ul><li>Use <code class="highlighter-rouge">virtualenv</code> to create a separate virtual environment for each project.
</li><li>Use <code class="highlighter-rouge">pip</code> to create a distributable package containing your project’s software, documentation, and data.
</li></ul>
<h2><a href="/en/publish/">Publishing</a></h2>
<ul><li>Include small datasets in repositories; store large ones on data sharing sites, and include metadata in the repository to locate them.
</li><li>An ORCID is a unique personal identifier that you can use to identify your work.
</li><li>A DOI is a unique identifier for a particular dataset, report, or software release.
</li><li>Data should be findable, accessible, interoperable, and reusable (FAIR).
</li><li>Use Zenodo to obtain DOIs.
</li><li>Publish your software as you would a paper.
</li></ul>
<h2><a href="/en/docs/">Documenting Code</a></h2>
<ul><li>Documentation strings (docstrings) can be placed at the start of a file or at the start of a function.
</li><li>Docstrings can be formatted using a superset of Markdown.
</li><li>Tools like <code class="highlighter-rouge">pydoc</code> and Sphinx can extract and format docstrings to create documentation for software.
</li></ul>
<h2><a href="/en/finale/">Finale</a></h2>
<ul><li>It’s all just data.
</li><li>Data doesn’t mean anything on its own: it has to be interpreted.
</li><li>Programming is about creating and composing abstractions.
</li><li>Models are for computers, and views are for people.
</li><li>Slowing down makes us go faster.
</li><li>Better algorithms are better than better hardware.
</li><li>The tool shapes the hand.
</li><li>No human interpretation of data is neutral.
</li></ul>


          

          

          <h1 id="s:design">Design Notes</h1>
          <blockquote class="callout">
  <strong>August 2018: This material is under very active development,</strong>
  and should all be considered the "brainstorming" phase of <a href="http://teachtogether.tech/en/process/">a rational lesson design process</a>.
  Please see <a href="/en/design/">the design notes</a> for an explanation of scope and plan.
  We would appreciate your help:
  please <a href="mailto:gvwilson@third-bit.com">send us suggestions</a>
  or <a href="https://github.com/merely-useful/still-magic//issues">file an issue</a> in <a href="https://github.com/merely-useful/still-magic/">our GitHub repository</a>.
  (We would particularly appreciate descriptions of common errors and how to fix them&mdash;there are subsections for these in every lesson.)
  Please note that all contributors are required to abide by <a href="/en/conduct/">our Code of Conduct</a>.
</blockquote>

          

          <h2 id="brainstorming">Brainstorming</h2>

<ol>
  <li>What questions will this course answer?
    <ul>
      <li>How can I write code that is readable, testable, and maintainable?</li>
      <li>How should I organize and share my software, data, and results?</li>
      <li>How can I make my work more efficient and reproducible?</li>
      <li>How can I check and demonstrate that my work is correct?</li>
      <li>How should I publish my work in the early 21st Century?</li>
      <li>How can I make it easy for other people to collaborate with me?</li>
    </ul>
  </li>
  <li>What concepts and techniques will learners meet?
    <ul>
      <li>Use a build tool with pattern rules to make analyses reproducible.</li>
      <li>Use a unit testing harness to run and manage tests.</li>
      <li>Use a coverage tool to identify unused or untested code.</li>
      <li>Use stubs and mocks to isolate hard-to-test components.</li>
      <li>Produce identical results when given identical inputs.</li>
      <li>Define tolerances for production runs of data analysis pipelines.</li>
      <li>Use a logging framework to report activity.</li>
      <li>Use command-line parameters and configuration files to control program behavior.</li>
      <li>Use standard libraries to parse command-line arguments idiomatically.</li>
      <li>Have all programs, however small, print a short usage message.</li>
      <li>Use Markdown and GitHub Pages to publish documentation and reports.</li>
      <li>Use a branch-per-feature workflow to manage work.</li>
      <li>Rebase to consolidate work.</li>
      <li>Use tags and semantic versioning to identify production versions of software.</li>
      <li>Configure continuous integration to tell you what state your project is in.</li>
      <li>Follow the naming conventions of your chosen language.</li>
      <li>Use style checking tools to ensure consistent naming and structure.</li>
      <li>Apply standard refactorings to clean up code as needs evolve.</li>
      <li>Separate code, raw data, processed data, and reports.</li>
      <li>Use meaningful, matchable names for directories and files.</li>
      <li>Use CC-0 for data, CC-BY for reports, and the MIT License for code.</li>
      <li>Adopt a code of conduct for your project to clarify expectations and standards.</li>
      <li>Be a proactive ally for members of marginalized or targeted groups.</li>
      <li>Always install software using a package manager.</li>
      <li>Use virtual environments to avoid conflicts between projects.</li>
      <li>Embed the documentation for software in the software itself.</li>
      <li>Use a documentation generator to extract and format embedded documentation.</li>
    </ul>
  </li>
  <li>What technologies will learners use?
    <ul>
      <li><code class="highlighter-rouge">make</code> for build automation.</li>
      <li><code class="highlighter-rouge">pytest</code> for unit testing.</li>
      <li><code class="highlighter-rouge">StringIO</code> for testing text streams.</li>
      <li><code class="highlighter-rouge">coverage</code> for coverage analysis.</li>
      <li><code class="highlighter-rouge">tdda</code> for constraint inference and checking.</li>
      <li><code class="highlighter-rouge">logging</code> for logging.</li>
      <li><code class="highlighter-rouge">yaml</code> for configuration files.</li>
      <li><code class="highlighter-rouge">getopt</code> for parsing command-line arguments.</li>
      <li>Markdown for authoring.</li>
      <li>Jekyll for generating websites.</li>
      <li><code class="highlighter-rouge">git rebase -i</code> to consolidate work.</li>
      <li><code class="highlighter-rouge">git tag</code> to tag releases.</li>
      <li>Travis-CI for continuous integration.</li>
      <li><code class="highlighter-rouge">pep8</code> for checking style.</li>
      <li>Noble’s Rules for project organization [<a href="#Nobl2009">Nobl2009</a>].</li>
      <li>Taschuk’s Rules for robust software [<a href="#Tasc2017">Tasc2017</a>].</li>
      <li>Creative Commons and MIT licenses for data, reports, and software.</li>
      <li>The Contributor Covenant as a code of conduct.</li>
      <li><code class="highlighter-rouge">pip</code> for package creationg and installation.</li>
      <li><code class="highlighter-rouge">virtualenv</code> for environment management.</li>
      <li><code class="highlighter-rouge">pydoc</code> for documentation generation.</li>
    </ul>
  </li>
  <li>What do learners already need to know?
    <ul>
      <li>Python: lists, loops, conditionals, functions, importing and using libraries</li>
      <li>Unix shell: paths, editing/renaming/deleting files, wildcards, redirection, pipes and filters, shell scripts</li>
      <li>Git: add/commit, log, merge, resolving conflicts, push, pull</li>
      <li>The core <a href="http://software-carpentry.org">Software Carpentry</a> lessons cover these topics, as does the <a href="https://merely-useful.github.io/one-extra-thing/">prerequisite course</a> in this series</li>
    </ul>
  </li>
  <li>What <em>won’t</em> be covered?
    <ul>
      <li>Statistics: not the focus of this course.</li>
      <li>Higher-order functions and object-oriented programming: higher-level programming isn’t the focus of this material.</li>
      <li>Building <code class="highlighter-rouge">conda</code> packages: basic ideas are illustrated by <code class="highlighter-rouge">pip</code>.</li>
      <li>Performance profiling: useful but not crucial (will be briefly mentioned when discussing coverage).</li>
      <li>Parallelism: out of scope for most learners at this level (and very dependent on local setup).</li>
      <li>Hosting options other than GitHub: mention in passing.</li>
      <li>Code reviews: hard to teach without direct contact (and in practice, most people at this level won’t do them)</li>
      <li>Relational or non-relational databases: not core to program design and construction.</li>
      <li>Scrum: out of scope for this audience (and not something most will be able to follow in practice).</li>
      <li>Test-driven development: will be mentioned when talking about testing, but the evidence doesn’t support its effectiveness.</li>
      <li>Recruiting, mentoring, marketing, and community building: out of scope.</li>
    </ul>
  </li>
</ol>

<h2 id="exercises">Exercises</h2>

<ul>
  <li>Use <a href="http://en.wikipedia.org/wiki/Zipf%27s_law">Zipf’s Law</a> as a running example
    <ul>
      <li>Do individual works by different authors obey this rule?</li>
      <li>Do aggregate texts?</li>
    </ul>
  </li>
  <li>Simple to understand, but the software, data, and results aren’t one-liners</li>
</ul>

<h2 id="lesson-plan">Lesson Plan</h2>

<p><a href="/en/intro/">Introduction</a></p>
<ul><li>What is the difference between open, reproducible, and competent?
</li><li>What is the scope of this training?
</li><li>What are the prerequisites for this training?
</li></ul>
<p><a href="/en/automate/">Automating Analyses</a></p>
<ul><li>How can I make my analyses easier to reproduce?
</li><li>How can I make it easier to repeat analyses when I get new data, or when my data or scripts change?
</li></ul>
<p><a href="/en/unit/">Unit Testing</a></p>
<ul><li>How should I write tests for my software?
</li><li>How can I tell how much testing I’ve actually done?
</li></ul>
<p><a href="/en/correct/">Testing Data Analysis</a></p>
<ul><li>How should I test a data analysis pipeline?
</li></ul>
<p><a href="/en/logging/">Logging</a></p>
<ul><li>How should I keep track of what I actually did?
</li><li>How can I get my software to report errors?
</li></ul>
<p><a href="/en/configuration/">Configuration</a></p>
<ul><li>How can I make it easy for users to configure software?
</li></ul>
<p><a href="/en/ghp/">Using GitHub Pages</a></p>
<ul><li>How can I create a static website for my work?
</li></ul>
<p><a href="/en/workflow/">A Scalable Workflow</a></p>
<ul><li>How can a growing number of people coordinate work on a single project?
</li><li>How can I tell what needs to be done and who is doing it?
</li></ul>
<p><a href="/en/continuous/">Continuous Integration</a></p>
<ul><li>How can I tell what state my project is actually in?
</li></ul>
<p><a href="/en/style/">Programming Style</a></p>
<ul><li>How should I name my variables and functions?
</li><li>How should I organize my code so that other people can understand it?
</li></ul>
<p><a href="/en/refactoring/">Refactoring</a></p>
<ul><li>How can I go about reorganizing code when I’m making changes?
</li></ul>
<p><a href="/en/structure/">Project Structure</a></p>
<ul><li>How should I organize the files and directories in my project?
</li></ul>
<p><a href="/en/inclusive/">Including Everyone</a></p>
<ul><li>Why should I make my project welcoming for everyone?
</li><li>Why do I need a license for my work?
</li><li>What license should I use for my work?
</li><li>How should I tell people what they can and cannot do with my work?
</li><li>Why should my project have an explicit Code of Conduct?
</li><li>How can I be a good ally?
</li></ul>
<p><a href="/en/packages/">Packages</a></p>
<ul><li>How can I manage the libraries my project relies on?
</li><li>How can I package up my work for others to use?
</li></ul>
<p><a href="/en/publish/">Publishing</a></p>
<ul><li>How and where should I publish my reports?
</li><li>What should I include in my publications?
</li></ul>
<p><a href="/en/docs/">Documenting Code</a></p>
<ul><li>What kind of documentation should I write and where should I put it?
</li></ul>
<p><a href="/en/finale/">Finale</a></p>
<ul><li>What does it all mean?
</li><li>Where do we go next?
</li></ul>


          

          
<!-- main end -->
        </div>
      </div>
    </div>
  </body>
</html>

